// ==UserScript==
// @name        Menu Bar framework
// @namespace   *
// @description Greasemonkey plugin development framework, add a useful and functional menu bar in the page.
// @include     *
// @require     http://code.jquery.com/jquery.min.js
// @version     0.4.2a
// ==/UserScript==
(function(e,t,n){"use strict";var r="#menubar-7cad339b0b08db99561c640461d00a07";var o="#menubar-title";var i="#menubar-message";var s="#menubar-footer";var a="#menubar-menu";var u="#menubar-list-menu";var c;var l;var f={cropFirstSymbol:function(e){var t=/^#|^\./;return e.replace(t,"")},jqobClean:function(e){e.empty().removeAttr("id").removeAttr("class").removeAttr("style")},tag:function(t,n){return e("<"+t+"/>",n)}};var d={convert_status_bar:function(e){e.attr("id",f.cropFirstSymbol(r)).css(l.bar_basic_style);var t=f.tag("div",{id:f.cropFirstSymbol(o)}).css(l.menu_basic_style).css(l.font_style);var n=f.tag("div",{id:f.cropFirstSymbol(i)}).css(l.menu_basic_style).css(l.font_style);var a=f.tag("div",{id:f.cropFirstSymbol(s)}).css(l.menu_basic_style).css(l.font_style);if(c.foot_size!=="none"){a.css("font-size",c.foot_size)}e.append(t).append(n).append(a).append(this.create_status_menu())},create_status_menu:function(){var e=f.tag("div",{id:f.cropFirstSymbol(a)}).css(l.menu_basic_style);var t=f.tag("ul",{id:f.cropFirstSymbol(u)});t.css({margin:0,padding:0});e.append(t);return e},create_root_menu_item:function(t,n,r){var o=f.tag("a",{id:t,href:"#",text:n}).click(function(e){e.preventDefault();if(r){r.apply()}});o.css(l.tag_a_css).css({background:c.menu_bg_color}).hover(function(){e(this).css({background:c.menu_hover_bg_color.hover_background_color})},function(){e(this).css({background:c.menu_bg_color})});var i=f.tag("li").css(l.root_menu_style).append(o);return i},create_menu_item:function(t,n,r){var o=f.tag("li");o.css(l.menu_style);var i=f.tag("a",{id:t,href:"#",text:n}).click(function(e){e.preventDefault();if(r){r.apply()}});i.css(l.tag_a_css).css({background:c.menu_bg_color}).css({"border-bottom":"1px solid "+c.menu_separator_color}).hover(function(){e(this).css({background:c.menu_hover_bg_color})},function(){e(this).css({background:c.menu_bg_color})});o.append(i);return o},construct_root_menu:function(e){return this.create_root_menu_item(e.id,e.title,e.click)},construct_menu:function(e){var t=f.tag("ul");t.hide().css(l.menu_ul_style);for(var n in e){var r=e[n].id;var o=e[n].title;var i=e[n].click;t.append(this.create_menu_item(r,o,i))}return t},construct_one_menu_tree:function(t){var n=this.construct_root_menu(t.root).append(this.construct_menu(t.list));n.hover(function(){e(this).find("ul").slideDown()},function(){e(this).find("ul").slideUp()});return n},select_hide_mode:function(t){if(c.hide_mode==="all"){e(document).dblclick(function(){t.toggle()})}else if(c.hide_mode==="onBar"){e(document).dblclick(function(n){var o=e(n.target).parents(r);if(o[0]===t[0]){t.hide()}else{t.show()}})}else if(c.hide_mode==="notOnBar"){e(document).dblclick(function(n){var o=e(n.target).parents(r);if(o[0]!==t[0]){t.toggle()}})}else if(c.hide_mode==="notOnMenu"){e(document).dblclick(function(n){var o=e(n.target).parents(r);if(!(o[0]===t[0]&&n.target.nodeName==="A")){t.toggle()}})}else if(c.hide_mode==="noHide"){}else{e.error("Wrong Type of Hide Mode")}},init_status_bar:function(e,t){var n=e.find(a);var r=e.find(s);e.hover(function(){if(c.foot_mode==="hide"){r.show()}n.show()},function(){if(c.foot_mode==="hide"){r.hide("slow")}n.hide("slow")});for(var o in t){this.construct_one_menu_tree(t[o]).appendTo(e.find(u))}n.hide();if(c.foot_mode==="hide"){r.hide()}e.menubar("title",c.bar_title);e.menubar("foot",c.bar_foot);this.select_hide_mode(e)},inital_cssManager:function(){l={font_style:{"font-family":c.font_family,"font-size":"100%"},bar_basic_style:{position:"fixed","background-color":c.bar_bg_color,color:c.bar_font_color,bottom:"0",right:"0",opacity:c.bar_opacity,"border-radius":"0px "+c.border_radius+" 0px 0px",padding:"0px","padding-left":"2px","margin-left":"1px",width:"100%","z-index":"99999","line-height":"normal","box-shadow":c.bar_shadow,"text-align":"left"},menu_basic_style:{padding:"0px",background:"","list-style":"none",margin:"0px"},menu_ul_style:{margin:"0",padding:"0",position:"fixed","box-shadow":c.menu_shadow,bottom:"30px"},tag_a_css:{"font-size":"medium",display:"block",padding:"5px 12px","text-decoration":"none",width:c.menu_width,color:c.menu_font_color,"white-space":"nowrap"}};l.menu_style=e.extend({},l.menu_basic_style,{display:"inline"});l.root_menu_style=e.extend({},l.menu_basic_style,{"float":"left","border-left":"1px solid "+c.menu_separator_color});l.bar_basic_style=e.extend({},l.bar_basic_style,l.font_style)}};var _={init:function(t,n){c=e.extend(true,{bar_title:"Helper Bar",bar_foot:"",foot_mode:"hide",foot_size:"6px",safe_mode:"safe",hide_mode:"notOnMenu",warn_size:"50px",warn_color:"red",warn_mode:"append",border_radius:"56px",bar_bg_color:"black",bar_opacity:"0.8",bar_font_color:"white",menu_width:"auto",menu_separator_color:"black",menu_bg_color:"#111111",menu_hover_bg_color:"#333333",font_family:"Arial,Helvetica,Sans-Serif",menu_font_color:"#EAFFED",menu_shadow:"0px 0px 6px 2px black",bar_shadow:"6px 0px 6px 2px black",msg_click:function(){},bar_click:function(){}},n);d.inital_cssManager();return this.each(function(){f.jqobClean(e(this));d.convert_status_bar(e(this));d.init_status_bar(e(this),t)})},title:function(t){return this.each(function(){e(this).find(o).append(t)})},clsTitle:function(){return this.each(function(){e(this).find(o).empty()})},foot:function(t){return this.each(function(){e(this).find(s).append(t)})},getArea:function(t){var n={foot:s,title:o,msg:i,menu:a};return e(this).find(n[t])},clsFoot:function(){return this.each(function(){e(this).find(s).empty()})},html:function(t){if(arguments.length===0){return this.find(i).html()}else{return this.each(function(){e(this).find(i).html(t)})}},append:function(t){return this.each(function(){e(this).find(i).append(t)})},getSettings:function(){return c}};e.fn.menubar=function(t){if(_[t]){return _[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return _.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.menubar")}}})(jQuery,window);(function(e,t,n){"use strict";var r;var o;var i={tag:function(t,n){return e("<"+t+"/>",n)},makeTagMsg:function(e,t,n){return n?i.tag(e).html(t).css(n):i.tag(e).html(t)},delUnsafeMethod:function(){delete s.prototype.getMenuBar;delete s.prototype.getSettings},set_action_on_bar:function(){if(e.isFunction(o.msg_click))r.menubar("getArea","msg").on("click",o.msg_click);if(e.isFunction(o.bar_click)){r.on("click",o.bar_click);r.menubar("getArea","menu").children().on("click",function(e){e.stopPropagation()})}}};function s(t,n){r=i.tag("div").menubar(t,n);o=r.menubar("getSettings");i.set_action_on_bar();if(o.safe_mode!=="unsafe")i.delUnsafeMethod();if(e("body").size()>0){r.appendTo("body")}else{e(function(){r.appendTo("body")})}}s.prototype.getMenuBar=function(){return r};s.prototype.getSettings=function(){return o};s.prototype.append=function(e){r.menubar("append",e);return this};s.prototype.html=function(e){if(arguments.length!==0){r.menubar("html",e);return this}else{return r.menubar("html")}};s.prototype.addmsg=function(e,t){if(typeof t==="string"){e=i.makeTagMsg("span",e,{color:t})}else if(typeof t==="object"){e=i.makeTagMsg("span",e,t)}this.append(e);return this};s.prototype.msg=function(t,n){if(arguments.length!==0){this.cls();return this.addmsg(t,n)}else{return e(this.html()).text()}};s.prototype.log=function(e){if(e===n){e="undefined"}else if(typeof e!=="string"){e=JSON.stringify(e)}e=i.makeTagMsg("div",e);return this.append(e)};s.prototype.warn=function(t){var n={color:o.warn_color,"font-size":o.warn_size};if(o.warn_mode==="append"){return this.addmsg(t,n)}else if(o.warn_mode==="log"){t=i.makeTagMsg("div",t,n);return this.append(t)}else if(o.warn_mode==="clean"){return this.msg(t,n)}else{e.error("no this type of warning mode")}};s.prototype.clickClsMsg=function(t,n,r){if(typeof n==="function")r=n;var o=i.tag("div").html(t).click(function(){e(this).remove();if(typeof r==="function")r.call(o)});if(typeof n==="number"){o.css({"font-size":n})}else if(typeof n==="string"){o.css({color:n})}else if(typeof n==="object"){o.css(n)}else{o.css({"font-size":"100%"})}this.msg(o)};s.prototype.cls=function(){this.html("");return this};s.prototype.title=function(e){r.menubar("title",e);return this};s.prototype.clsTitle=function(){r.menubar("clsTitle");this.title(o.bar_title);return this};s.prototype.foot=function(e){r.menubar("foot",e);return this};s.prototype.clsFoot=function(){r.menubar("clsFoot");return this};s.prototype.open=function(e,n){n=n||"self";if(n==="new"){t.open(e,"_blank")}else if(n==="self"){t.open(e,"_self")}else{t.open(e)}return this};s.prototype.show=function(e){if(!e){r.show()}else{r.slideDown(e)}return this};s.prototype.hide=function(e){if(!e){r.hide()}else{r.slideUp(e)}return this};s.prototype.data=function(t,r){if(typeof t!=="string")e.error("data() key must be string");if(r!==n){localStorage.setItem(t,JSON.stringify(r));if(this instanceof s)return this}else{try{return JSON.parse(localStorage.getItem(t))}catch(o){return localStorage.getItem(t)}}};s.prototype.delData=function(t){if(typeof t==="string"){localStorage.removeItem(t);if(this instanceof s)return this}else{e.error("delData() has not key or key is not string")}};var a={menu_tree_list:[],_rebuild_one_menu_tree:function(t){var n;if(typeof t.root==="object"){return t}else if(t.root=="first"){n=t.list.shift()}else if(t.root=="last"||!t.root){n=t.list.pop()}else{e.error("no such root config")}t.root=n},set:function(t){if(!this.hasMenu())this.menu_tree_list=e.merge([],t);else e.error("Menu have been created")},reset:function(){this.menu_tree_list=[]},merge:function(t){e.merge(this.menu_tree_list,t)},mergeTo:function(t){this.menu_tree_list=e.merge(e.merge([],t),this.menu_tree_list)},addTree:function(e,t,n){if(!!e){var r={title:e,click:t,id:n};this.menu_tree_list.push({root:r,list:[]})}else{this.menu_tree_list.push({list:[]})}},addItem:function(t,n,r){if(!!t){var o={title:t,click:n,id:r};if(!this.hasMenu())e.error("no Menu Tree.");var i=this.menu_tree_list[this.menu_tree_list.length-1].list;i.push(o)}else{e.error("addMenuItem must pass the title at least")}},get:function(){return e.extend(true,[],this.menu_tree_list)},hasMenu:function(){return this.menu_tree_list.length>0?true:false},build:function(t){var n;if(typeof t==="object"){n=e.extend(true,[],t)}else if(t===true){if(this.hasMenu)n=e.extend(true,[],this.menu_tree_list);else e.error("menu is empty")}else{e.error("build() no such argv.")}for(var r in n){this._rebuild_one_menu_tree(n[r])}return n}};t.HelperBar=function(){var e;function t(e,t){var n=a.build(e);return new s(n,t)}var n={menu:{set:function(e){a.set(e);return this},addTree:function(e,t,n){a.addTree(e,t,n);return this},addItem:function(e,t,n){a.addItem(e,t,n);return this},reset:function(){a.reset();return this},merge:function(e){a.merge(e);return this},mergeTo:function(e){a.mergeTo(e);return this},get:function(){return a.get()},build:function(){return a.build(true)}},getBar:function(n,r){if(!e){e=t(n,r)}return e},buildBar:function(n){if(!e){e=t(true,n)}return e},version:function(){return s.prototype.version()}};n.getbar=n.getBar;n.data=s.prototype.data;n.delData=s.prototype.delData;return n}();s.prototype.version=function(){return"0.4.2a"}})(jQuery,window);