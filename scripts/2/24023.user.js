// kanjikoohiicountkanji.user.js! user script for Firefox's GreaseMonkey extension
// version 0.1 BETA! Copyright (c) 2008-2009, Mario Huys
// Released under the GPL license: http://www.gnu.org/copyleft/gpl.html
//
// --------------------------------------------------------------------
//
// 0.3 2009.11.02  woelpad  Adapted to the new site look
// 0.2 2008.08.21  woelpad  Added Script Update Checker
// 0.1 2008.03.17  woelpad  First release
//
// --------------------------------------------------------------------
//
// This is a Greasemonkey user script.  To install it, you need
// Greasemonkey 0.5 (?) or later: http://greasemonkey.mozdev.org/
// Then restart Firefox and revisit this script.
// Under Tools, there will be a new menu item to "Install User Script".
// Accept the default configuration and install.
//
// To uninstall, go to Tools/Manage User Scripts,
// select "Kanji.Koohii: Change order", and click Uninstall.
//
// Contains the kanji for RtK1, as derived from http://kanji.koohii.com/study/keywords.js
//
// --------------------------------------------------------------------
//
// ==UserScript==
// @name           Kanji.Koohii: Count kanji
// @namespace      http://userscripts.org/scripts/show/24023
// @description    Count the number of kanji for your current level in the sight reading section and compare to the number you can reach after completing RtK1.
// @include        http://kanji.koohii.com/sightreading*
// ==/UserScript==

// [Script Update Checker] (http://userscripts.org/scripts/show/20145) written by Jarett (http://userscripts.org/users/38602)
var version_scriptNum = 24023; // Change this to the number given to the script by userscripts.org (check the address bar)
var version_timestamp = 1257205932502; // Used to differentiate one version of the script from an older one. Will be automatically updated each time you alter the script and release it on userscripts.org.
if(version_timestamp){function updateCheck(forced) {if((forced)||(parseInt(GM_getValue("lastUpdate", "0")) + 86400000 <= (new Date().getTime()))) {try {GM_xmlhttpRequest({method: "GET",url: "http://userscripts.org/scripts/review/" + version_scriptNum + "?" + new Date().getTime(),headers: {'Cache-Control': 'no-cache'},onload: function(xhrResponse) {GM_setValue("lastUpdate", new Date().getTime() + ""); var rt = xhrResponse.responseText.replace(/&nbsp;?/gm, " ").replace(/<li>/gm, "\n").replace(/<[^>]*>/gm, "").replace(/&#x000A;/gi, "\n"); var scriptName = (/@name\s*(.*?)\s*$/m.exec(rt))[1]; GM_setValue("targetScriptName", scriptName); if (parseInt(/version_timestamp\s*=\s*([0-9]+)/.exec(rt)[1]) > version_timestamp) {if (confirm("There is an update available for the Greasemonkey script \"" + scriptName + ".\"\nWould you like to go to the install page now?")) {GM_openInTab("http://userscripts.org/scripts/show/" + version_scriptNum);}} else if (forced) {alert("No update is available for \"" + scriptName + ".\"");}}});} catch (err) {if (forced) {alert("An error occurred while checking for updates:\n" + err);}}}} GM_registerMenuCommand(GM_getValue("targetScriptName", "???") + " - Manual Update Check", function() {updateCheck(true);}); updateCheck(false)};
// [/Script Update Checker]

var kklist='\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u53e3\u65e5\u6708\u7530\u76ee\u53e4\u543e\u5192\u670b\u660e\u5531\u6676\u54c1\u5442\u660c\u65e9\u65ed\u4e16\u80c3\u65e6\u80c6\u4e98\u51f9\u51f8\u65e7\u81ea\u767d\u767e\u4e2d\u5343\u820c\u5347\u6607\u4e38\u5bf8\u5c02\u535a\u5360\u4e0a\u4e0b\u5353\u671d\u53ea\u8c9d\u8c9e\u54e1\u898b\u5150\u5143\u9801\u9811\u51e1\u8ca0\u4e07\u53e5\u808c\u65ec\u52fa\u7684\u9996\u4e59\u4e71\u76f4\u5177\u771f\u5de5\u5de6\u53f3\u6709\u8cc4\u8ca2\u9805\u5200\u5203\u5207\u53ec\u662d\u5247\u526f\u5225\u4e01\u753a\u53ef\u9802\u5b50\u5b54\u4e86\u5973\u597d\u5982\u6bcd\u8cab\u5144\u514b\u5c0f\u5c11\u5927\u591a\u5915\u6c50\u5916\u540d\u77f3\u8096\u785d\u7815\u7802\u524a\u5149\u592a\u5668\u81ed\u5999\u7701\u539a\u5947\u5ddd\u5dde\u9806\u6c34\u6c37\u6c38\u6cc9\u539f\u9858\u6cf3\u6cbc\u6c96\u6c5f\u6c41\u6f6e\u6e90\u6d3b\u6d88\u6cc1\u6cb3\u6cca\u6e56\u6e2c\u571f\u5410\u5727\u57fc\u57a3\u572d\u5c01\u6daf\u5bfa\u6642\u5747\u706b\u708e\u7169\u6de1\u706f\u7551\u707d\u7070\u70b9\u7167\u9b5a\u6f01\u91cc\u9ed2\u58a8\u9bc9\u91cf\u5398\u57cb\u540c\u6d1e\u80f4\u5411\u5c1a\u5b57\u5b88\u5b8c\u5ba3\u5bb5\u5b89\u5bb4\u5bc4\u5bcc\u8caf\u6728\u6797\u68ee\u6842\u67cf\u67a0\u68a2\u68da\u674f\u6850\u690d\u67af\u6734\u6751\u76f8\u673a\u672c\u672d\u66a6\u6848\u71e5\u672a\u672b\u6cab\u5473\u59b9\u6731\u682a\u82e5\u8349\u82e6\u5bdb\u8584\u8449\u6a21\u6f20\u5893\u66ae\u819c\u82d7\u5146\u6843\u773a\u72ac\u72b6\u9ed9\u7136\u837b\u72e9\u732b\u725b\u7279\u544a\u5148\u6d17\u4ecb\u754c\u8336\u5408\u5854\u738b\u7389\u5b9d\u73e0\u73fe\u72c2\u7687\u5448\u5168\u6813\u7406\u4e3b\u6ce8\u67f1\u91d1\u9291\u9262\u9285\u91e3\u91dd\u9298\u93ae\u9053\u5c0e\u8fbb\u8fc5\u9020\u8feb\u9003\u8fba\u5de1\u8eca\u9023\u8ecc\u8f38\u524d\u5404\u683c\u7565\u5ba2\u984d\u590f\u51e6\u6761\u843d\u5197\u8ecd\u8f1d\u904b\u51a0\u5922\u5751\u9ad8\u4eab\u587e\u719f\u4ead\u4eac\u6dbc\u666f\u9be8\u820e\u5468\u9031\u58eb\u5409\u58ee\u8358\u58f2\u5b66\u899a\u6804\u66f8\u6d25\u7267\u653b\u6557\u679a\u6545\u656c\u8a00\u8b66\u8a08\u7344\u8a02\u8a0e\u8a13\u8a54\u8a70\u8a71\u8a60\u8a69\u8a9e\u8aad\u8abf\u8ac7\u8afe\u8aed\u5f0f\u8a66\u5f10\u57df\u8cca\u683d\u8f09\u8302\u6210\u57ce\u8aa0\u5a01\u6ec5\u6e1b\u685f\u92ad\u6d45\u6b62\u6b69\u6e09\u983b\u80af\u4f01\u6b74\u6b66\u8ce6\u6b63\u8a3c\u653f\u5b9a\u9320\u8d70\u8d85\u8d74\u8d8a\u662f\u984c\u5824\u5efa\u5ef6\u8a95\u790e\u5a7f\u8863\u88c1\u88c5\u88cf\u58ca\u54c0\u9060\u733f\u521d\u5e03\u5e06\u5e45\u5e3d\u5e55\u5e4c\u9326\u5e02\u59c9\u80ba\u5e2f\u6ede\u523a\u5236\u88fd\u8ee2\u82b8\u96e8\u96f2\u66c7\u96f7\u971c\u51ac\u5929\u6a4b\u5b0c\u7acb\u6ce3\u7ae0\u7af6\u5e1d\u7ae5\u77b3\u9418\u5546\u5ae1\u9069\u6ef4\u6575\u5315\u5317\u80cc\u6bd4\u6606\u7686\u6df7\u6e07\u8b01\u8910\u559d\u65e8\u8102\u58f1\u6bce\u654f\u6885\u6d77\u4e5e\u4e7e\u8179\u8907\u6b20\u5439\u708a\u6b4c\u8edf\u6b21\u8328\u8cc7\u59ff\u8aee\u8ce0\u57f9\u5256\u97f3\u6697\u97fb\u8b58\u93e1\u5883\u4ea1\u76f2\u5984\u8352\u671b\u65b9\u59a8\u574a\u82b3\u80aa\u8a2a\u653e\u6fc0\u8131\u8aac\u92ed\u66fd\u5897\u8d08\u6771\u68df\u51cd\u598a\u5ef7\u67d3\u71c3\u8cd3\u6b73\u770c\u6803\u5730\u6c60\u866b\u86cd\u86c7\u8679\u8776\u72ec\u8695\u98a8\u5df1\u8d77\u5983\u6539\u8a18\u5305\u80de\u7832\u6ce1\u4e80\u96fb\u7adc\u6edd\u8c5a\u9010\u9042\u5bb6\u5ac1\u8c6a\u8178\u5834\u6e6f\u7f8a\u7f8e\u6d0b\u8a73\u9bae\u9054\u7fa8\u5dee\u7740\u552f\u7126\u7901\u96c6\u51c6\u9032\u96d1\u96cc\u6e96\u596e\u596a\u78ba\u5348\u8a31\u6b53\u6a29\u89b3\u7fbd\u7fd2\u7fcc\u66dc\u6fef\u66f0\u56f0\u56fa\u56fd\u56e3\u56e0\u59fb\u5712\u56de\u58c7\u5e97\u5eab\u5ead\u5e81\u5e8a\u9ebb\u78e8\u5fc3\u5fd8\u5fcd\u8a8d\u5fcc\u5fd7\u8a8c\u5fe0\u4e32\u60a3\u601d\u6069\u5fdc\u610f\u60f3\u606f\u61a9\u6075\u6050\u60d1\u611f\u6182\u5be1\u5fd9\u60a6\u6052\u60bc\u609f\u6016\u614c\u6094\u618e\u6163\u6109\u60f0\u614e\u61be\u61b6\u6155\u6dfb\u5fc5\u6ccc\u624b\u770b\u6469\u6211\u7fa9\u8b70\u72a0\u62b9\u62b1\u642d\u6284\u6297\u6279\u62db\u62d3\u62cd\u6253\u62d8\u6368\u62d0\u6458\u6311\u6307\u6301\u62ec\u63ee\u63a8\u63da\u63d0\u640d\u62fe\u62c5\u62e0\u63cf\u64cd\u63a5\u63b2\u639b\u7814\u6212\u68b0\u9f3b\u5211\u578b\u624d\u8ca1\u6750\u5b58\u5728\u4e43\u643a\u53ca\u5438\u6271\u4e08\u53f2\u540f\u66f4\u786c\u53c8\u53cc\u6851\u96bb\u8b77\u7372\u5974\u6012\u53cb\u629c\u6295\u6ca1\u8a2d\u6483\u6bbb\u652f\u6280\u679d\u80a2\u830e\u602a\u8efd\u53d4\u7763\u5bc2\u6dd1\u53cd\u5742\u677f\u8fd4\u8ca9\u722a\u59a5\u4e73\u6d6e\u5c06\u5968\u63a1\u83dc\u53d7\u6388\u611b\u6255\u5e83\u62e1\u9271\u5f01\u96c4\u53f0\u6020\u6cbb\u59cb\u80ce\u7a93\u53bb\u6cd5\u4f1a\u81f3\u5ba4\u5230\u81f4\u4e92\u68c4\u80b2\u64a4\u5145\u9283\u786b\u6d41\u5141\u5506\u51fa\u5c71\u62d9\u5ca9\u70ad\u5c90\u5ce0\u5d29\u5bc6\u871c\u5d50\u5d0e\u5165\u8fbc\u5206\u8ca7\u9812\u516c\u677e\u7fc1\u8a1f\u8c37\u6d74\u5bb9\u6eb6\u6b32\u88d5\u925b\u6cbf\u8cde\u515a\u5802\u5e38\u88f3\u638c\u76ae\u6ce2\u5a46\u62ab\u7834\u88ab\u6b8b\u6b89\u6b8a\u6b96\u5217\u88c2\u70c8\u6b7b\u846c\u77ac\u8033\u53d6\u8da3\u6700\u64ae\u6065\u8077\u8056\u6562\u8074\u61d0\u6162\u6f2b\u8cb7\u7f6e\u7f70\u5be7\u6fc1\u74b0\u9084\u592b\u6276\u6e13\u898f\u66ff\u8cdb\u6f5c\u5931\u9244\u8fed\u81e3\u59eb\u8535\u81d3\u8ce2\u5805\u81e8\u89a7\u5de8\u62d2\u529b\u7537\u52b4\u52df\u52a3\u529f\u52e7\u52aa\u52b1\u52a0\u8cc0\u67b6\u8107\u8105\u5354\u884c\u5f8b\u5fa9\u5f97\u5f93\u5f92\u5f85\u5f80\u5f81\u5f84\u5f7c\u5f79\u5fb3\u5fb9\u5fb4\u61f2\u5fae\u8857\u8861\u7a3f\u7a3c\u7a0b\u7a0e\u7a1a\u548c\u79fb\u79d2\u79cb\u6101\u79c1\u79e9\u79d8\u79f0\u5229\u68a8\u7a6b\u7a42\u7a32\u9999\u5b63\u59d4\u79c0\u900f\u8a98\u7a40\u83cc\u7c73\u7c89\u7c98\u7c92\u7ca7\u8ff7\u7c8b\u7ce7\u83ca\u5965\u6570\u697c\u985e\u6f06\u69d8\u6c42\u7403\u6551\u7af9\u7b11\u7b20\u7b39\u7b4b\u7bb1\u7b46\u7b52\u7b49\u7b97\u7b54\u7b56\u7c3f\u7bc9\u4eba\u4f50\u4f46\u4f4f\u4f4d\u4ef2\u4f53\u60a0\u4ef6\u4ed5\u4ed6\u4f0f\u4f1d\u4ecf\u4f11\u4eee\u4f2f\u4fd7\u4fe1\u4f73\u4f9d\u4f8b\u500b\u5065\u5074\u4f8d\u505c\u5024\u5023\u5012\u5075\u50e7\u5104\u5100\u511f\u4ed9\u50ac\u4ec1\u4fae\u4f7f\u4fbf\u500d\u512a\u4f10\u5bbf\u50b7\u4fdd\u8912\u5091\u4ed8\u7b26\u5e9c\u4efb\u8cc3\u4ee3\u888b\u8cb8\u5316\u82b1\u8ca8\u50be\u4f55\u8377\u4fca\u508d\u4e45\u755d\u56da\u5185\u4e19\u67c4\u8089\u8150\u5ea7\u5352\u5098\u5301\u4ee5\u4f3c\u4f75\u74e6\u74f6\u5bae\u55b6\u5584\u5e74\u591c\u6db2\u585a\u5e63\u5f0a\u559a\u63db\u878d\u65bd\u65cb\u904a\u65c5\u52ff\u7269\u6613\u8cdc\u5c3f\u5c3c\u6ce5\u5840\u5c65\u5c4b\u63e1\u5c48\u6398\u5800\u5c45\u636e\u5c64\u5c40\u9045\u6f0f\u5237\u5c3a\u5c3d\u6ca2\u8a33\u629e\u663c\u6238\u80a9\u623f\u6247\u7089\u623b\u6d99\u96c7\u9867\u5553\u793a\u793c\u7965\u795d\u798f\u7949\u793e\u8996\u5948\u5c09\u6170\u6b3e\u7981\u895f\u5b97\u5d07\u796d\u5bdf\u64e6\u7531\u62bd\u6cb9\u8896\u5b99\u5c4a\u7b1b\u8ef8\u7532\u62bc\u5cac\u633f\u7533\u4f38\u795e\u635c\u679c\u83d3\u8ab2\u88f8\u65a4\u6790\u6240\u7948\u8fd1\u6298\u54f2\u901d\u8a93\u66ab\u6f38\u65ad\u8cea\u65a5\u8a34\u6628\u8a50\u4f5c\u96ea\u9332\u5c0b\u6025\u7a4f\u4fb5\u6d78\u5bdd\u5a66\u6383\u5f53\u4e89\u6d44\u4e8b\u5510\u7cd6\u5eb7\u902e\u4f0a\u541b\u7fa4\u8010\u9700\u5112\u7aef\u4e21\u6e80\u753b\u6b6f\u66f2\u66f9\u906d\u6f15\u69fd\u6597\u6599\u79d1\u56f3\u7528\u5eb8\u5099\u6614\u932f\u501f\u60dc\u63aa\u6563\u5eff\u5eb6\u906e\u5e2d\u5ea6\u6e21\u5954\u5674\u58b3\u61a4\u713c\u6681\u534a\u4f34\u7554\u5224\u5238\u5dfb\u570f\u52dd\u85e4\u8b04\u7247\u7248\u4e4b\u4e4f\u829d\u4e0d\u5426\u676f\u77e2\u77ef\u65cf\u77e5\u667a\u77db\u67d4\u52d9\u9727\u73ed\u5e30\u5f13\u5f15\u5f14\u5f18\u5f37\u5f31\u6cb8\u8cbb\u7b2c\u5f1f\u5de7\u53f7\u673d\u8a87\u6c5a\u4e0e\u5199\u8eab\u5c04\u8b1d\u8001\u8003\u5b5d\u6559\u62f7\u8005\u716e\u8457\u7f72\u6691\u8af8\u732a\u6e1a\u8ced\u5ce1\u72ed\u631f\u8ffd\u5e2b\u5e25\u5b98\u68fa\u7ba1\u7236\u4ea4\u52b9\u8f03\u6821\u8db3\u4fc3\u8ddd\u8def\u9732\u8df3\u8e8d\u8df5\u8e0f\u9aa8\u6ed1\u9ac4\u798d\u6e26\u904e\u962a\u963f\u969b\u969c\u968f\u966a\u967d\u9673\u9632\u9644\u9662\u9663\u968a\u589c\u964d\u968e\u965b\u96a3\u9694\u96a0\u5815\u9665\u7a74\u7a7a\u63a7\u7a81\u7a76\u7a92\u7a83\u7aaa\u643e\u7aaf\u7aae\u63a2\u6df1\u4e18\u5cb3\u5175\u6d5c\u7cf8\u7e54\u7e55\u7e2e\u7e41\u7e26\u7dda\u7de0\u7dad\u7f85\u7df4\u7dd2\u7d9a\u7d75\u7d71\u7d5e\u7d66\u7d61\u7d50\u7d42\u7d1a\u7d00\u7d05\u7d0d\u7d21\u7d1b\u7d39\u7d4c\u7d33\u7d04\u7d30\u7d2f\u7d22\u7dcf\u7dbf\u7d79\u7e70\u7d99\u7dd1\u7e01\u7db2\u7dca\u7d2b\u7e1b\u7e04\u5e7c\u5f8c\u5e7d\u5e7e\u6a5f\u7384\u755c\u84c4\u5f26\u64c1\u6ecb\u6148\u78c1\u7cfb\u4fc2\u5b6b\u61f8\u5374\u811a\u5378\u5fa1\u670d\u547d\u4ee4\u96f6\u9f62\u51b7\u9818\u9234\u52c7\u901a\u8e0a\u7591\u64ec\u51dd\u7bc4\u72af\u5384\u5371\u5b9b\u8155\u82d1\u6028\u67f3\u5375\u7559\u8cbf\u5370\u8208\u9149\u9152\u914c\u9175\u9177\u916c\u916a\u9162\u9154\u914d\u9178\u7336\u5c0a\u8c46\u982d\u77ed\u8c4a\u9f13\u559c\u6a39\u76bf\u8840\u76c6\u76df\u76d7\u6e29\u76e3\u6feb\u9451\u731b\u76db\u5869\u9280\u6068\u6839\u5373\u7235\u7bc0\u9000\u9650\u773c\u826f\u6717\u6d6a\u5a18\u98df\u98ef\u98f2\u98e2\u9913\u98fe\u9928\u990a\u98fd\u65e2\u6982\u6168\u5e73\u547c\u576a\u8a55\u5208\u5e0c\u51f6\u80f8\u96e2\u6bba\u7d14\u920d\u8f9b\u8f9e\u6893\u5bb0\u58c1\u907f\u65b0\u85aa\u89aa\u5e78\u57f7\u5831\u53eb\u7cfe\u53ce\u5351\u7891\u9678\u7766\u52e2\u71b1\u83f1\u9675\u4ea5\u6838\u523b\u8a72\u52be\u8ff0\u8853\u5bd2\u91b8\u8b72\u58cc\u5b22\u6bd2\u7d20\u9ea6\u9752\u7cbe\u8acb\u60c5\u6674\u6e05\u9759\u8cac\u7e3e\u7a4d\u50b5\u6f2c\u8868\u4ff5\u6f54\u5951\u55ab\u5bb3\u8f44\u5272\u61b2\u751f\u661f\u59d3\u6027\u7272\u7523\u9686\u5cf0\u7e2b\u62dd\u5bff\u92f3\u7c4d\u6625\u693f\u6cf0\u594f\u5b9f\u5949\u4ff8\u68d2\u8b39\u52e4\u6f22\u5606\u96e3\u83ef\u5782\u7761\u9318\u4e57\u5270\u4eca\u542b\u541f\u5ff5\u7434\u9670\u4e88\u5e8f\u9810\u91ce\u517c\u5acc\u938c\u8b19\u5ec9\u897f\u4fa1\u8981\u8170\u7968\u6f02\u6a19\u6817\u9077\u8986\u7159\u5357\u6960\u732e\u9580\u554f\u95b2\u95a5\u9593\u7c21\u958b\u9589\u95a3\u9591\u805e\u6f64\u6b04\u95d8\u5009\u5275\u975e\u4ff3\u6392\u60b2\u7f6a\u8f29\u6249\u4faf\u5019\u6c7a\u5feb\u5049\u9055\u7def\u885b\u97d3\u5e72\u809d\u520a\u6c57\u8ed2\u5cb8\u5e79\u828b\u5b87\u4f59\u9664\u5f90\u53d9\u9014\u659c\u5857\u675f\u983c\u702c\u52c5\u758e\u901f\u6574\u5263\u967a\u691c\u5039\u91cd\u52d5\u52f2\u50cd\u7a2e\u885d\u85ab\u75c5\u75f4\u75d8\u75c7\u75be\u75e2\u75b2\u75ab\u75db\u7656\u533f\u5320\u533b\u5339\u533a\u67a2\u6bb4\u6b27\u6291\u4ef0\u8fce\u767b\u6f84\u767a\u5ec3\u50da\u5bee\u7642\u5f6b\u5f62\u5f71\u6749\u5f69\u5f70\u5f66\u9854\u9808\u81a8\u53c2\u60e8\u4fee\u73cd\u8a3a\u6587\u5bfe\u7d0b\u868a\u6589\u5264\u6e08\u658e\u7c9b\u5841\u697d\u85ac\u7387\u6e0b\u6442\u592e\u82f1\u6620\u8d64\u8d66\u5909\u8de1\u86ee\u604b\u6e7e\u9ec4\u6a2a\u628a\u8272\u7d76\u8276\u80a5\u7518\u7d3a\u67d0\u8b00\u5a92\u6b3a\u68cb\u65d7\u671f\u7881\u57fa\u751a\u52d8\u582a\u8cb4\u907a\u9063\u821e\u7121\u7d44\u7c97\u79df\u7956\u963b\u67fb\u52a9\u5b9c\u7573\u4e26\u666e\u8b5c\u6e7f\u9855\u7e4a\u970a\u696d\u64b2\u50d5\u5171\u4f9b\u7570\u7ffc\u6d2a\u6e2f\u66b4\u7206\u606d\u9078\u6bbf\u4e95\u56f2\u8015\u4e9c\u60aa\u5186\u89d2\u89e6\u89e3\u518d\u8b1b\u8cfc\u69cb\u6e9d\u8ad6\u502b\u8f2a\u504f\u904d\u7de8\u518a\u5178\u6c0f\u7d19\u5a5a\u4f4e\u62b5\u5e95\u6c11\u7720\u6355\u6d66\u84b2\u8217\u88dc\u90b8\u90ed\u90e1\u90ca\u90e8\u90fd\u90f5\u90a6\u90f7\u97ff\u90ce\u5eca\u76fe\u5faa\u6d3e\u8108\u8846\u9013\u6bb5\u935b\u540e\u5e7b\u53f8\u4f3a\u8a5e\u98fc\u55e3\u821f\u8236\u822a\u822c\u76e4\u642c\u8239\u8266\u8247\u74dc\u5f27\u5b64\u7e6d\u76ca\u6687\u6577\u6765\u6c17\u6c7d\u98db\u6c88\u59bb\u8870\u8877\u9762\u9769\u9774\u8987\u58f0\u5449\u5a2f\u8aa4\u84b8\u627f\u51fd\u6975\u7259\u82bd\u90aa\u96c5\u91c8\u756a\u5be9\u7ffb\u85e9\u6bdb\u8017\u5c3e\u5b85\u8a17\u70ba\u507d\u9577\u5f35\u5e33\u8139\u9aea\u5c55\u55aa\u5de3\u5358\u6226\u7985\u5f3e\u685c\u7363\u8133\u60a9\u53b3\u9396\u6319\u8a89\u731f\u9ce5\u9cf4\u9db4\u70cf\u8526\u9ce9\u9d8f\u5cf6\u6696\u5a9b\u63f4\u7de9\u5c5e\u5631\u5076\u9047\u611a\u9685\u9006\u5851\u5ca1\u92fc\u7db1\u525b\u7f36\u9676\u63fa\u8b21\u5c31\u61c7\u58be\u514d\u9038\u6669\u52c9\u8c61\u50cf\u99ac\u99d2\u9a13\u9a0e\u99d0\u99c6\u99c5\u9a12\u99c4\u9a5a\u7be4\u9a30\u864e\u865c\u819a\u865a\u622f\u865e\u616e\u5287\u8650\u9e7f\u85a6\u6176\u9e97\u718a\u80fd\u614b\u5bc5\u6f14\u8fb0\u8fb1\u9707\u632f\u5a20\u5507\u8fb2\u6fc3\u9001\u95a2\u54b2\u9b3c\u919c\u9b42\u9b54\u9b45\u584a\u8972\u5687\u6715\u96f0\u7b87\u932c\u9075\u7f77\u5c6f\u4e14\u85fb\u96b7\u7652\u4e39\u6f5f\u4e11\u536f\u5df3';


function xpath(query) {
	return document.evaluate(query, document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
}
function xpathi(query) {
	return xpath(query).snapshotItem(0);
}

function isKanji(char) {
	return ((char >= '\u4e00') && (char <= '\u9fff'))
		 || ((char >= '\u3400') && (char <= '\u4dbf'));
}

function isInRtK1(char) {
	return (kklist.indexOf(char) != -1);
}


function countCharIf(str, cond) {
	var cnt = 0;
	for (idx = 0; idx < str.length; idx++) {
		if (cond(str[idx])) cnt++;
	}
	return cnt;
}

function extractText(el) {
	var text = '';
	for (var node = el.firstChild; node; node = node.nextSibling) {
		switch (node.nodeType) {
		case 3:
			text += node.data;
			break;
		case 1:
			text += extractText(node);
			break;
		}
	}
	return text;
}

function addChild(parent, type, settings, sibling) {
	var child = document.createElement(type);
	for (var key in settings) {
		child[key] = settings[key];
	}
	if (sibling) parent.insertBefore(child, sibling);
	else parent.appendChild(child);
	return child;
}

function addText(parent, text) {
	return parent.appendChild(document.createTextNode(text));
}

// Sight reading page
if (/sightreading/i.test(window.location.href)) {
	var result = xpathi('//div[@id="results"]/p[@class="j"]');
	if (!result) return;
	var text = extractText(result);
	var total = countCharIf(text, isKanji);
	if (total == 0) return;
	var countSection = addChild(result.parentNode, 'p');
	addText(countSection, 'Number of kanji: ' + total);
	addChild(countSection, 'br');
	var currentLevel = result.getElementsByTagName('a').length;
	addText(countSection, 'Your current level: ' + currentLevel + ' (' + Math.round(100 * currentLevel / total) + '%)');
	var rtk1Level = countCharIf(text, isInRtK1);
	addChild(countSection, 'br');
	addText(countSection, 'After completing RtK1: ' + rtk1Level + ' (' + Math.round(100 * rtk1Level / total) + '%)');
	return;
}