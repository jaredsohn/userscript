// ==UserScript==

// @name          Jasmine on Grease

// @namespace     http://www.sovas.lv

// @description   Run and Save Jasmine Tests from GreaseMonkey

// @include      *

// ==/UserScript==

/* mousetrap v1.2.2 craig.is/killing/mice */


/** Make configurable Options **/
var mapping = true;
var mappingUrl = 'your_url_please';
var priorityInternal = false;


/** EndThis **/



(function(){function q(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent("on"+c,b)}function x(a){return"keypress"==a.type?String.fromCharCode(a.which):h[a.which]?h[a.which]:y[a.which]?y[a.which]:String.fromCharCode(a.which).toLowerCase()}function r(a,c){var a=a||{},b=!1,d;for(d in l)a[d]&&l[d]>c?b=!0:l[d]=0;b||(n=!1)}function z(a,c,b,d,F){var g,e,f=[],j=b.type;if(!k[a])return[];"keyup"==j&&s(a)&&(c=[a]);for(g=0;g<k[a].length;++g)if(e=k[a][g],!(e.seq&&l[e.seq]!=e.level)&&j==e.action&&
("keypress"==j&&!b.metaKey&&!b.ctrlKey||c.sort().join(",")===e.modifiers.sort().join(",")))d&&e.combo==F&&k[a].splice(g,1),f.push(e);return f}function t(a,c,b){if(!u.stopCallback(c,c.target||c.srcElement,b)&&!1===a(c,b))c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.returnValue=!1,c.cancelBubble=!0}function v(a){"number"!==typeof a.which&&(a.which=a.keyCode);var c=x(a);if(c)if("keyup"==a.type&&w==c)w=!1;else{var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");
a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");var b=z(c,b,a),d,f={},g=0,e=!1;for(d=0;d<b.length;++d)b[d].seq?(e=!0,g=Math.max(g,b[d].level),f[b[d].seq]=1,t(b[d].callback,a,b[d].combo)):!e&&!n&&t(b[d].callback,a,b[d].combo);a.type==n&&!s(c)&&r(f,g)}}function s(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function A(a,c,b){if(!b){if(!p){p={};for(var d in h)95<d&&112>d||h.hasOwnProperty(d)&&(p[h[d]]=d)}b=p[a]?"keydown":"keypress"}"keypress"==b&&c.length&&(b="keydown");return b}function B(a,
c,b,d,f){var a=a.replace(/\s+/g," "),g=a.split(" "),e,h,j=[];if(1<g.length){var i=a,m=b;l[i]=0;m||(m=A(g[0],[]));a=function(){n=m;++l[i];clearTimeout(C);C=setTimeout(r,1E3)};b=function(a){t(c,a,i);"keyup"!==m&&(w=x(a));setTimeout(r,10)};for(d=0;d<g.length;++d)B(g[d],d<g.length-1?a:b,m,i,d)}else{h="+"===a?["+"]:a.split("+");for(g=0;g<h.length;++g)e=h[g],D[e]&&(e=D[e]),b&&("keypress"!=b&&E[e])&&(e=E[e],j.push("shift")),s(e)&&j.push(e);b=A(e,j,b);k[e]||(k[e]=[]);z(e,j,{type:b},!d,a);k[e][d?"unshift":
"push"]({callback:c,modifiers:j,action:b,seq:d,level:f,combo:a})}}for(var h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},E={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7",
"*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},D={option:"alt",command:"meta","return":"enter",escape:"esc"},p,k={},i={},l={},C,w=!1,n=!1,f=1;20>f;++f)h[111+f]="f"+f;for(f=0;9>=f;++f)h[f+96]=f;q(document,"keypress",v);q(document,"keydown",v);q(document,"keyup",v);var u={bind:function(a,c,b){for(var d=a instanceof Array?a:[a],f=0;f<d.length;++f)B(d[f],c,b);i[a+":"+b]=c;return this},unbind:function(a,c){i[a+":"+c]&&(delete i[a+":"+c],this.bind(a,function(){},
c));return this},trigger:function(a,c){i[a+":"+c]();return this},reset:function(){k={};i={};return this},stopCallback:function(a,c){return-1<(" "+c.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==c.tagName||"SELECT"==c.tagName||"TEXTAREA"==c.tagName||c.contentEditable&&"true"==c.contentEditable}};window.Mousetrap=u;"function"===typeof define&&define.amd&&define(u)})();

//MiniFied Part http://marijnhaverbeke.nl/uglifyjs

//css miniFied with http://cssminifier.com/
var jasCss = 'body{background-color:#eee;padding:0;margin:5px;overflow-y:scroll}#HTMLReporter{font-size:11px;font-family:Monaco,"Lucida Console",monospace;line-height:14px;color:#333}#HTMLReporter a{text-decoration:none}#HTMLReporter a:hover{text-decoration:underline}#HTMLReporter p,#HTMLReporter h1,#HTMLReporter h2,#HTMLReporter h3,#HTMLReporter h4,#HTMLReporter h5,#HTMLReporter h6{margin:0;line-height:14px}#HTMLReporter .banner,#HTMLReporter .symbolSummary,#HTMLReporter .summary,#HTMLReporter .resultMessage,#HTMLReporter .specDetail .description,#HTMLReporter .alert .bar,#HTMLReporter .stackTrace{padding-left:9px;padding-right:9px}#HTMLReporter #jasmine_content{position:fixed;right:100%}#HTMLReporter .version{color:#aaa}#HTMLReporter .banner{margin-top:14px}#HTMLReporter .duration{color:#aaa;float:right}#HTMLReporter .symbolSummary{overflow:hidden;*zoom:1;margin:14px 0}#HTMLReporter .symbolSummary li{display:block;float:left;height:7px;width:14px;margin-bottom:7px;font-size:16px}#HTMLReporter .symbolSummary li.passed{font-size:14px}#HTMLReporter .symbolSummary li.passed:before{color:#5e7d00;content:"\02022"}#HTMLReporter .symbolSummary li.failed{line-height:9px}#HTMLReporter .symbolSummary li.failed:before{color:#b03911;content:"x";font-weight:bold;margin-left:-1px}#HTMLReporter .symbolSummary li.skipped{font-size:14px}#HTMLReporter .symbolSummary li.skipped:before{color:#bababa;content:"\02022"}#HTMLReporter .symbolSummary li.pending{line-height:11px}#HTMLReporter .symbolSummary li.pending:before{color:#aaa;content:"-"}#HTMLReporter .exceptions{color:#fff;float:right;margin-top:5px;margin-right:5px}#HTMLReporter .bar{line-height:28px;font-size:14px;display:block;color:#eee}#HTMLReporter .runningAlert{background-color:#666}#HTMLReporter .skippedAlert{background-color:#aaa}#HTMLReporter .skippedAlert:first-child{background-color:#333}#HTMLReporter .skippedAlert:hover{text-decoration:none;color:white;text-decoration:underline}#HTMLReporter .passingAlert{background-color:#a6b779}#HTMLReporter .passingAlert:first-child{background-color:#5e7d00}#HTMLReporter .failingAlert{background-color:#cf867e}#HTMLReporter .failingAlert:first-child{background-color:#b03911}#HTMLReporter .results{margin-top:14px}#HTMLReporter #details{display:none}#HTMLReporter .resultsMenu,#HTMLReporter .resultsMenu a{background-color:#fff;color:#333}#HTMLReporter.showDetails .summaryMenuItem{font-weight:normal;text-decoration:inherit}#HTMLReporter.showDetails .summaryMenuItem:hover{text-decoration:underline}#HTMLReporter.showDetails .detailsMenuItem{font-weight:bold;text-decoration:underline}#HTMLReporter.showDetails .summary{display:none}#HTMLReporter.showDetails #details{display:block}#HTMLReporter .summaryMenuItem{font-weight:bold;text-decoration:underline}#HTMLReporter .summary{margin-top:14px}#HTMLReporter .summary .suite .suite,#HTMLReporter .summary .specSummary{margin-left:14px}#HTMLReporter .summary .specSummary.passed a{color:#5e7d00}#HTMLReporter .summary .specSummary.failed a{color:#b03911}#HTMLReporter .description+.suite{margin-top:0}#HTMLReporter .suite{margin-top:14px}#HTMLReporter .suite a{color:#333}#HTMLReporter #details .specDetail{margin-bottom:28px}#HTMLReporter #details .specDetail .description{display:block;color:white;background-color:#b03911}#HTMLReporter .resultMessage{padding-top:14px;color:#333}#HTMLReporter .resultMessage span.result{display:block}#HTMLReporter .stackTrace{margin:5px 0 0 0;max-height:224px;overflow:auto;line-height:18px;color:#666;border:1px solid #ddd;background:white;white-space:pre}#TrivialReporter{padding:8px 13px;position:absolute;top:0;bottom:0;left:0;right:0;overflow-y:scroll;background-color:white;font-family:"Helvetica Neue Light","Lucida Grande","Calibri","Arial",sans-serif}#TrivialReporter a:visited,#TrivialReporter a{color:#303}#TrivialReporter a:hover,#TrivialReporter a:active{color:blue}#TrivialReporter .run_spec{float:right;padding-right:5px;font-size:.8em;text-decoration:none}#TrivialReporter .banner{color:#303;background-color:#fef;padding:5px}#TrivialReporter .logo{float:left;font-size:1.1em;padding-left:5px}#TrivialReporter .logo .version{font-size:.6em;padding-left:1em}#TrivialReporter .runner.running{background-color:yellow}#TrivialReporter .options{text-align:right;font-size:.8em}#TrivialReporter .suite{border:1px outset gray;margin:5px 0;padding-left:1em}#TrivialReporter .suite .suite{margin:5px}#TrivialReporter .suite.passed{background-color:#dfd}#TrivialReporter .suite.failed{background-color:#fdd}#TrivialReporter .spec{margin:5px;padding-left:1em;clear:both}#TrivialReporter .spec.failed,#TrivialReporter .spec.passed,#TrivialReporter .spec.skipped{padding-bottom:5px;border:1px solid gray}#TrivialReporter .spec.failed{background-color:#fbb;border-color:red}#TrivialReporter .spec.passed{background-color:#bfb;border-color:green}#TrivialReporter .spec.skipped{background-color:#bbb}#TrivialReporter .messages{border-left:1px dashed gray;padding-left:1em;padding-right:1em}#TrivialReporter .passed{background-color:#cfc;display:none}#TrivialReporter .failed{background-color:#fbb}#TrivialReporter .skipped{color:#777;background-color:#eee;display:none}#TrivialReporter .resultMessage span.result{display:block;line-height:2em;color:black}#TrivialReporter .resultMessage .mismatch{color:black}#TrivialReporter .stackTrace{white-space:pre;font-size:.8em;margin-left:10px;max-height:5em;overflow:auto;border:1px inset red;padding:1em;background:#eef}#TrivialReporter .finished-at{padding-left:1em;font-size:.6em}#TrivialReporter.show-passed .passed,#TrivialReporter.show-skipped .skipped{display:block}#TrivialReporter #jasmine_content{position:fixed;right:100%}#TrivialReporter .runner{border:1px solid gray;display:block;margin:5px 0;padding:2px 0 2px 10px}';

var JasmineHtml = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title></title><script type="text/javascript">(function(){var jasmineEnv=jasmine.getEnv();jasmineEnv.updateInterval=1000;var htmlReporter=new jasmine.HtmlReporter();jasmineEnv.addReporter(htmlReporter);jasmineEnv.specFilter=function(spec){return htmlReporter.specFilter(spec);};var currentWindowOnload=window.onload;window.onload=function(){if (currentWindowOnload){currentWindowOnload();}execJasmine();};function execJasmine(){jasmineEnv.execute();}})();</script></head><body></body></html>';

var jasmineStaticTemplate = '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Jasmine Spec Runner</title><link rel="stylesheet" type="text/css" href="'+ mappingUrl +'lib/jasmine.css"><script type="text/javascript" src="'+ mappingUrl+'lib/jasmine.js"></script><script type="text/javascript" src="'+ mappingUrl +'lib/jasmine-html.js"></script><script type="text/javascript" src="'+ mappingUrl +'lib/exec.js"></script><script type="text/javascript">(execLauncher())();</script></head><body></body></html>';
//document.getElementById("p1").innerHTML

//JasmineCore
var isCommonJS="undefined"==typeof unsafeWindow&&"object"==typeof exports,jasmine={};isCommonJS&&(exports.jasmine=jasmine),jasmine.unimplementedMethod_=function(){throw Error("unimplemented method")},jasmine.undefined=jasmine.___undefined___,jasmine.VERBOSE=!1,jasmine.DEFAULT_UPDATE_INTERVAL=250,jasmine.MAX_PRETTY_PRINT_DEPTH=40,jasmine.DEFAULT_TIMEOUT_INTERVAL=5e3,jasmine.CATCH_EXCEPTIONS=!0,jasmine.getGlobal=function(){function a(){return this}return a()},jasmine.bindOriginal_=function(a,b){var c=a[b];return c.apply?function(){return c.apply(a,arguments)}:jasmine.getGlobal()[b]},jasmine.setTimeout=jasmine.bindOriginal_(jasmine.getGlobal(),"setTimeout"),jasmine.clearTimeout=jasmine.bindOriginal_(jasmine.getGlobal(),"clearTimeout"),jasmine.setInterval=jasmine.bindOriginal_(jasmine.getGlobal(),"setInterval"),jasmine.clearInterval=jasmine.bindOriginal_(jasmine.getGlobal(),"clearInterval"),jasmine.MessageResult=function(a){this.type="log",this.values=a,this.trace=Error()},jasmine.MessageResult.prototype.toString=function(){for(var a="",b=0;this.values.length>b;b++)b>0&&(a+=" "),a+=jasmine.isString_(this.values[b])?this.values[b]:jasmine.pp(this.values[b]);return a},jasmine.ExpectationResult=function(a){this.type="expect",this.matcherName=a.matcherName,this.passed_=a.passed,this.expected=a.expected,this.actual=a.actual,this.message=this.passed_?"Passed.":a.message;var b=a.trace||Error(this.message);this.trace=this.passed_?"":b},jasmine.ExpectationResult.prototype.toString=function(){return this.message},jasmine.ExpectationResult.prototype.passed=function(){return this.passed_},jasmine.getEnv=function(){var a=jasmine.currentEnv_=jasmine.currentEnv_||new jasmine.Env;return a},jasmine.isArray_=function(a){return jasmine.isA_("Array",a)},jasmine.isString_=function(a){return jasmine.isA_("String",a)},jasmine.isNumber_=function(a){return jasmine.isA_("Number",a)},jasmine.isA_=function(a,b){return Object.prototype.toString.apply(b)==="[object "+a+"]"},jasmine.pp=function(a){var b=new jasmine.StringPrettyPrinter;return b.format(a),b.string},jasmine.isDomNode=function(a){return a.nodeType>0},jasmine.any=function(a){return new jasmine.Matchers.Any(a)},jasmine.objectContaining=function(a){return new jasmine.Matchers.ObjectContaining(a)},jasmine.Spy=function(a){this.identity=a||"unknown",this.isSpy=!0,this.plan=function(){},this.mostRecentCall={},this.argsForCall=[],this.calls=[]},jasmine.Spy.prototype.andCallThrough=function(){return this.plan=this.originalValue,this},jasmine.Spy.prototype.andReturn=function(a){return this.plan=function(){return a},this},jasmine.Spy.prototype.andThrow=function(a){return this.plan=function(){throw a},this},jasmine.Spy.prototype.andCallFake=function(a){return this.plan=a,this},jasmine.Spy.prototype.reset=function(){this.wasCalled=!1,this.callCount=0,this.argsForCall=[],this.calls=[],this.mostRecentCall={}},jasmine.createSpy=function(a){var b=function(){b.wasCalled=!0,b.callCount++;var a=jasmine.util.argsToArray(arguments);return b.mostRecentCall.object=this,b.mostRecentCall.args=a,b.argsForCall.push(a),b.calls.push({object:this,args:a}),b.plan.apply(this,arguments)},c=new jasmine.Spy(a);for(var d in c)b[d]=c[d];return b.reset(),b},jasmine.isSpy=function(a){return a&&a.isSpy},jasmine.createSpyObj=function(a,b){if(!jasmine.isArray_(b)||0===b.length)throw Error("createSpyObj requires a non-empty array of method names to create spies for");for(var c={},d=0;b.length>d;d++)c[b[d]]=jasmine.createSpy(a+"."+b[d]);return c},jasmine.log=function(){var a=jasmine.getEnv().currentSpec;a.log.apply(a,arguments)};var spyOn=function(a,b){return jasmine.getEnv().currentSpec.spyOn(a,b)};isCommonJS&&(exports.spyOn=spyOn);var it=function(a,b){return jasmine.getEnv().it(a,b)};isCommonJS&&(exports.it=it);var xit=function(a,b){return jasmine.getEnv().xit(a,b)};isCommonJS&&(exports.xit=xit);var expect=function(a){return jasmine.getEnv().currentSpec.expect(a)};isCommonJS&&(exports.expect=expect);var runs=function(a){jasmine.getEnv().currentSpec.runs(a)};isCommonJS&&(exports.runs=runs);var waits=function(a){jasmine.getEnv().currentSpec.waits(a)};isCommonJS&&(exports.waits=waits);var waitsFor=function(){jasmine.getEnv().currentSpec.waitsFor.apply(jasmine.getEnv().currentSpec,arguments)};isCommonJS&&(exports.waitsFor=waitsFor);var beforeEach=function(a){jasmine.getEnv().beforeEach(a)};isCommonJS&&(exports.beforeEach=beforeEach);var afterEach=function(a){jasmine.getEnv().afterEach(a)};isCommonJS&&(exports.afterEach=afterEach);var describe=function(a,b){return jasmine.getEnv().describe(a,b)};isCommonJS&&(exports.describe=describe);var xdescribe=function(a,b){return jasmine.getEnv().xdescribe(a,b)};isCommonJS&&(exports.xdescribe=xdescribe),jasmine.XmlHttpRequest="undefined"==typeof XMLHttpRequest?function(){function a(a){try{return a()}catch(b){}return null}var b=a(function(){return new ActiveXObject("Msxml2.XMLHTTP.6.0")})||a(function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")})||a(function(){return new ActiveXObject("Msxml2.XMLHTTP")})||a(function(){return new ActiveXObject("Microsoft.XMLHTTP")});if(!b)throw Error("This browser does not support XMLHttpRequest.");return b}:XMLHttpRequest,jasmine.util={},jasmine.util.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},jasmine.util.formatException=function(a){var b;a.line?b=a.line:a.lineNumber&&(b=a.lineNumber);var c;a.sourceURL?c=a.sourceURL:a.fileName&&(c=a.fileName);var d=a.name&&a.message?a.name+": "+a.message:""+a;return c&&b&&(d+=" in "+c+" (line "+b+")"),d},jasmine.util.htmlEscape=function(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},jasmine.util.argsToArray=function(a){for(var b=[],c=0;a.length>c;c++)b.push(a[c]);return b},jasmine.util.extend=function(a,b){for(var c in b)a[c]=b[c];return a},jasmine.Env=function(){this.currentSpec=null,this.currentSuite=null,this.currentRunner_=new jasmine.Runner(this),this.reporter=new jasmine.MultiReporter,this.updateInterval=jasmine.DEFAULT_UPDATE_INTERVAL,this.defaultTimeoutInterval=jasmine.DEFAULT_TIMEOUT_INTERVAL,this.lastUpdate=0,this.specFilter=function(){return!0},this.nextSpecId_=0,this.nextSuiteId_=0,this.equalityTesters_=[],this.matchersClass=function(){jasmine.Matchers.apply(this,arguments)},jasmine.util.inherit(this.matchersClass,jasmine.Matchers),jasmine.Matchers.wrapInto_(jasmine.Matchers.prototype,this.matchersClass)},jasmine.Env.prototype.setTimeout=jasmine.setTimeout,jasmine.Env.prototype.clearTimeout=jasmine.clearTimeout,jasmine.Env.prototype.setInterval=jasmine.setInterval,jasmine.Env.prototype.clearInterval=jasmine.clearInterval,jasmine.Env.prototype.version=function(){if(jasmine.version_)return jasmine.version_;throw Error("Version not set")},jasmine.Env.prototype.versionString=function(){if(!jasmine.version_)return"version unknown";var a=this.version(),b=a.major+"."+a.minor+"."+a.build;return a.release_candidate&&(b+=".rc"+a.release_candidate),b+=" revision "+a.revision},jasmine.Env.prototype.nextSpecId=function(){return this.nextSpecId_++},jasmine.Env.prototype.nextSuiteId=function(){return this.nextSuiteId_++},jasmine.Env.prototype.addReporter=function(a){this.reporter.addReporter(a)},jasmine.Env.prototype.execute=function(){this.currentRunner_.execute()},jasmine.Env.prototype.describe=function(a,b){var c=new jasmine.Suite(this,a,b,this.currentSuite),d=this.currentSuite;d?d.add(c):this.currentRunner_.add(c),this.currentSuite=c;var e=null;try{b.call(c)}catch(f){e=f}return e&&this.it("encountered a declaration exception",function(){throw e}),this.currentSuite=d,c},jasmine.Env.prototype.beforeEach=function(a){this.currentSuite?this.currentSuite.beforeEach(a):this.currentRunner_.beforeEach(a)},jasmine.Env.prototype.currentRunner=function(){return this.currentRunner_},jasmine.Env.prototype.afterEach=function(a){this.currentSuite?this.currentSuite.afterEach(a):this.currentRunner_.afterEach(a)},jasmine.Env.prototype.xdescribe=function(){return{execute:function(){}}},jasmine.Env.prototype.it=function(a,b){var c=new jasmine.Spec(this,this.currentSuite,a);return this.currentSuite.add(c),this.currentSpec=c,b&&c.runs(b),c},jasmine.Env.prototype.xit=function(){return{id:this.nextSpecId(),runs:function(){}}},jasmine.Env.prototype.compareRegExps_=function(a,b,c,d){return a.source!=b.source&&d.push("expected pattern /"+b.source+"/ is not equal to the pattern /"+a.source+"/"),a.ignoreCase!=b.ignoreCase&&d.push("expected modifier i was"+(b.ignoreCase?" ":" not ")+"set and does not equal the origin modifier"),a.global!=b.global&&d.push("expected modifier g was"+(b.global?" ":" not ")+"set and does not equal the origin modifier"),a.multiline!=b.multiline&&d.push("expected modifier m was"+(b.multiline?" ":" not ")+"set and does not equal the origin modifier"),a.sticky!=b.sticky&&d.push("expected modifier y was"+(b.sticky?" ":" not ")+"set and does not equal the origin modifier"),0===d.length},jasmine.Env.prototype.compareObjects_=function(a,b,c,d){if(a.__Jasmine_been_here_before__===b&&b.__Jasmine_been_here_before__===a)return!0;a.__Jasmine_been_here_before__=b,b.__Jasmine_been_here_before__=a;var e=function(a,b){return null!==a&&a[b]!==jasmine.undefined};for(var f in b)!e(a,f)&&e(b,f)&&c.push("expected has key '"+f+"', but missing from actual.");for(f in a)!e(b,f)&&e(a,f)&&c.push("expected missing key '"+f+"', but present in actual.");for(f in b)"__Jasmine_been_here_before__"!=f&&(this.equals_(a[f],b[f],c,d)||d.push("'"+f+"' was '"+(b[f]?jasmine.util.htmlEscape(""+b[f]):b[f])+"' in expected, but was '"+(a[f]?jasmine.util.htmlEscape(""+a[f]):a[f])+"' in actual."));return jasmine.isArray_(a)&&jasmine.isArray_(b)&&a.length!=b.length&&d.push("arrays were not the same length"),delete a.__Jasmine_been_here_before__,delete b.__Jasmine_been_here_before__,0===c.length&&0===d.length},jasmine.Env.prototype.equals_=function(a,b,c,d){c=c||[],d=d||[];for(var e=0;this.equalityTesters_.length>e;e++){var f=this.equalityTesters_[e],g=f(a,b,this,c,d);if(g!==jasmine.undefined)return g}return a===b?!0:a===jasmine.undefined||null===a||b===jasmine.undefined||null===b?a==jasmine.undefined&&b==jasmine.undefined:jasmine.isDomNode(a)&&jasmine.isDomNode(b)?a===b:a instanceof Date&&b instanceof Date?a.getTime()==b.getTime():a.jasmineMatches?a.jasmineMatches(b):b.jasmineMatches?b.jasmineMatches(a):a instanceof jasmine.Matchers.ObjectContaining?a.matches(b):b instanceof jasmine.Matchers.ObjectContaining?b.matches(a):jasmine.isString_(a)&&jasmine.isString_(b)?a==b:jasmine.isNumber_(a)&&jasmine.isNumber_(b)?a==b:a instanceof RegExp&&b instanceof RegExp?this.compareRegExps_(a,b,c,d):"object"==typeof a&&"object"==typeof b?this.compareObjects_(a,b,c,d):a===b},jasmine.Env.prototype.contains_=function(a,b){if(jasmine.isArray_(a)){for(var c=0;a.length>c;c++)if(this.equals_(a[c],b))return!0;return!1}return a.indexOf(b)>=0},jasmine.Env.prototype.addEqualityTester=function(a){this.equalityTesters_.push(a)},jasmine.Reporter=function(){},jasmine.Reporter.prototype.reportRunnerStarting=function(){},jasmine.Reporter.prototype.reportRunnerResults=function(){},jasmine.Reporter.prototype.reportSuiteResults=function(){},jasmine.Reporter.prototype.reportSpecStarting=function(){},jasmine.Reporter.prototype.reportSpecResults=function(){},jasmine.Reporter.prototype.log=function(){},jasmine.Block=function(a,b,c){this.env=a,this.func=b,this.spec=c},jasmine.Block.prototype.execute=function(a){if(jasmine.CATCH_EXCEPTIONS)try{this.func.apply(this.spec)}catch(b){this.spec.fail(b)}else this.func.apply(this.spec);a()},jasmine.JsApiReporter=function(){this.started=!1,this.finished=!1,this.suites_=[],this.results_={}},jasmine.JsApiReporter.prototype.reportRunnerStarting=function(a){this.started=!0;for(var b=a.topLevelSuites(),c=0;b.length>c;c++){var d=b[c];this.suites_.push(this.summarize_(d))}},jasmine.JsApiReporter.prototype.suites=function(){return this.suites_},jasmine.JsApiReporter.prototype.summarize_=function(a){var b=a instanceof jasmine.Suite,c={id:a.id,name:a.description,type:b?"suite":"spec",children:[]};if(b)for(var d=a.children(),e=0;d.length>e;e++)c.children.push(this.summarize_(d[e]));return c},jasmine.JsApiReporter.prototype.results=function(){return this.results_},jasmine.JsApiReporter.prototype.resultsForSpec=function(a){return this.results_[a]},jasmine.JsApiReporter.prototype.reportRunnerResults=function(){this.finished=!0},jasmine.JsApiReporter.prototype.reportSuiteResults=function(){},jasmine.JsApiReporter.prototype.reportSpecResults=function(a){this.results_[a.id]={messages:a.results().getItems(),result:a.results().failedCount>0?"failed":"passed"}},jasmine.JsApiReporter.prototype.log=function(){},jasmine.JsApiReporter.prototype.resultsForSpecs=function(a){for(var b={},c=0;a.length>c;c++){var d=a[c];b[d]=this.summarizeResult_(this.results_[d])}return b},jasmine.JsApiReporter.prototype.summarizeResult_=function(a){for(var b=[],c=a.messages.length,d=0;c>d;d++){var e=a.messages[d];b.push({text:"log"==e.type?""+e:jasmine.undefined,passed:e.passed?e.passed():!0,type:e.type,message:e.message,trace:{stack:e.passed&&!e.passed()?e.trace.stack:jasmine.undefined}})}return{result:a.result,messages:b}},jasmine.Matchers=function(a,b,c,d){this.env=a,this.actual=b,this.spec=c,this.isNot=d||!1,this.reportWasCalled_=!1},jasmine.Matchers.pp=function(){throw Error("jasmine.Matchers.pp() is no longer supported, please use jasmine.pp() instead!")},jasmine.Matchers.prototype.report=function(){throw Error("As of jasmine 0.11, custom matchers must be implemented differently -- please see jasmine docs")},jasmine.Matchers.wrapInto_=function(a,b){for(var c in a)if("report"!=c){var d=a[c];b.prototype[c]=jasmine.Matchers.matcherFn_(c,d)}},jasmine.Matchers.matcherFn_=function(a,b){return function(){var c=jasmine.util.argsToArray(arguments),d=b.apply(this,arguments);if(this.isNot&&(d=!d),this.reportWasCalled_)return d;var e;if(!d)if(this.message)e=this.message.apply(this,arguments),jasmine.isArray_(e)&&(e=e[this.isNot?1:0]);else{var f=a.replace(/[A-Z]/g,function(a){return" "+a.toLowerCase()});if(e="Expected "+jasmine.pp(this.actual)+(this.isNot?" not ":" ")+f,c.length>0)for(var g=0;c.length>g;g++)g>0&&(e+=","),e+=" "+jasmine.pp(c[g]);e+="."}var h=new jasmine.ExpectationResult({matcherName:a,passed:d,expected:c.length>1?c:c[0],actual:this.actual,message:e});return this.spec.addMatcherResult(h),jasmine.undefined}},jasmine.Matchers.prototype.toBe=function(a){return this.actual===a},jasmine.Matchers.prototype.toNotBe=function(a){return this.actual!==a},jasmine.Matchers.prototype.toEqual=function(a){return this.env.equals_(this.actual,a)},jasmine.Matchers.prototype.toNotEqual=function(a){return!this.env.equals_(this.actual,a)},jasmine.Matchers.prototype.toMatch=function(a){return RegExp(a).test(this.actual)},jasmine.Matchers.prototype.toNotMatch=function(a){return!RegExp(a).test(this.actual)},jasmine.Matchers.prototype.toBeDefined=function(){return this.actual!==jasmine.undefined},jasmine.Matchers.prototype.toBeUndefined=function(){return this.actual===jasmine.undefined},jasmine.Matchers.prototype.toBeNull=function(){return null===this.actual},jasmine.Matchers.prototype.toBeNaN=function(){return this.message=function(){return["Expected "+jasmine.pp(this.actual)+" to be NaN."]},this.actual!==this.actual},jasmine.Matchers.prototype.toBeTruthy=function(){return!!this.actual},jasmine.Matchers.prototype.toBeFalsy=function(){return!this.actual},jasmine.Matchers.prototype.toHaveBeenCalled=function(){if(arguments.length>0)throw Error("toHaveBeenCalled does not take arguments, use toHaveBeenCalledWith");if(!jasmine.isSpy(this.actual))throw Error("Expected a spy, but got "+jasmine.pp(this.actual)+".");return this.message=function(){return["Expected spy "+this.actual.identity+" to have been called.","Expected spy "+this.actual.identity+" not to have been called."]},this.actual.wasCalled},jasmine.Matchers.prototype.wasCalled=jasmine.Matchers.prototype.toHaveBeenCalled,jasmine.Matchers.prototype.wasNotCalled=function(){if(arguments.length>0)throw Error("wasNotCalled does not take arguments");if(!jasmine.isSpy(this.actual))throw Error("Expected a spy, but got "+jasmine.pp(this.actual)+".");return this.message=function(){return["Expected spy "+this.actual.identity+" to not have been called.","Expected spy "+this.actual.identity+" to have been called."]},!this.actual.wasCalled},jasmine.Matchers.prototype.toHaveBeenCalledWith=function(){var a=jasmine.util.argsToArray(arguments);if(!jasmine.isSpy(this.actual))throw Error("Expected a spy, but got "+jasmine.pp(this.actual)+".");return this.message=function(){var b="Expected spy "+this.actual.identity+" not to have been called with "+jasmine.pp(a)+" but it was.",c="";return c=0===this.actual.callCount?"Expected spy "+this.actual.identity+" to have been called with "+jasmine.pp(a)+" but it was never called.":"Expected spy "+this.actual.identity+" to have been called with "+jasmine.pp(a)+" but actual calls were "+jasmine.pp(this.actual.argsForCall).replace(/^\[ | \]$/g,""),[c,b]},this.env.contains_(this.actual.argsForCall,a)},jasmine.Matchers.prototype.wasCalledWith=jasmine.Matchers.prototype.toHaveBeenCalledWith,jasmine.Matchers.prototype.wasNotCalledWith=function(){var a=jasmine.util.argsToArray(arguments);if(!jasmine.isSpy(this.actual))throw Error("Expected a spy, but got "+jasmine.pp(this.actual)+".");return this.message=function(){return["Expected spy not to have been called with "+jasmine.pp(a)+" but it was","Expected spy to have been called with "+jasmine.pp(a)+" but it was"]},!this.env.contains_(this.actual.argsForCall,a)},jasmine.Matchers.prototype.toContain=function(a){return this.env.contains_(this.actual,a)},jasmine.Matchers.prototype.toNotContain=function(a){return!this.env.contains_(this.actual,a)},jasmine.Matchers.prototype.toBeLessThan=function(a){return a>this.actual},jasmine.Matchers.prototype.toBeGreaterThan=function(a){return this.actual>a},jasmine.Matchers.prototype.toBeCloseTo=function(a,b){return 0!==b&&(b=b||2),Math.abs(a-this.actual)<Math.pow(10,-b)/2},jasmine.Matchers.prototype.toThrow=function(a){var c,b=!1;if("function"!=typeof this.actual)throw Error("Actual is not a function");try{this.actual()}catch(d){c=d}c&&(b=a===jasmine.undefined||this.env.equals_(c.message||c,a.message||a));var e=this.isNot?"not ":"";return this.message=function(){return!c||a!==jasmine.undefined&&this.env.equals_(c.message||c,a.message||a)?"Expected function to throw an exception.":["Expected function "+e+"to throw",a?a.message||a:"an exception",", but it threw",c.message||c].join(" ")},b},jasmine.Matchers.Any=function(a){this.expectedClass=a},jasmine.Matchers.Any.prototype.jasmineMatches=function(a){return this.expectedClass==String?"string"==typeof a||a instanceof String:this.expectedClass==Number?"number"==typeof a||a instanceof Number:this.expectedClass==Function?"function"==typeof a||a instanceof Function:this.expectedClass==Object?"object"==typeof a:a instanceof this.expectedClass},jasmine.Matchers.Any.prototype.jasmineToString=function(){return"<jasmine.any("+this.expectedClass+")>"},jasmine.Matchers.ObjectContaining=function(a){this.sample=a},jasmine.Matchers.ObjectContaining.prototype.jasmineMatches=function(a,b,c){b=b||[],c=c||[];var d=jasmine.getEnv(),e=function(a,b){return null!=a&&a[b]!==jasmine.undefined};for(var f in this.sample)!e(a,f)&&e(this.sample,f)?b.push("expected has key '"+f+"', but missing from actual."):d.equals_(this.sample[f],a[f],b,c)||c.push("'"+f+"' was '"+(a[f]?jasmine.util.htmlEscape(""+a[f]):a[f])+"' in expected, but was '"+(this.sample[f]?jasmine.util.htmlEscape(""+this.sample[f]):this.sample[f])+"' in actual.");return 0===b.length&&0===c.length},jasmine.Matchers.ObjectContaining.prototype.jasmineToString=function(){return"<jasmine.objectContaining("+jasmine.pp(this.sample)+")>"},jasmine.FakeTimer=function(){this.reset();var a=this;a.setTimeout=function(b,c){return a.timeoutsMade++,a.scheduleFunction(a.timeoutsMade,b,c,!1),a.timeoutsMade},a.setInterval=function(b,c){return a.timeoutsMade++,a.scheduleFunction(a.timeoutsMade,b,c,!0),a.timeoutsMade},a.clearTimeout=function(b){a.scheduledFunctions[b]=jasmine.undefined},a.clearInterval=function(b){a.scheduledFunctions[b]=jasmine.undefined}},jasmine.FakeTimer.prototype.reset=function(){this.timeoutsMade=0,this.scheduledFunctions={},this.nowMillis=0},jasmine.FakeTimer.prototype.tick=function(a){var b=this.nowMillis,c=b+a;this.runFunctionsWithinRange(b,c),this.nowMillis=c},jasmine.FakeTimer.prototype.runFunctionsWithinRange=function(a,b){var c,d=[];for(var e in this.scheduledFunctions)c=this.scheduledFunctions[e],c!=jasmine.undefined&&c.runAtMillis>=a&&b>=c.runAtMillis&&(d.push(c),this.scheduledFunctions[e]=jasmine.undefined);if(d.length>0){d.sort(function(a,b){return a.runAtMillis-b.runAtMillis});for(var f=0;d.length>f;++f)try{var g=d[f];this.nowMillis=g.runAtMillis,g.funcToCall(),g.recurring&&this.scheduleFunction(g.timeoutKey,g.funcToCall,g.millis,!0)}catch(h){}this.runFunctionsWithinRange(a,b)}},jasmine.FakeTimer.prototype.scheduleFunction=function(a,b,c,d){this.scheduledFunctions[a]={runAtMillis:this.nowMillis+c,funcToCall:b,recurring:d,timeoutKey:a,millis:c}},jasmine.Clock={defaultFakeTimer:new jasmine.FakeTimer,reset:function(){jasmine.Clock.assertInstalled(),jasmine.Clock.defaultFakeTimer.reset()},tick:function(a){jasmine.Clock.assertInstalled(),jasmine.Clock.defaultFakeTimer.tick(a)},runFunctionsWithinRange:function(a,b){jasmine.Clock.defaultFakeTimer.runFunctionsWithinRange(a,b)},scheduleFunction:function(a,b,c,d){jasmine.Clock.defaultFakeTimer.scheduleFunction(a,b,c,d)},useMock:function(){if(!jasmine.Clock.isInstalled()){var a=jasmine.getEnv().currentSpec;a.after(jasmine.Clock.uninstallMock),jasmine.Clock.installMock()}},installMock:function(){jasmine.Clock.installed=jasmine.Clock.defaultFakeTimer},uninstallMock:function(){jasmine.Clock.assertInstalled(),jasmine.Clock.installed=jasmine.Clock.real},real:{setTimeout:jasmine.getGlobal().setTimeout,clearTimeout:jasmine.getGlobal().clearTimeout,setInterval:jasmine.getGlobal().setInterval,clearInterval:jasmine.getGlobal().clearInterval},assertInstalled:function(){if(!jasmine.Clock.isInstalled())throw Error("Mock clock is not installed, use jasmine.Clock.useMock()")},isInstalled:function(){return jasmine.Clock.installed==jasmine.Clock.defaultFakeTimer},installed:null},jasmine.Clock.installed=jasmine.Clock.real,jasmine.getGlobal().setTimeout=function(a,b){return jasmine.Clock.installed.setTimeout.apply?jasmine.Clock.installed.setTimeout.apply(this,arguments):jasmine.Clock.installed.setTimeout(a,b)},jasmine.getGlobal().setInterval=function(a,b){return jasmine.Clock.installed.setInterval.apply?jasmine.Clock.installed.setInterval.apply(this,arguments):jasmine.Clock.installed.setInterval(a,b)},jasmine.getGlobal().clearTimeout=function(a){return jasmine.Clock.installed.clearTimeout.apply?jasmine.Clock.installed.clearTimeout.apply(this,arguments):jasmine.Clock.installed.clearTimeout(a)},jasmine.getGlobal().clearInterval=function(a){return jasmine.Clock.installed.clearTimeout.apply?jasmine.Clock.installed.clearInterval.apply(this,arguments):jasmine.Clock.installed.clearInterval(a)},jasmine.MultiReporter=function(){this.subReporters_=[]},jasmine.util.inherit(jasmine.MultiReporter,jasmine.Reporter),jasmine.MultiReporter.prototype.addReporter=function(a){this.subReporters_.push(a)},function(){for(var a=["reportRunnerStarting","reportRunnerResults","reportSuiteResults","reportSpecStarting","reportSpecResults","log"],b=0;a.length>b;b++){var c=a[b];jasmine.MultiReporter.prototype[c]=function(a){return function(){for(var b=0;this.subReporters_.length>b;b++){var c=this.subReporters_[b];c[a]&&c[a].apply(c,arguments)}}}(c)}}(),jasmine.NestedResults=function(){this.totalCount=0,this.passedCount=0,this.failedCount=0,this.skipped=!1,this.items_=[]},jasmine.NestedResults.prototype.rollupCounts=function(a){this.totalCount+=a.totalCount,this.passedCount+=a.passedCount,this.failedCount+=a.failedCount},jasmine.NestedResults.prototype.log=function(a){this.items_.push(new jasmine.MessageResult(a))},jasmine.NestedResults.prototype.getItems=function(){return this.items_},jasmine.NestedResults.prototype.addResult=function(a){"log"!=a.type&&(a.items_?this.rollupCounts(a):(this.totalCount++,a.passed()?this.passedCount++:this.failedCount++)),this.items_.push(a)},jasmine.NestedResults.prototype.passed=function(){return this.passedCount===this.totalCount},jasmine.PrettyPrinter=function(){this.ppNestLevel_=0},jasmine.PrettyPrinter.prototype.format=function(a){this.ppNestLevel_++;try{a===jasmine.undefined?this.emitScalar("undefined"):null===a?this.emitScalar("null"):a===jasmine.getGlobal()?this.emitScalar("<global>"):a.jasmineToString?this.emitScalar(a.jasmineToString()):"string"==typeof a?this.emitString(a):jasmine.isSpy(a)?this.emitScalar("spy on "+a.identity):a instanceof RegExp?this.emitScalar(""+a):"function"==typeof a?this.emitScalar("Function"):"number"==typeof a.nodeType?this.emitScalar("HTMLNode"):a instanceof Date?this.emitScalar("Date("+a+")"):a.__Jasmine_been_here_before__?this.emitScalar("<circular reference: "+(jasmine.isArray_(a)?"Array":"Object")+">"):jasmine.isArray_(a)||"object"==typeof a?(a.__Jasmine_been_here_before__=!0,jasmine.isArray_(a)?this.emitArray(a):this.emitObject(a),delete a.__Jasmine_been_here_before__):this.emitScalar(""+a)}finally{this.ppNestLevel_--}},jasmine.PrettyPrinter.prototype.iterateObject=function(a,b){for(var c in a)a.hasOwnProperty(c)&&"__Jasmine_been_here_before__"!=c&&b(c,a.__lookupGetter__?a.__lookupGetter__(c)!==jasmine.undefined&&null!==a.__lookupGetter__(c):!1)},jasmine.PrettyPrinter.prototype.emitArray=jasmine.unimplementedMethod_,jasmine.PrettyPrinter.prototype.emitObject=jasmine.unimplementedMethod_,jasmine.PrettyPrinter.prototype.emitScalar=jasmine.unimplementedMethod_,jasmine.PrettyPrinter.prototype.emitString=jasmine.unimplementedMethod_,jasmine.StringPrettyPrinter=function(){jasmine.PrettyPrinter.call(this),this.string=""},jasmine.util.inherit(jasmine.StringPrettyPrinter,jasmine.PrettyPrinter),jasmine.StringPrettyPrinter.prototype.emitScalar=function(a){this.append(a)},jasmine.StringPrettyPrinter.prototype.emitString=function(a){this.append("'"+a+"'")},jasmine.StringPrettyPrinter.prototype.emitArray=function(a){if(this.ppNestLevel_>jasmine.MAX_PRETTY_PRINT_DEPTH)return this.append("Array"),void 0;this.append("[ ");for(var b=0;a.length>b;b++)b>0&&this.append(", "),this.format(a[b]);this.append(" ]")},jasmine.StringPrettyPrinter.prototype.emitObject=function(a){if(this.ppNestLevel_>jasmine.MAX_PRETTY_PRINT_DEPTH)return this.append("Object"),void 0;var b=this;this.append("{ ");var c=!0;this.iterateObject(a,function(d,e){c?c=!1:b.append(", "),b.append(d),b.append(" : "),e?b.append("<getter>"):b.format(a[d])}),this.append(" }")},jasmine.StringPrettyPrinter.prototype.append=function(a){this.string+=a},jasmine.Queue=function(a){this.env=a,this.ensured=[],this.blocks=[],this.running=!1,this.index=0,this.offset=0,this.abort=!1},jasmine.Queue.prototype.addBefore=function(a,b){b===jasmine.undefined&&(b=!1),this.blocks.unshift(a),this.ensured.unshift(b)},jasmine.Queue.prototype.add=function(a,b){b===jasmine.undefined&&(b=!1),this.blocks.push(a),this.ensured.push(b)},jasmine.Queue.prototype.insertNext=function(a,b){b===jasmine.undefined&&(b=!1),this.ensured.splice(this.index+this.offset+1,0,b),this.blocks.splice(this.index+this.offset+1,0,a),this.offset++},jasmine.Queue.prototype.start=function(a){this.running=!0,this.onComplete=a,this.next_()},jasmine.Queue.prototype.isRunning=function(){return this.running},jasmine.Queue.LOOP_DONT_RECURSE=!0,jasmine.Queue.prototype.next_=function(){for(var a=this,b=!0;b;)if(b=!1,a.index<a.blocks.length&&(!this.abort||this.ensured[a.index])){var c=!0,d=!1,e=function(){if(jasmine.Queue.LOOP_DONT_RECURSE&&c)return d=!0,void 0;a.blocks[a.index].abort&&(a.abort=!0),a.offset=0,a.index++;var e=(new Date).getTime();a.env.updateInterval&&e-a.env.lastUpdate>a.env.updateInterval?(a.env.lastUpdate=e,a.env.setTimeout(function(){a.next_()},0)):jasmine.Queue.LOOP_DONT_RECURSE&&d?b=!0:a.next_()};a.blocks[a.index].execute(e),c=!1,d&&e()}else a.running=!1,a.onComplete&&a.onComplete()},jasmine.Queue.prototype.results=function(){for(var a=new jasmine.NestedResults,b=0;this.blocks.length>b;b++)this.blocks[b].results&&a.addResult(this.blocks[b].results());return a},jasmine.Runner=function(a){var b=this;b.env=a,b.queue=new jasmine.Queue(a),b.before_=[],b.after_=[],b.suites_=[]},jasmine.Runner.prototype.execute=function(){var a=this;a.env.reporter.reportRunnerStarting&&a.env.reporter.reportRunnerStarting(this),a.queue.start(function(){a.finishCallback()})},jasmine.Runner.prototype.beforeEach=function(a){a.typeName="beforeEach",this.before_.splice(0,0,a)},jasmine.Runner.prototype.afterEach=function(a){a.typeName="afterEach",this.after_.splice(0,0,a)},jasmine.Runner.prototype.finishCallback=function(){this.env.reporter.reportRunnerResults(this)},jasmine.Runner.prototype.addSuite=function(a){this.suites_.push(a)},jasmine.Runner.prototype.add=function(a){a instanceof jasmine.Suite&&this.addSuite(a),this.queue.add(a)},jasmine.Runner.prototype.specs=function(){for(var a=this.suites(),b=[],c=0;a.length>c;c++)b=b.concat(a[c].specs());return b},jasmine.Runner.prototype.suites=function(){return this.suites_},jasmine.Runner.prototype.topLevelSuites=function(){for(var a=[],b=0;this.suites_.length>b;b++)this.suites_[b].parentSuite||a.push(this.suites_[b]);return a},jasmine.Runner.prototype.results=function(){return this.queue.results()},jasmine.Spec=function(a,b,c){if(!a)throw Error("jasmine.Env() required");if(!b)throw Error("jasmine.Suite() required");var d=this;d.id=a.nextSpecId?a.nextSpecId():null,d.env=a,d.suite=b,d.description=c,d.queue=new jasmine.Queue(a),d.afterCallbacks=[],d.spies_=[],d.results_=new jasmine.NestedResults,d.results_.description=c,d.matchersClass=null},jasmine.Spec.prototype.getFullName=function(){return this.suite.getFullName()+" "+this.description+"."},jasmine.Spec.prototype.results=function(){return this.results_},jasmine.Spec.prototype.log=function(){return this.results_.log(arguments)},jasmine.Spec.prototype.runs=function(a){var b=new jasmine.Block(this.env,a,this);return this.addToQueue(b),this},jasmine.Spec.prototype.addToQueue=function(a){this.queue.isRunning()?this.queue.insertNext(a):this.queue.add(a)},jasmine.Spec.prototype.addMatcherResult=function(a){this.results_.addResult(a)},jasmine.Spec.prototype.expect=function(a){var b=new(this.getMatchersClass_())(this.env,a,this);return b.not=new(this.getMatchersClass_())(this.env,a,this,!0),b},jasmine.Spec.prototype.waits=function(a){var b=new jasmine.WaitsBlock(this.env,a,this);return this.addToQueue(b),this},jasmine.Spec.prototype.waitsFor=function(){for(var d=null,e=null,f=null,g=0;arguments.length>g;g++){var h=arguments[g];switch(typeof h){case"function":d=h;break;case"string":e=h;break;case"number":f=h}}var i=new jasmine.WaitsForBlock(this.env,f,d,e,this);return this.addToQueue(i),this},jasmine.Spec.prototype.fail=function(a){var b=new jasmine.ExpectationResult({passed:!1,message:a?jasmine.util.formatException(a):"Exception",trace:{stack:a.stack}});this.results_.addResult(b)},jasmine.Spec.prototype.getMatchersClass_=function(){return this.matchersClass||this.env.matchersClass},jasmine.Spec.prototype.addMatchers=function(a){var b=this.getMatchersClass_(),c=function(){b.apply(this,arguments)};jasmine.util.inherit(c,b),jasmine.Matchers.wrapInto_(a,c),this.matchersClass=c},jasmine.Spec.prototype.finishCallback=function(){this.env.reporter.reportSpecResults(this)},jasmine.Spec.prototype.finish=function(a){this.removeAllSpies(),this.finishCallback(),a&&a()},jasmine.Spec.prototype.after=function(a){this.queue.isRunning()?this.queue.add(new jasmine.Block(this.env,a,this),!0):this.afterCallbacks.unshift(a)},jasmine.Spec.prototype.execute=function(a){var b=this;return b.env.specFilter(b)?(this.env.reporter.reportSpecStarting(this),b.env.currentSpec=b,b.addBeforesAndAftersToQueue(),b.queue.start(function(){b.finish(a)}),void 0):(b.results_.skipped=!0,b.finish(a),void 0)},jasmine.Spec.prototype.addBeforesAndAftersToQueue=function(){for(var b,a=this.env.currentRunner(),c=this.suite;c;c=c.parentSuite)for(b=0;c.before_.length>b;b++)this.queue.addBefore(new jasmine.Block(this.env,c.before_[b],this));for(b=0;a.before_.length>b;b++)this.queue.addBefore(new jasmine.Block(this.env,a.before_[b],this));for(b=0;this.afterCallbacks.length>b;b++)this.queue.add(new jasmine.Block(this.env,this.afterCallbacks[b],this),!0);for(c=this.suite;c;c=c.parentSuite)for(b=0;c.after_.length>b;b++)this.queue.add(new jasmine.Block(this.env,c.after_[b],this),!0);for(b=0;a.after_.length>b;b++)this.queue.add(new jasmine.Block(this.env,a.after_[b],this),!0)},jasmine.Spec.prototype.explodes=function(){throw"explodes function should not have been called"},jasmine.Spec.prototype.spyOn=function(a,b,c){if(a==jasmine.undefined)throw"spyOn could not find an object to spy upon for "+b+"()";if(!c&&a[b]===jasmine.undefined)throw b+"() method does not exist";if(!c&&a[b]&&a[b].isSpy)throw Error(b+" has already been spied upon");var d=jasmine.createSpy(b);return this.spies_.push(d),d.baseObj=a,d.methodName=b,d.originalValue=a[b],a[b]=d,d},jasmine.Spec.prototype.removeAllSpies=function(){for(var a=0;this.spies_.length>a;a++){var b=this.spies_[a];b.baseObj[b.methodName]=b.originalValue}this.spies_=[]},jasmine.Suite=function(a,b,c,d){var e=this;e.id=a.nextSuiteId?a.nextSuiteId():null,e.description=b,e.queue=new jasmine.Queue(a),e.parentSuite=d,e.env=a,e.before_=[],e.after_=[],e.children_=[],e.suites_=[],e.specs_=[]},jasmine.Suite.prototype.getFullName=function(){for(var a=this.description,b=this.parentSuite;b;b=b.parentSuite)a=b.description+" "+a;return a},jasmine.Suite.prototype.finish=function(a){this.env.reporter.reportSuiteResults(this),this.finished=!0,"function"==typeof a&&a()},jasmine.Suite.prototype.beforeEach=function(a){a.typeName="beforeEach",this.before_.unshift(a)},jasmine.Suite.prototype.afterEach=function(a){a.typeName="afterEach",this.after_.unshift(a)},jasmine.Suite.prototype.results=function(){return this.queue.results()},jasmine.Suite.prototype.add=function(a){this.children_.push(a),a instanceof jasmine.Suite?(this.suites_.push(a),this.env.currentRunner().addSuite(a)):this.specs_.push(a),this.queue.add(a)},jasmine.Suite.prototype.specs=function(){return this.specs_},jasmine.Suite.prototype.suites=function(){return this.suites_},jasmine.Suite.prototype.children=function(){return this.children_},jasmine.Suite.prototype.execute=function(a){var b=this;this.queue.start(function(){b.finish(a)})},jasmine.WaitsBlock=function(a,b,c){this.timeout=b,jasmine.Block.call(this,a,null,c)},jasmine.util.inherit(jasmine.WaitsBlock,jasmine.Block),jasmine.WaitsBlock.prototype.execute=function(a){jasmine.VERBOSE&&this.env.reporter.log(">> Jasmine waiting for "+this.timeout+" ms..."),this.env.setTimeout(function(){a()},this.timeout)},jasmine.WaitsForBlock=function(a,b,c,d,e){this.timeout=b||a.defaultTimeoutInterval,this.latchFunction=c,this.message=d,this.totalTimeSpentWaitingForLatch=0,jasmine.Block.call(this,a,null,e)},jasmine.util.inherit(jasmine.WaitsForBlock,jasmine.Block),jasmine.WaitsForBlock.TIMEOUT_INCREMENT=10,jasmine.WaitsForBlock.prototype.execute=function(a){jasmine.VERBOSE&&this.env.reporter.log(">> Jasmine waiting for "+(this.message||"something to happen"));var b;try{b=this.latchFunction.apply(this.spec)}catch(c){return this.spec.fail(c),a(),void 0}if(b)a();else if(this.totalTimeSpentWaitingForLatch>=this.timeout){var d="timed out after "+this.timeout+" msec waiting for "+(this.message||"something to happen");this.spec.fail({name:"timeout",message:d}),this.abort=!0,a()}else{this.totalTimeSpentWaitingForLatch+=jasmine.WaitsForBlock.TIMEOUT_INCREMENT;var e=this;this.env.setTimeout(function(){e.execute(a)},jasmine.WaitsForBlock.TIMEOUT_INCREMENT)}},jasmine.version_={major:1,minor:3,build:1,revision:1354556913};

//Jasmine HTML
jasmine.HtmlReporterHelpers={},jasmine.HtmlReporterHelpers.createDom=function(a,b){for(var d=document.createElement(a),e=2;arguments.length>e;e++){var f=arguments[e];"string"==typeof f?d.appendChild(document.createTextNode(f)):f&&d.appendChild(f)}for(var g in b)"className"==g?d[g]=b[g]:d.setAttribute(g,b[g]);return d},jasmine.HtmlReporterHelpers.getSpecStatus=function(a){var b=a.results(),c=b.passed()?"passed":"failed";return b.skipped&&(c="skipped"),c},jasmine.HtmlReporterHelpers.appendToSummary=function(a,b){var c=this.dom.summary,d=a.parentSuite===void 0?"suite":"parentSuite",e=a[d];e&&(this.views.suites[e.id]===void 0&&(this.views.suites[e.id]=new jasmine.HtmlReporter.SuiteView(e,this.dom,this.views)),c=this.views.suites[e.id].element),c.appendChild(b)},jasmine.HtmlReporterHelpers.addHelpers=function(a){for(var b in jasmine.HtmlReporterHelpers)a.prototype[b]=jasmine.HtmlReporterHelpers[b]},jasmine.HtmlReporter=function(a){function f(){var a;return function(){if(!a){for(var b=[],d=jasmine.HtmlReporter.parameters(c),e=0;d.length>e;e++){var f=d[e].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}a=b.spec}}(),a}function g(a){e.reporter=b.createDom("div",{id:"HTMLReporter",className:"jasmine_reporter"},e.banner=b.createDom("div",{className:"banner"},b.createDom("span",{className:"title"},"Jasmine "),b.createDom("span",{className:"version"},a)),e.symbolSummary=b.createDom("ul",{className:"symbolSummary"}),e.alert=b.createDom("div",{className:"alert"},b.createDom("span",{className:"exceptions"},b.createDom("label",{className:"label","for":"no_try_catch"},"No try/catch"),b.createDom("input",{id:"no_try_catch",type:"checkbox"}))),e.results=b.createDom("div",{className:"results"},e.summary=b.createDom("div",{className:"summary"}),e.details=b.createDom("div",{id:"details"})))}function h(){return unsafeWindow.location.search.match(/catch=false/)}function i(){for(var a=jasmine.HtmlReporter.parameters(unsafeWindow.document),b=!1,c=0;!b&&a.length>c;)a[c].match(/catch=/)&&(a.splice(c,1),b=!0),c++;return jasmine.CATCH_EXCEPTIONS&&a.push("catch=false"),a.join("&")}function j(){var a=document.getElementById("no_try_catch");h()&&(a.setAttribute("checked",!0),jasmine.CATCH_EXCEPTIONS=!1),a.onclick=function(){unsafeWindow.location.search=i()}}var d,b=this,c=a||unsafeWindow.document,e={};return b.logRunningSpecs=!1,b.reportRunnerStarting=function(a){var f=a.specs()||[];0!=f.length&&(g(a.env.versionString()),c.body.appendChild(e.reporter),j(),d=new jasmine.HtmlReporter.ReporterView(e),d.addSpecs(f,b.specFilter))},b.reportRunnerResults=function(){d&&d.complete()},b.reportSuiteResults=function(a){d.suiteComplete(a)},b.reportSpecStarting=function(a){b.logRunningSpecs&&b.log(">> Jasmine Running "+a.suite.description+" "+a.description+"...")},b.reportSpecResults=function(a){d.specComplete(a)},b.log=function(){var a=jasmine.getGlobal().console;a&&a.log&&(a.log.apply?a.log.apply(a,arguments):a.log(arguments))},b.specFilter=function(a){return f()?0===a.getFullName().indexOf(f()):!0},b},jasmine.HtmlReporter.parameters=function(a){var b=a.location.search.substring(1),c=[];return b.length>0&&(c=b.split("&")),c},jasmine.HtmlReporter.sectionLink=function(a){var b="?",c=[];return a&&c.push("spec="+encodeURIComponent(a)),jasmine.CATCH_EXCEPTIONS||c.push("catch=false"),c.length>0&&(b+=c.join("&")),b},jasmine.HtmlReporterHelpers.addHelpers(jasmine.HtmlReporter),jasmine.HtmlReporter.ReporterView=function(a){function b(){-1===a.reporter.className.search(/showDetails/)&&(a.reporter.className+=" showDetails")}function c(a){return a===void 0}function d(a){return!c(a)}function e(a){var b=a+" spec";return a>1&&(b+="s"),b}return this.startedAt=new Date,this.runningSpecCount=0,this.completeSpecCount=0,this.passedCount=0,this.failedCount=0,this.skippedCount=0,this.createResultsMenu=function(){this.resultsMenu=this.createDom("span",{className:"resultsMenu bar"},this.summaryMenuItem=this.createDom("a",{className:"summaryMenuItem",href:"#"},"0 specs")," | ",this.detailsMenuItem=this.createDom("a",{className:"detailsMenuItem",href:"#"},"0 failing")),this.summaryMenuItem.onclick=function(){a.reporter.className=a.reporter.className.replace(/ showDetails/g,"")},this.detailsMenuItem.onclick=function(){b()}},this.addSpecs=function(b,c){this.totalSpecCount=b.length,this.views={specs:{},suites:{}};for(var d=0;b.length>d;d++){var e=b[d];this.views.specs[e.id]=new jasmine.HtmlReporter.SpecView(e,a,this.views),c(e)&&this.runningSpecCount++}},this.specComplete=function(b){this.completeSpecCount++,c(this.views.specs[b.id])&&(this.views.specs[b.id]=new jasmine.HtmlReporter.SpecView(b,a));var d=this.views.specs[b.id];switch(d.status()){case"passed":this.passedCount++;break;case"failed":this.failedCount++;break;case"skipped":this.skippedCount++}d.refresh(),this.refresh()},this.suiteComplete=function(a){var b=this.views.suites[a.id];c(b)||b.refresh()},this.refresh=function(){c(this.resultsMenu)&&this.createResultsMenu(),c(this.runningAlert)&&(this.runningAlert=this.createDom("a",{href:jasmine.HtmlReporter.sectionLink(),className:"runningAlert bar"}),a.alert.appendChild(this.runningAlert)),this.runningAlert.innerHTML="Running "+this.completeSpecCount+" of "+e(this.totalSpecCount),c(this.skippedAlert)&&(this.skippedAlert=this.createDom("a",{href:jasmine.HtmlReporter.sectionLink(),className:"skippedAlert bar"})),this.skippedAlert.innerHTML="Skipping "+this.skippedCount+" of "+e(this.totalSpecCount)+" - run all",1===this.skippedCount&&d(a.alert)&&a.alert.appendChild(this.skippedAlert),c(this.passedAlert)&&(this.passedAlert=this.createDom("span",{href:jasmine.HtmlReporter.sectionLink(),className:"passingAlert bar"})),this.passedAlert.innerHTML="Passing "+e(this.passedCount),c(this.failedAlert)&&(this.failedAlert=this.createDom("span",{href:"?",className:"failingAlert bar"})),this.failedAlert.innerHTML="Failing "+e(this.failedCount),1===this.failedCount&&d(a.alert)&&(a.alert.appendChild(this.failedAlert),a.alert.appendChild(this.resultsMenu)),this.summaryMenuItem.innerHTML=""+e(this.runningSpecCount),this.detailsMenuItem.innerHTML=""+this.failedCount+" failing"},this.complete=function(){a.alert.removeChild(this.runningAlert),this.skippedAlert.innerHTML="Ran "+this.runningSpecCount+" of "+e(this.totalSpecCount)+" - run all",0===this.failedCount?a.alert.appendChild(this.createDom("span",{className:"passingAlert bar"},"Passing "+e(this.passedCount))):b(),a.banner.appendChild(this.createDom("span",{className:"duration"},"finished in "+((new Date).getTime()-this.startedAt.getTime())/1e3+"s"))},this},jasmine.HtmlReporterHelpers.addHelpers(jasmine.HtmlReporter.ReporterView),jasmine.HtmlReporter.SpecView=function(a,b,c){this.spec=a,this.dom=b,this.views=c,this.symbol=this.createDom("li",{className:"pending"}),this.dom.symbolSummary.appendChild(this.symbol),this.summary=this.createDom("div",{className:"specSummary"},this.createDom("a",{className:"description",href:jasmine.HtmlReporter.sectionLink(this.spec.getFullName()),title:this.spec.getFullName()},this.spec.description)),this.detail=this.createDom("div",{className:"specDetail"},this.createDom("a",{className:"description",href:"?spec="+encodeURIComponent(this.spec.getFullName()),title:this.spec.getFullName()},this.spec.getFullName()))},jasmine.HtmlReporter.SpecView.prototype.status=function(){return this.getSpecStatus(this.spec)},jasmine.HtmlReporter.SpecView.prototype.refresh=function(){switch(this.symbol.className=this.status(),this.status()){case"skipped":break;case"passed":this.appendSummaryToSuiteDiv();break;case"failed":this.appendSummaryToSuiteDiv(),this.appendFailureDetail()}},jasmine.HtmlReporter.SpecView.prototype.appendSummaryToSuiteDiv=function(){this.summary.className+=" "+this.status(),this.appendToSummary(this.spec,this.summary)},jasmine.HtmlReporter.SpecView.prototype.appendFailureDetail=function(){this.detail.className+=" "+this.status();for(var a=this.spec.results().getItems(),b=this.createDom("div",{className:"messages"}),c=0;a.length>c;c++){var d=a[c];"log"==d.type?b.appendChild(this.createDom("div",{className:"resultMessage log"},""+d)):"expect"==d.type&&d.passed&&!d.passed()&&(b.appendChild(this.createDom("div",{className:"resultMessage fail"},d.message)),d.trace.stack&&b.appendChild(this.createDom("div",{className:"stackTrace"},d.trace.stack)))}b.childNodes.length>0&&(this.detail.appendChild(b),this.dom.details.appendChild(this.detail))},jasmine.HtmlReporterHelpers.addHelpers(jasmine.HtmlReporter.SpecView),jasmine.HtmlReporter.SuiteView=function(a,b,c){this.suite=a,this.dom=b,this.views=c,this.element=this.createDom("div",{className:"suite"},this.createDom("a",{className:"description",href:jasmine.HtmlReporter.sectionLink(this.suite.getFullName())},this.suite.description)),this.appendToSummary(this.suite,this.element)},jasmine.HtmlReporter.SuiteView.prototype.status=function(){return this.getSpecStatus(this.suite)},jasmine.HtmlReporter.SuiteView.prototype.refresh=function(){this.element.className+=" "+this.status()},jasmine.HtmlReporterHelpers.addHelpers(jasmine.HtmlReporter.SuiteView),jasmine.TrivialReporter=function(a){this.document=a||document,this.suiteDivs={},this.logRunningSpecs=!1},jasmine.TrivialReporter.prototype.createDom=function(a,b){for(var d=document.createElement(a),e=2;arguments.length>e;e++){var f=arguments[e];"string"==typeof f?d.appendChild(document.createTextNode(f)):f&&d.appendChild(f)}for(var g in b)"className"==g?d[g]=b[g]:d.setAttribute(g,b[g]);return d},jasmine.TrivialReporter.prototype.reportRunnerStarting=function(a){var b,c;this.outerDiv=this.createDom("div",{id:"TrivialReporter",className:"jasmine_reporter"},this.createDom("div",{className:"banner"},this.createDom("div",{className:"logo"},this.createDom("span",{className:"title"},"Jasmine"),this.createDom("span",{className:"version"},a.env.versionString())),this.createDom("div",{className:"options"},"Show ",b=this.createDom("input",{id:"__jasmine_TrivialReporter_showPassed__",type:"checkbox"}),this.createDom("label",{"for":"__jasmine_TrivialReporter_showPassed__"}," passed "),c=this.createDom("input",{id:"__jasmine_TrivialReporter_showSkipped__",type:"checkbox"}),this.createDom("label",{"for":"__jasmine_TrivialReporter_showSkipped__"}," skipped"))),this.runnerDiv=this.createDom("div",{className:"runner running"},this.createDom("a",{className:"run_spec",href:"?"},"run all"),this.runnerMessageSpan=this.createDom("span",{},"Running..."),this.finishedAtSpan=this.createDom("span",{className:"finished-at"},""))),this.document.body.appendChild(this.outerDiv);for(var d=a.suites(),e=0;d.length>e;e++){var f=d[e],g=this.createDom("div",{className:"suite"},this.createDom("a",{className:"run_spec",href:"?spec="+encodeURIComponent(f.getFullName())},"run"),this.createDom("a",{className:"description",href:"?spec="+encodeURIComponent(f.getFullName())},f.description));this.suiteDivs[f.id]=g;var h=this.outerDiv;f.parentSuite&&(h=this.suiteDivs[f.parentSuite.id]),h.appendChild(g)}this.startedAt=new Date;var i=this;b.onclick=function(){b.checked?i.outerDiv.className+=" show-passed":i.outerDiv.className=i.outerDiv.className.replace(/ show-passed/,"")},c.onclick=function(){c.checked?i.outerDiv.className+=" show-skipped":i.outerDiv.className=i.outerDiv.className.replace(/ show-skipped/,"")}},jasmine.TrivialReporter.prototype.reportRunnerResults=function(a){var b=a.results(),c=b.failedCount>0?"runner failed":"runner passed";this.runnerDiv.setAttribute("class",c),this.runnerDiv.setAttribute("className",c);for(var d=a.specs(),e=0,f=0;d.length>f;f++)this.specFilter(d[f])&&e++;var g=""+e+" spec"+(1==e?"":"s")+", "+b.failedCount+" failure"+(1==b.failedCount?"":"s");g+=" in "+((new Date).getTime()-this.startedAt.getTime())/1e3+"s",this.runnerMessageSpan.replaceChild(this.createDom("a",{className:"description",href:"?"},g),this.runnerMessageSpan.firstChild),this.finishedAtSpan.appendChild(document.createTextNode("Finished at "+(""+new Date)))},jasmine.TrivialReporter.prototype.reportSuiteResults=function(a){var b=a.results(),c=b.passed()?"passed":"failed";0===b.totalCount&&(c="skipped"),this.suiteDivs[a.id].className+=" "+c},jasmine.TrivialReporter.prototype.reportSpecStarting=function(a){this.logRunningSpecs&&this.log(">> Jasmine Running "+a.suite.description+" "+a.description+"...")},jasmine.TrivialReporter.prototype.reportSpecResults=function(a){var b=a.results(),c=b.passed()?"passed":"failed";b.skipped&&(c="skipped");for(var d=this.createDom("div",{className:"spec "+c},this.createDom("a",{className:"run_spec",href:"?spec="+encodeURIComponent(a.getFullName())},"run"),this.createDom("a",{className:"description",href:"?spec="+encodeURIComponent(a.getFullName()),title:a.getFullName()},a.description)),e=b.getItems(),f=this.createDom("div",{className:"messages"}),g=0;e.length>g;g++){var h=e[g];"log"==h.type?f.appendChild(this.createDom("div",{className:"resultMessage log"},""+h)):"expect"==h.type&&h.passed&&!h.passed()&&(f.appendChild(this.createDom("div",{className:"resultMessage fail"},h.message)),h.trace.stack&&f.appendChild(this.createDom("div",{className:"stackTrace"},h.trace.stack)))}f.childNodes.length>0&&d.appendChild(f),this.suiteDivs[a.suite.id].appendChild(d)},jasmine.TrivialReporter.prototype.log=function(){var a=jasmine.getGlobal().console;a&&a.log&&(a.log.apply?a.log.apply(a,arguments):a.log(arguments))},jasmine.TrivialReporter.prototype.getLocation=function(){return this.document.location},jasmine.TrivialReporter.prototype.specFilter=function(a){for(var b={},c=this.getLocation().search.substring(1).split("&"),d=0;c.length>d;d++){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return b.spec?0===a.getFullName().indexOf(b.spec):!0};


Mousetrap.bind('j a s', function(e) { 

                try{
                  //Run some code here
                        console.log('Turn ON');
                        var sourceLinks = new Array();
                        
                        //Get All ScriptLinks
                        scriptEle = document.getElementsByTagName("script");
                        
                        for (var i = 0; i < scriptEle.length; i++) {
								if (scriptEle[i].getAttribute("src") != null){
                                 sourceLinks[i] = scriptEle[i].getAttribute("src");
								 }
                        }
                        
                        //Replace HTML
                        var elements = document.getElementsByTagName('html');
                        for (var i = 0; i < elements.length; i++) {
                                 elements[i].innerHTML = JasmineHtml;
                        }
                        
                        //Add CSS
                        var css = document.createElement("style");
                        css.type = "text/css";
                        css.innerHTML = jasCss;
                        document.body.appendChild(css);
                        
                        //Add JS Sources                
                        for (var i = 0; i < sourceLinks.length; i++) {
                                var js = document.createElement("script");
                                js.type = "text/javascript";
                                js.src = sourceLinks[i];
                                document.body.appendChild(js);                  
                        }
						
						
						//Internal TestLoad
						internalUnitTests = typeof GM_getValue(window.location.pathname + "_unitTests") != 'undefined' ? GM_getValue(window.location.pathname + "_unitTests") : false ;
						
						if (priorityInternal === false){
							testJsUrl = mappingUrl + window.location.pathname.replace("/","_")  + '_test.js';
							var js = document.createElement("script");
							js.type = "text/javascript";
							js.src = testJsUrl;
							if (internalUnitTests !== false){
								js.onerror = function() { eval('eval(' + internalUnitTests + ');'); } //sor for Eval
								js.innerHTML = 'if (typeof external_jasmine == "undefined"){ eval("' + internalUnitTests + '"); }';
							}else{
								js.onerror = function() { console.log('Testing Resource load Failed'); }
								js.innerHTML = 'if (typeof external_jasmine == "undefined"){ console.log("Testing Resource load Failed"); }';
							}							
							document.body.appendChild(js);  


							//Second TestWawe (Because doesn't seams that onerror works)
							var js = document.createElement("script");
							js.type = "text/javascript";
							if (internalUnitTests !== false){
								js.innerHTML = 'if (typeof external_jasmine == "undefined"){ setTimeout(eval("' + internalUnitTests + '") , 5000); }';
							}else{
								js.innerHTML = 'if (typeof external_jasmine == "undefined"){ setTimeout(console.log("Testing Resource load Failed"), 5000); }';
							}							
							document.body.appendChild(js);  
						}else{						
							if (internalUnitTests){
								eval(internalUnitTests);  //sor for Eval
							}else{
								console.log('Testing Resource load Failed');
							}
						}
                        //Javascript Runner file
						buildJasmineInit();
                        /**var elements = document.getElementsByTagName('html');
                        for (var i = 0; i < elements.length; i++) {
                                 console.log(elements[i].innerHTML);
                        }**/
                        
                  }catch(err){
                  //Handle errors here
                        console.log(err);
                  }
				  
				  
				unsafeWindow.localStorage.runJasmine = false;
				
				unsafeWindow.runJasmineInit = function(){
					localStorage.runJasmine = true;
					console.log('Save Requested');
				};
				
				//unsafeWindow.localStorage.runJasmine = false;
				GM_wait_jasmine();
        
});


Mousetrap.bind('j a a d', function(e) { 
	internalUnitTests = typeof GM_getValue(unsafeWindow.location.pathname + "_unitTests") != 'undefined' ? GM_getValue(unsafeWindow.location.pathname + "_unitTests") : false ;
	unsafeWindow.localStorage.saveUnitTest = false;
	if (!internalUnitTests){
		var innerH = "external_jasmine = true; <br/> if (typeof unsafeWindow != 'undefined'){window = unsafeWindow;} <br/> unsafeWindow.localStorage.jasmineExternalLoaded = 1; <br/> describe('A suite', function() {<br/>  it('contains spec with an expectation', function() { <br/>   expect(true).toBe(true); <br/> }); <br/>});";
	}else{
		//beautyFyer from https://github.com/einars/js-beautify/blob/master/js/lib/beautify.js
		(function(){function a(a,c){"use strict";var d=new b(a,c);return d.beautify()}function b(a,b){"use strict";function D(a,b){return{mode:b,last_text:a?a.last_text:"",last_word:a?a.last_word:"",var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,multiline_array:!1,if_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:a?a.indentation_level+(a.var_line&&a.var_line_reindented?1:0):0,ternary_depth:0}}function E(a){for(a=void 0===a?!1:a;d.length&&(" "===d[d.length-1]||d[d.length-1]===i||d[d.length-1]===C||a&&("\n"===d[d.length-1]||"\r"===d[d.length-1]));)d.pop()}function F(a){return a.replace(/^\s\s*|\s\s*$/,"")}function G(a){a=a.replace(/\x0d/g,"");for(var b=[],c=a.indexOf("\n");-1!==c;)b.push(a.substring(0,c)),a=a.substring(c+1),c=a.indexOf("\n");return a.length&&b.push(a),b}function H(){return d.length&&"\n"===d[d.length-1]}function I(a,b){var c=a.length-1;for(0>c&&(c+=a.length),c>a.length-1&&(c=a.length-1),c++;c-->0;)if(c in a&&a[c]===b)return c;return-1}function J(a){if(a=void 0===a?!1:a,B.wrap_line_length&&!a){var b="",c=0,f=I(d,"\n")+1;d.length>f&&(b=d.slice(f).join(""),c=b.length+e.length+(w?1:0),c>=B.wrap_line_length&&(a=!0))}(B.preserve_newlines&&t||a)&&!H()&&(K(!1,!0),v=!0,t=!1)}function K(a,b){if(v=!1,w=!1,!b&&";"!==j.last_text)for(;j.mode===A.Statement&&!j.if_block;)T();j.mode===A.ArrayLiteral&&(j.multiline_array=!0),d.length&&(a||!H())&&d.push("\n")}function L(){H()&&(B.keep_array_indentation&&R(j.mode)&&x.length?d.push(x.join("")+""):(C&&d.push(C),M(j.indentation_level),M(j.var_line&&j.var_line_reindented),M(v)))}function M(a){if(void 0===a?a=1:"number"!=typeof a&&(a=a?1:0),""!==j.last_text)for(var b=0;a>b;b+=1)d.push(i)}function N(){if(w&&d.length){var a=d[d.length-1];H()||" "===a||a===i||d.push(" ")}}function O(a){a=a||e,L(),v=!1,N(),w=!1,d.push(a)}function P(){j.indentation_level+=1}function Q(a){j?(l.push(j),k=j):k=D(null,a),j=D(k,a)}function R(a){return a===A.ArrayLiteral}function S(a){return X(a,[A.ArrayLiteral,A.Expression,A.ForInitializer,A.Conditional])}function T(){l.length>0&&(k=j,j=l.pop())}function U(){return"do"===j.last_text||"else"===j.last_text&&"if"!==e||"TK_END_EXPR"===g&&(k.mode===A.ForInitializer||k.mode===A.Conditional)?(J(),Q(A.Statement),P(),v=!1,!0):!1}function V(a,b){for(var c=0;a.length>c;c++){var d=F(a[c]);if(d.charAt(0)!==b)return!1}return!0}function W(a){return X(a,["case","return","do","if","throw","else"])}function X(a,b){for(var c=0;b.length>c;c+=1)if(b[c]===a)return!0;return!1}function Y(a){for(var g,b=!1,c="",d=0,e="",f=0;b||a.length>d;)if(g=a.charAt(d),d++,b){if(b=!1,"x"===g)e=a.substr(d,2),d+=2;else{if("u"!==g){c+="\\"+g;continue}e=a.substr(d,4),d+=4}if(!e.match(/^[0123456789abcdefABCDEF]+$/))return a;if(f=parseInt(e,16),f>=0&&32>f){c+="x"===g?"\\x"+e:"\\u"+e;continue}if(34===f||39===f||92===f)c+="\\"+String.fromCharCode(f);else{if("x"===g&&f>126&&255>=f)return a;c+=String.fromCharCode(f)}}else"\\"===g?b=!0:c+=g;return c}function Z(a){for(var b=p,d=c.charAt(b);X(d,m)&&d!==a;){if(b++,b>=y)return!1;d=c.charAt(b)}return d===a}function $(){var b;if(u=0,p>=y)return["","TK_EOF"];t=!1,x=[];var e=c.charAt(p);for(p+=1;X(e,m);){if("\n"===e?(u+=1,x=[]):u&&(e===i?x.push(i):"\r"!==e&&x.push(" ")),p>=y)return["","TK_EOF"];e=c.charAt(p),p+=1}if(X(e,n)){if(y>p)for(;X(c.charAt(p),n)&&(e+=c.charAt(p),p+=1,p!==y););if(p!==y&&e.match(/^[0-9]+[Ee]$/)&&("-"===c.charAt(p)||"+"===c.charAt(p))){var f=c.charAt(p);p+=1;var h=$();return e+=f+h[0],[e,"TK_WORD"]}return"in"===e?[e,"TK_OPERATOR"]:[e,"TK_WORD"]}if("("===e||"["===e)return[e,"TK_START_EXPR"];if(")"===e||"]"===e)return[e,"TK_END_EXPR"];if("{"===e)return[e,"TK_START_BLOCK"];if("}"===e)return[e,"TK_END_BLOCK"];if(";"===e)return[e,"TK_SEMICOLON"];if("/"===e){var l="",q=!0;if("*"===c.charAt(p)){if(p+=1,y>p)for(;y>p&&("*"!==c.charAt(p)||!c.charAt(p+1)||"/"!==c.charAt(p+1))&&(e=c.charAt(p),l+=e,("\n"===e||"\r"===e)&&(q=!1),p+=1,!(p>=y)););return p+=2,q&&0===u?["/*"+l+"*/","TK_INLINE_COMMENT"]:["/*"+l+"*/","TK_BLOCK_COMMENT"]}if("/"===c.charAt(p)){for(l=e;"\r"!==c.charAt(p)&&"\n"!==c.charAt(p)&&(l+=c.charAt(p),p+=1,!(p>=y)););return[l,"TK_COMMENT"]}}if("'"===e||'"'===e||"/"===e&&("TK_WORD"===g&&W(j.last_text)||"TK_END_EXPR"===g&&X(k.mode,[A.Conditional,A.ForInitializer])||X(g,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var s=e,v=!1,w=!1;if(b=e,y>p)if("/"===s){for(var z=!1;v||z||c.charAt(p)!==s;)if(b+=c.charAt(p),v?v=!1:(v="\\"===c.charAt(p),"["===c.charAt(p)?z=!0:"]"===c.charAt(p)&&(z=!1)),p+=1,p>=y)return[b,"TK_STRING"]}else for(;v||c.charAt(p)!==s;)if(b+=c.charAt(p),v?(("x"===c.charAt(p)||"u"===c.charAt(p))&&(w=!0),v=!1):v="\\"===c.charAt(p),p+=1,p>=y)return[b,"TK_STRING"];if(p+=1,b+=s,w&&B.unescape_strings&&(b=Y(b)),"/"===s)for(;y>p&&X(c.charAt(p),n);)b+=c.charAt(p),p+=1;return[b,"TK_STRING"]}if("#"===e){if(0===d.length&&"!"===c.charAt(p)){for(b=e;y>p&&"\n"!==e;)e=c.charAt(p),b+=e,p+=1;return[F(b)+"\n","TK_UNKNOWN"]}var C="#";if(y>p&&X(c.charAt(p),r)){do e=c.charAt(p),C+=e,p+=1;while(y>p&&"#"!==e&&"="!==e);return"#"===e||("["===c.charAt(p)&&"]"===c.charAt(p+1)?(C+="[]",p+=2):"{"===c.charAt(p)&&"}"===c.charAt(p+1)&&(C+="{}",p+=2)),[C,"TK_WORD"]}}if("<"===e&&"<!--"===c.substring(p-1,p+3)){for(p+=3,e="<!--";"\n"!==c.charAt(p)&&y>p;)e+=c.charAt(p),p++;return j.in_html_comment=!0,[e,"TK_COMMENT"]}if("-"===e&&j.in_html_comment&&"-->"===c.substring(p-1,p+2))return j.in_html_comment=!1,p+=2,["-->","TK_COMMENT"];if("."===e)return[e,"TK_DOT"];if(X(e,o)){for(;y>p&&X(e+c.charAt(p),o)&&(e+=c.charAt(p),p+=1,!(p>=y)););return","===e?[e,"TK_COMMA"]:"="===e?[e,"TK_EQUALS"]:[e,"TK_OPERATOR"]}return[e,"TK_UNKNOWN"]}function _(){if(U(),"["===e){if("TK_WORD"===g||")"===j.last_text)return X(j.last_text,q)&&(w=!0),Q(A.Expression),O(),void 0;R(j.mode)&&("["===j.last_text||"]"===h&&","===j.last_text)&&(B.keep_array_indentation||K())}else"for"===j.last_text?Q(A.ForInitializer):X(j.last_text,["if","while"])?Q(A.Conditional):Q(A.Expression);";"===j.last_text||"TK_START_BLOCK"===g?K():"TK_END_EXPR"===g||"TK_START_EXPR"===g||"TK_END_BLOCK"===g||"."===j.last_text?t&&K():"TK_WORD"!==g&&"TK_OPERATOR"!==g?w=!0:"function"===j.last_word||"typeof"===j.last_word?B.jslint_happy&&(w=!0):(X(j.last_text,q)||"catch"===j.last_text)&&B.space_before_conditional&&(w=!0),"("===e&&("TK_EQUALS"===g||"TK_OPERATOR"===g)&&j.mode!==A.ObjectLiteral&&J(),O(),"["===e&&(Q(A.ArrayLiteral),P())}function ab(){for(;j.mode===A.Statement;)T();"]"===e&&R(j.mode)&&j.multiline_array&&!B.keep_array_indentation&&K(),T(),O(),j.do_while&&k.mode===A.Conditional&&(k.mode=A.Expression,j.do_block=!1,j.do_while=!1)}function bb(){Q(A.BlockStatement);var a=Z("}");"expand-strict"===B.brace_style?a||K():"expand"===B.brace_style?"TK_OPERATOR"!==g&&("TK_EQUALS"===g||W(j.last_text)&&"else"!==j.last_text?w=!0:K()):"TK_OPERATOR"!==g&&"TK_START_EXPR"!==g?"TK_START_BLOCK"===g?K():w=!0:R(k.mode)&&","===j.last_text&&("}"===h?w=!0:K()),O(),P()}function cb(){for(;j.mode===A.Statement;)T();T(),"expand"===B.brace_style||"expand-strict"===B.brace_style?"TK_START_BLOCK"!==g&&K():"TK_START_BLOCK"!==g&&(R(j.mode)&&B.keep_array_indentation?(B.keep_array_indentation=!1,K(),B.keep_array_indentation=!0):K()),O()}function db(){if(U()||!t||S(j.mode)||"TK_OPERATOR"===g&&"--"!==j.last_text&&"++"!==j.last_text||"TK_EQUALS"===g||!B.preserve_newlines&&"var"===j.last_text||K(),j.do_block&&!j.do_while){if("while"===e)return w=!0,O(),w=!0,j.do_while=!0,void 0;K(),j.do_block=!1}if(j.if_block&&"else"!==e){for(;j.mode===A.Statement;)T();j.if_block=!1}if("function"===e){if(j.var_line&&"TK_EQUALS"!==g&&(j.var_line_reindented=!0),(H()||";"===j.last_text)&&"{"!==j.last_text&&"TK_BLOCK_COMMENT"!==g&&"TK_COMMENT"!==g){u=H()?u:0,B.preserve_newlines||(u=1);for(var a=0;2-u>a;a++)K(!0)}return"TK_WORD"===g?"get"===j.last_text||"set"===j.last_text||"new"===j.last_text||"return"===j.last_text?w=!0:K():"TK_OPERATOR"===g||"="===j.last_text?w=!0:S(j.mode)||K(),O(),j.last_word=e,void 0}return"case"===e||"default"===e&&j.in_case_statement?(K(),(j.case_body||B.jslint_happy)&&(j.indentation_level--,j.case_body=!1),O(),j.in_case=!0,j.in_case_statement=!0,void 0):(s="NONE","TK_END_BLOCK"===g?X(e,["else","catch","finally"])?"expand"===B.brace_style||"end-expand"===B.brace_style||"expand-strict"===B.brace_style?s="NEWLINE":(s="SPACE",w=!0):s="NEWLINE":"TK_SEMICOLON"===g&&j.mode===A.BlockStatement?s="NEWLINE":"TK_SEMICOLON"===g&&S(j.mode)?s="SPACE":"TK_STRING"===g?s="NEWLINE":"TK_WORD"===g?s="SPACE":"TK_START_BLOCK"===g?s="NEWLINE":"TK_END_EXPR"===g&&(w=!0,s="NEWLINE"),X(e,q)&&")"!==j.last_text&&(s="else"===j.last_text?"SPACE":"NEWLINE"),("TK_COMMA"===g||"TK_START_EXPR"===g||"TK_EQUALS"===g||"TK_OPERATOR"===g)&&j.mode!==A.ObjectLiteral&&J(),X(e,["else","catch","finally"])?"TK_END_BLOCK"!==g||"expand"===B.brace_style||"end-expand"===B.brace_style||"expand-strict"===B.brace_style?K():(E(!0),"}"!==d[d.length-1]&&K(),w=!0):"NEWLINE"===s?W(j.last_text)?w=!0:"TK_END_EXPR"!==g?"TK_START_EXPR"===g&&"var"===e||":"===j.last_text||("if"===e&&"else"===j.last_word&&"{"!==j.last_text?w=!0:(j.var_line=!1,j.var_line_reindented=!1,K())):X(e,q)&&")"!==j.last_text&&(j.var_line=!1,j.var_line_reindented=!1,K()):R(j.mode)&&","===j.last_text&&"}"===h?K():"SPACE"===s&&(w=!0),O(),j.last_word=e,"var"===e&&(j.var_line=!0,j.var_line_reindented=!1,j.var_line_tainted=!1),"do"===e&&(j.do_block=!0),"if"===e&&(j.if_block=!0),void 0)}function eb(){for(;j.mode===A.Statement&&!j.if_block;)T();O(),j.var_line=!1,j.var_line_reindented=!1,j.mode===A.ObjectLiteral&&(j.mode=A.BlockStatement)}function fb(){U()?w=!0:"TK_WORD"===g?w=!0:"TK_COMMA"===g||"TK_START_EXPR"===g||"TK_EQUALS"===g||"TK_OPERATOR"===g?j.mode!==A.ObjectLiteral&&J():K(),O()}function gb(){j.var_line&&(j.var_line_tainted=!0),w=!0,O(),w=!0}function hb(){return j.var_line?((S(j.mode)||"TK_END_BLOCK"===g)&&(j.var_line_tainted=!1),j.var_line&&(j.var_line_reindented=!0),O(),j.var_line_tainted?(j.var_line_tainted=!1,K()):w=!0,void 0):("TK_END_BLOCK"===g&&j.mode!==A.Expression?(O(),j.mode===A.ObjectLiteral&&"}"===j.last_text?K():w=!0):j.mode===A.ObjectLiteral?(O(),K()):(O(),w=!0),void 0)}function ib(){var a=!0,b=!0;return W(j.last_text)?(w=!0,O(),void 0):"*"!==e||"TK_DOT"!==g||h.match(/^\d+$/)?":"===e&&j.in_case?(j.case_body=!0,P(),O(),K(),j.in_case=!1,void 0):"::"===e?(O(),void 0):(!t||"--"!==e&&"++"!==e||K(),X(e,["--","++","!"])||X(e,["-","+"])&&(X(g,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||X(j.last_text,q)||","===j.last_text)?(a=!1,b=!1,";"===j.last_text&&S(j.mode)&&(a=!0),"TK_WORD"===g&&X(j.last_text,q)&&(a=!0),j.mode!==A.BlockStatement&&j.mode!==A.Statement||"{"!==j.last_text&&";"!==j.last_text||K()):":"===e?0===j.ternary_depth?(j.mode===A.BlockStatement&&(j.mode=A.ObjectLiteral),a=!1):j.ternary_depth-=1:"?"===e&&(j.ternary_depth+=1),w=w||a,O(),w=b,void 0):(O(),void 0)}function jb(){var b,a=G(e);if(V(a.slice(1),"*"))for(K(!1,!0),O(a[0]),b=1;a.length>b;b++)K(!1,!0),O(" "+F(a[b]));else for(a.length>1?K(!1,!0):"TK_END_BLOCK"===g?K(!1,!0):w=!0,O(a[0]),d.push("\n"),b=1;a.length>b;b++)d.push(a[b]),d.push("\n");Z("\n")||K(!1,!0)}function kb(){w=!0,O(),w=!0}function lb(){t&&K(!1,!0),","!==j.last_text||t||E(!0),w=!0,O(),K(!1,!0)}function mb(){W(j.last_text)?w=!0:J(")"===j.last_text&&B.break_chained_methods),O()}function nb(){O(),"\n"===e[e.length-1]&&K()}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C="";for(m="\n\r	 ".split(""),n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),r="0123456789".split(""),o="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",o+=" <%= <% %> <?= <? ?>",o=o.split(" "),q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),A={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},z={TK_START_EXPR:_,TK_END_EXPR:ab,TK_START_BLOCK:bb,TK_END_BLOCK:cb,TK_WORD:db,TK_SEMICOLON:eb,TK_STRING:fb,TK_EQUALS:gb,TK_OPERATOR:ib,TK_COMMA:hb,TK_BLOCK_COMMENT:jb,TK_INLINE_COMMENT:kb,TK_COMMENT:lb,TK_DOT:mb,TK_UNKNOWN:nb},b=b?b:{},B={},void 0!==b.space_after_anon_function&&void 0===b.jslint_happy&&(b.jslint_happy=b.space_after_anon_function),void 0!==b.braces_on_own_line&&(B.brace_style=b.braces_on_own_line?"expand":"collapse"),B.brace_style=b.brace_style?b.brace_style:B.brace_style?B.brace_style:"collapse",B.indent_size=b.indent_size?parseInt(b.indent_size,10):4,B.indent_char=b.indent_char?b.indent_char:" ",B.preserve_newlines=void 0===b.preserve_newlines?!0:b.preserve_newlines,B.break_chained_methods=void 0===b.break_chained_methods?!1:b.break_chained_methods,B.max_preserve_newlines=void 0===b.max_preserve_newlines?0:parseInt(b.max_preserve_newlines,10),B.jslint_happy=void 0===b.jslint_happy?!1:b.jslint_happy,B.keep_array_indentation=void 0===b.keep_array_indentation?!1:b.keep_array_indentation,B.space_before_conditional=void 0===b.space_before_conditional?!0:b.space_before_conditional,B.unescape_strings=void 0===b.unescape_strings?!1:b.unescape_strings,B.wrap_line_length=void 0===b.wrap_line_length?0:parseInt(b.wrap_line_length,10),i="";B.indent_size>0;)i+=B.indent_char,B.indent_size-=1;for(;a&&(" "===a.charAt(0)||"	"===a.charAt(0));)C+=a.charAt(0),a=a.substring(1);c=a,y=a.length,g="TK_START_BLOCK",h="",d=[],v=!1,w=!1,x=[],l=[],Q(A.BlockStatement),p=0,this.beautify=function(){for(var a,b,c,i;;){if(a=$(),e=a[0],f=a[1],"TK_EOF"===f)break;if(c=B.keep_array_indentation&&R(j.mode))for(b=0;u>b;b+=1)K(!0);else if(t=u>0,B.max_preserve_newlines&&u>B.max_preserve_newlines&&(u=B.max_preserve_newlines),B.preserve_newlines&&u>1)for(K(),b=1;u>b;b+=1)K(!0);z[f](),"TK_INLINE_COMMENT"!==f&&"TK_COMMENT"!==f&&"TK_UNKNOWN"!==f&&(h=j.last_text,g=f,j.last_text=e)}return i=C+d.join("").replace(/[\r\n ]+$/,"")}}"function"==typeof define?define(function(b,c){c.js_beautify=a}):"undefined"!=typeof exports?exports.js_beautify=a:"undefined"!=typeof window&&(window.js_beautify=a)})();
		var innerH = '<pre>' + js_beautify(internalUnitTests) + '</pre>';
	}
	document.getElementsByTagName("html")[0].innerHTML = innerH;
	document.getElementsByTagName("html")[0].setAttribute("contenteditable","");
	console.log('Types Jaave when UnitTest is Written... Or write in console saveMyCode();');
	
	unsafeWindow.saveMyCode = function(){
		localStorage.saveUnitTest = true;
		console.log('Save Requested');
	};
	
	GM_wait_save();
});


function GM_wait_save() {
	if (unsafeWindow.localStorage.saveUnitTest == 'true') {
		console.log('Perform Save');
		console.log(jaave);
		window.setTimeout(jaave, 1000);
	} else {
		window.setTimeout(GM_wait_save, 1000);
	}
}

function GM_wait_jasmine() {
	if (typeof unsafeWindow.localStorage.runJasmine != 'undefined' && unsafeWindow.localStorage.runJasmine == 'true') {
		window.setTimeout(buildJasmineInit, 1000);
	} else {
		window.setTimeout(GM_wait_jasmine, 1000);
	}
}

function execJasmine() {
	try{
	console.log(GM_getValue(unsafeWindow.location.pathname + "_unitTests"));
	eval(GM_getValue(unsafeWindow.location.pathname + "_unitTests"));
	console.log(jasmineEnv.execute());
	}catch(err){
	  //Handle errors here
			console.log('jasmineExecErr');
			console.log(err);
	  }
}

function buildJasmineInit(){
	  console.log('Do Init Again');
	  console.log(jasmine);
	  var jasmineEnv = jasmine.getEnv();
	  //jasmineEnv.updateInterval = 1000;
	  console.log(jasmineEnv);
	  var htmlReporter = new jasmine.HtmlReporter();

	  jasmineEnv.addReporter(htmlReporter);

	  jasmineEnv.specFilter = function(spec) {
			return htmlReporter.specFilter(spec);
	  };

	  var currentWindowOnload = unsafeWindow.onload;
	  //execJasmine();
	  
		try{
			console.log(GM_getValue(unsafeWindow.location.pathname + "_unitTests"));
			eval(GM_getValue(unsafeWindow.location.pathname + "_unitTests"));
			console.log(jasmineEnv.execute());
		}catch(err){
		  //Handle errors here
				console.log('jasmineExecErr');
				console.log(err);
		 }

	unsafeWindow.localStorage.runJasmine = false;
	GM_wait_jasmine();
}

function jaave(){
	console.log('Do Save');
	try{
		GM_setValue(window.location.pathname + "_unitTests" , stripSave(typeof document.getElementsByTagName("pre") != 'undefined' ? document.getElementsByTagName("pre")[0].innerHTML : document.getElementsByTagName("html")[0].innerHTML));
		location.reload(); 
	}catch(err){
  //Handle errors here
		console.log('jasmineExecErr');
		console.log(err);
	}
}

Mousetrap.bind('j a a v e', function(e) { 
	jaave();
});


function stripSave(html){
	var tmp = document.createElement("DIV");
	tmp.innerHTML = html;
	return tmp.textContent || tmp.innerText;
}

Mousetrap.bind('j a n d', function(e) { 
	//StandAloneGenerator
	var sourceLinks = new Array();
	
	//Get All ScriptLinks
	scriptEle = document.getElementsByTagName("script");
	
	for (var i = 0; i < scriptEle.length; i++) {
			if (scriptEle[i].getAttribute("src") != null){
			 sourceLinks[i] = scriptEle[i].getAttribute("src");
			 }
	}
	
	//Replace HTML
	var elements = document.getElementsByTagName('html');
	for (var i = 0; i < elements.length; i++) {
			 elements[i].innerHTML = jasmineStaticTemplate;
	}
	
	//Add JS Sources                
	for (var i = 0; i < sourceLinks.length; i++) {
			var js = document.createElement("script");
			js.type = "text/javascript";
			js.src = sourceLinks[i];
			document.body.appendChild(js);                  
	}
	
	//Add JS path
	testJsUrl = mappingUrl + window.location.pathname.replace("/","_")  + '_test.js';
	var js = document.createElement("script");
	js.type = "text/javascript";
	js.src = testJsUrl;						
	document.body.appendChild(js);  
	
	fullHtmlCode = document.getElementsByTagName('html')[0].innerHTML;
	
	document.getElementsByTagName('html')[0].innerHTML = '';
	
	console.log(fullHtmlCode);
	//uriContent = "data:application/octet-stream," + encodeURIComponent(fullHtmlCode);
	//newWindow=window.open(uriContent, 'neuesDokument');
});
