// ==UserScript==
// @name mapjack
// @namespace http://tschaub.net/mapjack/
// @version 0.0.5
// @description Map based editing of GeoJSON files on GitHub.
// @match https://github.com/*/*/edit/*/*.geojson
// @grant unsafeWindow
// @copyright 2013+, Tim Schaub
// ==/UserScript==
;var window=unsafeWindow,OpenLayers={VERSION_NUMBER:"Release 2.13 dev",singleFile:!0,_getScriptLocation:function(){for(var src,m,r=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),s=document.getElementsByTagName("script"),l="",i=0,len=s.length;len>i;i++)if(src=s[i].getAttribute("src"),src&&(m=src.match(r))){l=m[1];break}return function(){return l}}(),ImgPath:""};OpenLayers.Class=function(){var len=arguments.length,P=arguments[0],F=arguments[len-1],C="function"==typeof F.initialize?F.initialize:function(){P.prototype.initialize.apply(this,arguments)};if(len>1){var newArgs=[C,P].concat(Array.prototype.slice.call(arguments).slice(1,len-1),F);OpenLayers.inherit.apply(null,newArgs)}else C.prototype=F;return C},OpenLayers.inherit=function(C,P){var F=function(){};F.prototype=P.prototype,C.prototype=new F;var i,l,o;for(i=2,l=arguments.length;l>i;i++)o=arguments[i],"function"==typeof o&&(o=o.prototype),OpenLayers.Util.extend(C.prototype,o)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(destination,source){if(destination=destination||{},source){for(var property in source){var value=source[property];void 0!==value&&(destination[property]=value)}var sourceIsEvt="function"==typeof window.Event&&source instanceof window.Event;!sourceIsEvt&&source.hasOwnProperty&&source.hasOwnProperty("toString")&&(destination.toString=source.toString)}return destination},OpenLayers.String={startsWith:function(str,sub){return 0==str.indexOf(sub)},contains:function(str,sub){return-1!=str.indexOf(sub)},trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(str){for(var oStringList=str.split("-"),camelizedString=oStringList[0],i=1,len=oStringList.length;len>i;i++){var s=oStringList[i];camelizedString+=s.charAt(0).toUpperCase()+s.substring(1)}return camelizedString},format:function(template,context,args){context||(context=window);var replacer=function(str,match){for(var replacement,subs=match.split(/\.+/),i=0;i<subs.length&&(0==i&&(replacement=context),void 0!==replacement);i++)replacement=replacement[subs[i]];return"function"==typeof replacement&&(replacement=args?replacement.apply(null,args):replacement()),"undefined"==typeof replacement?"undefined":replacement};return template.replace(OpenLayers.String.tokenRegEx,replacer)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(value){return OpenLayers.String.numberRegEx.test(value)},numericIf:function(value,trimWhitespace){var originalValue=value;return trimWhitespace===!0&&null!=value&&value.replace&&(value=value.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(value)?parseFloat(value):originalValue}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(num,sig){var fig=0;return sig>0&&(fig=parseFloat(num.toPrecision(sig))),fig},format:function(num,dec,tsep,dsep){dec="undefined"!=typeof dec?dec:0,tsep="undefined"!=typeof tsep?tsep:OpenLayers.Number.thousandsSeparator,dsep="undefined"!=typeof dsep?dsep:OpenLayers.Number.decimalSeparator,null!=dec&&(num=parseFloat(num.toFixed(dec)));var parts=num.toString().split(".");1==parts.length&&null==dec&&(dec=0);var integer=parts[0];if(tsep)for(var thousands=/(-?[0-9]+)([0-9]{3})/;thousands.test(integer);)integer=integer.replace(thousands,"$1"+tsep+"$2");var str;if(0==dec)str=integer;else{var rem=parts.length>1?parts[1]:"0";null!=dec&&(rem+=new Array(dec-rem.length+1).join("0")),str=integer+dsep+rem}return str},zeroPad:function(num,len,radix){for(var str=num.toString(radix||10);str.length<len;)str="0"+str;return str}},OpenLayers.Function={bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));return func.apply(object,newArgs)}},bindAsEventListener:function(func,object){return function(event){return func.call(object,event||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(array,callback,caller){var selected=[];if(Array.prototype.filter)selected=array.filter(callback,caller);else{var len=array.length;if("function"!=typeof callback)throw new TypeError;for(var i=0;len>i;i++)if(i in array){var val=array[i];callback.call(caller,val,i,array)&&selected.push(val)}}return selected}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(left,bottom,right,top){OpenLayers.Util.isArray(left)&&(top=left[3],right=left[2],bottom=left[1],left=left[0]),null!=left&&(this.left=OpenLayers.Util.toFloat(left)),null!=bottom&&(this.bottom=OpenLayers.Util.toFloat(bottom)),null!=right&&(this.right=OpenLayers.Util.toFloat(right)),null!=top&&(this.top=OpenLayers.Util.toFloat(top))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(bounds){var equals=!1;return null!=bounds&&(equals=this.left==bounds.left&&this.right==bounds.right&&this.top==bounds.top&&this.bottom==bounds.bottom),equals},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(reverseAxisOrder){return reverseAxisOrder===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(decimal,reverseAxisOrder){null==decimal&&(decimal=6);var mult=Math.pow(10,decimal),xmin=Math.round(this.left*mult)/mult,ymin=Math.round(this.bottom*mult)/mult,xmax=Math.round(this.right*mult)/mult,ymax=Math.round(this.top*mult)/mult;return reverseAxisOrder===!0?ymin+","+xmin+","+ymax+","+xmax:xmin+","+ymin+","+xmax+","+ymax},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(ratio,origin){null==origin&&(origin=this.getCenterLonLat());var origx,origy;"OpenLayers.LonLat"==origin.CLASS_NAME?(origx=origin.lon,origy=origin.lat):(origx=origin.x,origy=origin.y);var left=(this.left-origx)*ratio+origx,bottom=(this.bottom-origy)*ratio+origy,right=(this.right-origx)*ratio+origx,top=(this.top-origy)*ratio+origy;return new OpenLayers.Bounds(left,bottom,right,top)},add:function(x,y){if(null==x||null==y)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+x,this.bottom+y,this.right+x,this.top+y)},extend:function(object){if(object)switch(object.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(object.lon,object.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(object.x,object.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||object.left<this.left)&&(this.left=object.left),(null==this.bottom||object.bottom<this.bottom)&&(this.bottom=object.bottom),(null==this.right||object.right>this.right)&&(this.right=object.right),(null==this.top||object.top>this.top)&&(this.top=object.top)}},extendXY:function(x,y){this.centerLonLat=null,(null==this.left||x<this.left)&&(this.left=x),(null==this.bottom||y<this.bottom)&&(this.bottom=y),(null==this.right||x>this.right)&&(this.right=x),(null==this.top||y>this.top)&&(this.top=y)},containsLonLat:function(ll,options){"boolean"==typeof options&&(options={inclusive:options}),options=options||{};var contains=this.contains(ll.lon,ll.lat,options.inclusive),worldBounds=options.worldBounds;if(worldBounds&&!contains){var worldWidth=worldBounds.getWidth(),worldCenterX=(worldBounds.left+worldBounds.right)/2,worldsAway=Math.round((ll.lon-worldCenterX)/worldWidth);contains=this.containsLonLat({lon:ll.lon-worldsAway*worldWidth,lat:ll.lat},{inclusive:options.inclusive})}return contains},containsPixel:function(px,inclusive){return this.contains(px.x,px.y,inclusive)},contains:function(x,y,inclusive){if(null==inclusive&&(inclusive=!0),null==x||null==y)return!1;x=OpenLayers.Util.toFloat(x),y=OpenLayers.Util.toFloat(y);var contains=!1;return contains=inclusive?x>=this.left&&x<=this.right&&y>=this.bottom&&y<=this.top:x>this.left&&x<this.right&&y>this.bottom&&y<this.top},intersectsBounds:function(bounds,options){if("boolean"==typeof options&&(options={inclusive:options}),options=options||{},options.worldBounds){var self=this.wrapDateLine(options.worldBounds);bounds=bounds.wrapDateLine(options.worldBounds)}else self=this;null==options.inclusive&&(options.inclusive=!0);var intersects=!1,mightTouch=self.left==bounds.right||self.right==bounds.left||self.top==bounds.bottom||self.bottom==bounds.top;if(options.inclusive||!mightTouch){var inBottom=bounds.bottom>=self.bottom&&bounds.bottom<=self.top||self.bottom>=bounds.bottom&&self.bottom<=bounds.top,inTop=bounds.top>=self.bottom&&bounds.top<=self.top||self.top>bounds.bottom&&self.top<bounds.top,inLeft=bounds.left>=self.left&&bounds.left<=self.right||self.left>=bounds.left&&self.left<=bounds.right,inRight=bounds.right>=self.left&&bounds.right<=self.right||self.right>=bounds.left&&self.right<=bounds.right;intersects=(inBottom||inTop)&&(inLeft||inRight)}if(options.worldBounds&&!intersects){var world=options.worldBounds,width=world.getWidth(),selfCrosses=!world.containsBounds(self),boundsCrosses=!world.containsBounds(bounds);selfCrosses&&!boundsCrosses?(bounds=bounds.add(-width,0),intersects=self.intersectsBounds(bounds,{inclusive:options.inclusive})):boundsCrosses&&!selfCrosses&&(self=self.add(-width,0),intersects=bounds.intersectsBounds(self,{inclusive:options.inclusive}))}return intersects},containsBounds:function(bounds,partial,inclusive){null==partial&&(partial=!1),null==inclusive&&(inclusive=!0);var bottomLeft=this.contains(bounds.left,bounds.bottom,inclusive),bottomRight=this.contains(bounds.right,bounds.bottom,inclusive),topLeft=this.contains(bounds.left,bounds.top,inclusive),topRight=this.contains(bounds.right,bounds.top,inclusive);return partial?bottomLeft||bottomRight||topLeft||topRight:bottomLeft&&bottomRight&&topLeft&&topRight},determineQuadrant:function(lonlat){var quadrant="",center=this.getCenterLonLat();return quadrant+=lonlat.lat<center.lat?"b":"t",quadrant+=lonlat.lon<center.lon?"l":"r"},transform:function(source,dest){this.centerLonLat=null;var ll=OpenLayers.Projection.transform({x:this.left,y:this.bottom},source,dest),lr=OpenLayers.Projection.transform({x:this.right,y:this.bottom},source,dest),ul=OpenLayers.Projection.transform({x:this.left,y:this.top},source,dest),ur=OpenLayers.Projection.transform({x:this.right,y:this.top},source,dest);return this.left=Math.min(ll.x,ul.x),this.bottom=Math.min(ll.y,lr.y),this.right=Math.max(lr.x,ur.x),this.top=Math.max(ul.y,ur.y),this},wrapDateLine:function(maxExtent,options){options=options||{};var leftTolerance=options.leftTolerance||0,rightTolerance=options.rightTolerance||0,newBounds=this.clone();if(maxExtent){for(var width=maxExtent.getWidth();newBounds.left<maxExtent.left&&newBounds.right-rightTolerance<=maxExtent.left;)newBounds=newBounds.add(width,0);for(;newBounds.left+leftTolerance>=maxExtent.right&&newBounds.right>maxExtent.right;)newBounds=newBounds.add(-width,0);var newLeft=newBounds.left+leftTolerance;newLeft<maxExtent.right&&newLeft>maxExtent.left&&newBounds.right-rightTolerance>maxExtent.right&&(newBounds=newBounds.add(-width,0))}return newBounds},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(str,reverseAxisOrder){var bounds=str.split(",");return OpenLayers.Bounds.fromArray(bounds,reverseAxisOrder)},OpenLayers.Bounds.fromArray=function(bbox,reverseAxisOrder){return reverseAxisOrder===!0?new OpenLayers.Bounds(bbox[1],bbox[0],bbox[3],bbox[2]):new OpenLayers.Bounds(bbox[0],bbox[1],bbox[2],bbox[3])},OpenLayers.Bounds.fromSize=function(size){return new OpenLayers.Bounds(0,size.h,size.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(quadrant){var opp="";return opp+="t"==quadrant.charAt(0)?"b":"t",opp+="l"==quadrant.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(element){return"none"!=OpenLayers.Util.getElement(element).style.display},toggle:function(){for(var i=0,len=arguments.length;len>i;i++){var element=OpenLayers.Util.getElement(arguments[i]),display=OpenLayers.Element.visible(element)?"none":"";element.style.display=display}},remove:function(element){element=OpenLayers.Util.getElement(element),element.parentNode.removeChild(element)},getHeight:function(element){return element=OpenLayers.Util.getElement(element),element.offsetHeight},hasClass:function(element,name){var names=element.className;return!!names&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(names)},addClass:function(element,name){return OpenLayers.Element.hasClass(element,name)||(element.className+=(element.className?" ":"")+name),element},removeClass:function(element,name){var names=element.className;return names&&(element.className=OpenLayers.String.trim(names.replace(new RegExp("(^|\\s+)"+name+"(\\s+|$)")," "))),element},toggleClass:function(element,name){return OpenLayers.Element.hasClass(element,name)?OpenLayers.Element.removeClass(element,name):OpenLayers.Element.addClass(element,name),element},getStyle:function(element,style){element=OpenLayers.Util.getElement(element);var value=null;if(element&&element.style){if(value=element.style[OpenLayers.String.camelize(style)],!value)if(document.defaultView&&document.defaultView.getComputedStyle){var css=document.defaultView.getComputedStyle(element,null);value=css?css.getPropertyValue(style):null}else element.currentStyle&&(value=element.currentStyle[OpenLayers.String.camelize(style)]);var positions=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(positions,style)&&"static"==OpenLayers.Element.getStyle(element,"position")&&(value="auto")}return"auto"==value?null:value}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(lon,lat){OpenLayers.Util.isArray(lon)&&(lat=lon[1],lon=lon[0]),this.lon=OpenLayers.Util.toFloat(lon),this.lat=OpenLayers.Util.toFloat(lat)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(lon,lat){if(null==lon||null==lat)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(lon),this.lat+OpenLayers.Util.toFloat(lat))},equals:function(ll){var equals=!1;return null!=ll&&(equals=this.lon==ll.lon&&this.lat==ll.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(ll.lon)&&isNaN(ll.lat)),equals},transform:function(source,dest){var point=OpenLayers.Projection.transform({x:this.lon,y:this.lat},source,dest);return this.lon=point.x,this.lat=point.y,this},wrapDateLine:function(maxExtent){var newLonLat=this.clone();if(maxExtent){for(;newLonLat.lon<maxExtent.left;)newLonLat.lon+=maxExtent.getWidth();for(;newLonLat.lon>maxExtent.right;)newLonLat.lon-=maxExtent.getWidth()}return newLonLat},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(str){var pair=str.split(",");return new OpenLayers.LonLat(pair[0],pair[1])},OpenLayers.LonLat.fromArray=function(arr){var gotArr=OpenLayers.Util.isArray(arr),lon=gotArr&&arr[0],lat=gotArr&&arr[1];return new OpenLayers.LonLat(lon,lat)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(x,y){this.x=parseFloat(x),this.y=parseFloat(y)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(px){var equals=!1;return null!=px&&(equals=this.x==px.x&&this.y==px.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(px.x)&&isNaN(px.y)),equals},distanceTo:function(px){return Math.sqrt(Math.pow(this.x-px.x,2)+Math.pow(this.y-px.y,2))},add:function(x,y){if(null==x||null==y)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+x,this.y+y)},offset:function(px){var newPx=this.clone();return px&&(newPx=this.add(px.x,px.y)),newPx},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(w,h){this.w=parseFloat(w),this.h=parseFloat(h)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(sz){var equals=!1;return null!=sz&&(equals=this.w==sz.w&&this.h==sz.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(sz.w)&&isNaN(sz.h)),equals},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(error){alert(error)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var scripts=document.getElementsByTagName("script"),i=0,len=scripts.length;len>i;++i)if(-1!=scripts[i].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(code){var lang;code||(code="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var parts=code.split("-");if(parts[0]=parts[0].toLowerCase(),"object"==typeof OpenLayers.Lang[parts[0]]&&(lang=parts[0]),parts[1]){var testLang=parts[0]+"-"+parts[1].toUpperCase();"object"==typeof OpenLayers.Lang[testLang]&&(lang=testLang)}lang||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+parts.join("-")+" dictionary, falling back to default language"),lang=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=lang},translate:function(key,context){var dictionary=OpenLayers.Lang[OpenLayers.Lang.getCode()],message=dictionary&&dictionary[key];return message||(message=key),context&&(message=OpenLayers.String.format(message,context)),message}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var elements=[],i=0,len=arguments.length;len>i;i++){var element=arguments[i];if("string"==typeof element&&(element=document.getElementById(element)),1==arguments.length)return element;elements.push(element)}return elements},OpenLayers.Util.isElement=function(o){return!(!o||1!==o.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(array,item){for(var i=array.length-1;i>=0;i--)array[i]==item&&array.splice(i,1);return array},OpenLayers.Util.indexOf=function(array,obj){if("function"==typeof array.indexOf)return array.indexOf(obj);for(var i=0,len=array.length;len>i;i++)if(array[i]==obj)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){id&&(element.id=id.replace(OpenLayers.Util.dotless,"_")),px&&(element.style.left=px.x+"px",element.style.top=px.y+"px"),sz&&(element.style.width=sz.w+"px",element.style.height=sz.h+"px"),position&&(element.style.position=position),border&&(element.style.border=border),overflow&&(element.style.overflow=overflow),parseFloat(opacity)>=0&&parseFloat(opacity)<1?(element.style.filter="alpha(opacity="+100*opacity+")",element.style.opacity=opacity):1==parseFloat(opacity)&&(element.style.filter="",element.style.opacity="")},OpenLayers.Util.createDiv=function(id,px,sz,imgURL,position,border,overflow,opacity){var dom=document.createElement("div");return imgURL&&(dom.style.backgroundImage="url("+imgURL+")"),id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="absolute"),OpenLayers.Util.modifyDOMElement(dom,id,px,sz,position,border,overflow,opacity),dom},OpenLayers.Util.createImage=function(id,px,sz,imgURL,position,border,opacity,delayDisplay){function display(){image.style.display="",OpenLayers.Event.stopObservingElement(image)}var image=document.createElement("img");return id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="relative"),OpenLayers.Util.modifyDOMElement(image,id,px,sz,position,border,null,opacity),delayDisplay&&(image.style.display="none",OpenLayers.Event.observe(image,"load",display),OpenLayers.Event.observe(image,"error",display)),image.style.alt=id,image.galleryImg="no",imgURL&&(image.src=imgURL),image},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var arVersion=navigator.appVersion.split("MSIE"),version=parseFloat(arVersion[1]),filter=!1;try{filter=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=filter&&version>=5.5&&7>version}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(div,id,px,sz,imgURL,position,border,sizing,opacity){OpenLayers.Util.modifyDOMElement(div,id,px,sz,position,null,null,opacity);var img=div.childNodes[0];imgURL&&(img.src=imgURL),OpenLayers.Util.modifyDOMElement(img,div.id+"_innerImage",null,sz,"relative",border),OpenLayers.Util.alphaHack()&&("none"!=div.style.display&&(div.style.display="inline-block"),null==sizing&&(sizing="scale"),div.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', "+"sizingMethod='"+sizing+"')",parseFloat(div.style.opacity)>=0&&parseFloat(div.style.opacity)<1&&(div.style.filter+=" alpha(opacity="+100*div.style.opacity+")"),img.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(id,px,sz,imgURL,position,border,sizing,opacity,delayDisplay){var div=OpenLayers.Util.createDiv(),img=OpenLayers.Util.createImage(null,null,null,null,null,null,null,delayDisplay);return img.className="olAlphaImg",div.appendChild(img),OpenLayers.Util.modifyAlphaImageDiv(div,id,px,sz,imgURL,position,border,sizing,opacity),div},OpenLayers.Util.upperCaseObject=function(object){var uObject={};for(var key in object)uObject[key.toUpperCase()]=object[key];return uObject},OpenLayers.Util.applyDefaults=function(to,from){to=to||{};var fromIsEvt="function"==typeof window.Event&&from instanceof window.Event;for(var key in from)(void 0===to[key]||!fromIsEvt&&from.hasOwnProperty&&from.hasOwnProperty(key)&&!to.hasOwnProperty(key))&&(to[key]=from[key]);return!fromIsEvt&&from&&from.hasOwnProperty&&from.hasOwnProperty("toString")&&!to.hasOwnProperty("toString")&&(to.toString=from.toString),to},OpenLayers.Util.getParameterString=function(params){var paramsArray=[];for(var key in params){var value=params[key];if(null!=value&&"function"!=typeof value){var encodedValue;if("object"==typeof value&&value.constructor==Array){for(var item,encodedItemArray=[],itemIndex=0,len=value.length;len>itemIndex;itemIndex++)item=value[itemIndex],encodedItemArray.push(encodeURIComponent(null===item||void 0===item?"":item));encodedValue=encodedItemArray.join(",")}else encodedValue=encodeURIComponent(value);paramsArray.push(encodeURIComponent(key)+"="+encodedValue)}}return paramsArray.join("&")},OpenLayers.Util.urlAppend=function(url,paramStr){var newUrl=url;if(paramStr){var parts=(url+" ").split(/[?&]/);newUrl+=" "===parts.pop()?paramStr:parts.length?"&"+paramStr:"?"+paramStr}return newUrl},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(image){return OpenLayers.Util.getImagesLocation()+image},OpenLayers.Util.Try=function(){for(var returnValue=null,i=0,len=arguments.length;len>i;i++){var lambda=arguments[i];try{returnValue=lambda();break}catch(e){}}return returnValue},OpenLayers.Util.getXmlNodeValue=function(node){var val=null;return OpenLayers.Util.Try(function(){val=node.text,val||(val=node.textContent),val||(val=node.firstChild.nodeValue)},function(){val=node.textContent}),val},OpenLayers.Util.mouseLeft=function(evt,div){for(var target=evt.relatedTarget?evt.relatedTarget:evt.toElement;target!=div&&null!=target;)target=target.parentNode;return target!=div},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(number,precision){return null==precision&&(precision=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof number&&(number=parseFloat(number)),0===precision?number:parseFloat(number.toPrecision(precision))},OpenLayers.Util.rad=function(x){return x*Math.PI/180},OpenLayers.Util.deg=function(x){return 180*x/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(p1,p2){for(var ct=OpenLayers.Util.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,L=OpenLayers.Util.rad(p2.lon-p1.lon),U1=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p1.lat))),U2=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p2.lat))),sinU1=Math.sin(U1),cosU1=Math.cos(U1),sinU2=Math.sin(U2),cosU2=Math.cos(U2),lambda=L,lambdaP=2*Math.PI,iterLimit=20;Math.abs(lambda-lambdaP)>1e-12&&--iterLimit>0;){var sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda),sinSigma=Math.sqrt(cosU2*sinLambda*cosU2*sinLambda+(cosU1*sinU2-sinU1*cosU2*cosLambda)*(cosU1*sinU2-sinU1*cosU2*cosLambda));if(0==sinSigma)return 0;var cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda,sigma=Math.atan2(sinSigma,cosSigma),alpha=Math.asin(cosU1*cosU2*sinLambda/sinSigma),cosSqAlpha=Math.cos(alpha)*Math.cos(alpha),cos2SigmaM=cosSigma-2*sinU1*sinU2/cosSqAlpha,C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));lambdaP=lambda,lambda=L+(1-C)*f*Math.sin(alpha)*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)))}if(0==iterLimit)return 0/0;var uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM))),s=b*A*(sigma-deltaSigma),d=s.toFixed(3)/1e3;return d},OpenLayers.Util.destinationVincenty=function(lonlat,brng,dist){for(var u=OpenLayers.Util,ct=u.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,lon1=lonlat.lon,lat1=lonlat.lat,s=dist,alpha1=u.rad(brng),sinAlpha1=Math.sin(alpha1),cosAlpha1=Math.cos(alpha1),tanU1=(1-f)*Math.tan(u.rad(lat1)),cosU1=1/Math.sqrt(1+tanU1*tanU1),sinU1=tanU1*cosU1,sigma1=Math.atan2(tanU1,cosAlpha1),sinAlpha=cosU1*sinAlpha1,cosSqAlpha=1-sinAlpha*sinAlpha,uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),sigma=s/(b*A),sigmaP=2*Math.PI;Math.abs(sigma-sigmaP)>1e-12;){var cos2SigmaM=Math.cos(2*sigma1+sigma),sinSigma=Math.sin(sigma),cosSigma=Math.cos(sigma),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));sigmaP=sigma,sigma=s/(b*A)+deltaSigma}var tmp=sinU1*sinSigma-cosU1*cosSigma*cosAlpha1,lat2=Math.atan2(sinU1*cosSigma+cosU1*sinSigma*cosAlpha1,(1-f)*Math.sqrt(sinAlpha*sinAlpha+tmp*tmp)),lambda=Math.atan2(sinSigma*sinAlpha1,cosU1*cosSigma-sinU1*sinSigma*cosAlpha1),C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha)),L=lambda-(1-C)*f*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)));return Math.atan2(sinAlpha,-tmp),new OpenLayers.LonLat(lon1+u.deg(L),u.deg(lat2))},OpenLayers.Util.getParameters=function(url,options){options=options||{},url=null===url||void 0===url?window.location.href:url;var paramsString="";if(OpenLayers.String.contains(url,"?")){var start=url.indexOf("?")+1,end=OpenLayers.String.contains(url,"#")?url.indexOf("#"):url.length;paramsString=url.substring(start,end)}for(var parameters={},pairs=paramsString.split(/[&;]/),i=0,len=pairs.length;len>i;++i){var keyValue=pairs[i].split("=");if(keyValue[0]){var key=keyValue[0];try{key=decodeURIComponent(key)}catch(err){key=unescape(key)}var value=(keyValue[1]||"").replace(/\+/g," ");try{value=decodeURIComponent(value)}catch(err){value=unescape(value)}options.splitArgs!==!1&&(value=value.split(",")),1==value.length&&(value=value[0]),parameters[key]=value}}return parameters},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(prefix){return prefix=null==prefix?"id_":prefix.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,prefix+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(scale){var normScale=scale>1?1/scale:scale;
return normScale},OpenLayers.Util.getResolutionFromScale=function(scale,units){var resolution;if(scale){null==units&&(units="degrees");var normScale=OpenLayers.Util.normalizeScale(scale);resolution=1/(normScale*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH)}return resolution},OpenLayers.Util.getScaleFromResolution=function(resolution,units){null==units&&(units="degrees");var scale=resolution*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH;return scale},OpenLayers.Util.pagePosition=function(forElement){var pos=[0,0],viewportElement=OpenLayers.Util.getViewportElement();if(!forElement||forElement==window||forElement==viewportElement)return pos;var box,BUGGY_GECKO_BOX_OBJECT=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(forElement,"position")&&(""==forElement.style.top||""==forElement.style.left),parent=null;if(forElement.getBoundingClientRect){box=forElement.getBoundingClientRect();var scrollTop=window.pageYOffset||viewportElement.scrollTop,scrollLeft=window.pageXOffset||viewportElement.scrollLeft;pos[0]=box.left+scrollLeft,pos[1]=box.top+scrollTop}else if(document.getBoxObjectFor&&!BUGGY_GECKO_BOX_OBJECT){box=document.getBoxObjectFor(forElement);var vpBox=document.getBoxObjectFor(viewportElement);pos[0]=box.screenX-vpBox.screenX,pos[1]=box.screenY-vpBox.screenY}else{if(pos[0]=forElement.offsetLeft,pos[1]=forElement.offsetTop,parent=forElement.offsetParent,parent!=forElement)for(;parent;)pos[0]+=parent.offsetLeft,pos[1]+=parent.offsetTop,parent=parent.offsetParent;var browser=OpenLayers.BROWSER_NAME;for(("opera"==browser||"safari"==browser&&"absolute"==OpenLayers.Element.getStyle(forElement,"position"))&&(pos[1]-=document.body.offsetTop),parent=forElement.offsetParent;parent&&parent!=document.body;)pos[0]-=parent.scrollLeft,("opera"!=browser||"TR"!=parent.tagName)&&(pos[1]-=parent.scrollTop),parent=parent.offsetParent}return pos},OpenLayers.Util.getViewportElement=function(){var viewportElement=arguments.callee.viewportElement;return void 0==viewportElement&&(viewportElement="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=viewportElement),viewportElement},OpenLayers.Util.isEquivalentUrl=function(url1,url2,options){options=options||{},OpenLayers.Util.applyDefaults(options,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var urlObj1=OpenLayers.Util.createUrlObject(url1,options),urlObj2=OpenLayers.Util.createUrlObject(url2,options);for(var key in urlObj1)if("args"!==key&&urlObj1[key]!=urlObj2[key])return!1;for(var key in urlObj1.args){if(urlObj1.args[key]!=urlObj2.args[key])return!1;delete urlObj2.args[key]}for(var key in urlObj2.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(url,options){if(options=options||{},!/^\w+:\/\//.test(url)){var loc=window.location,port=loc.port?":"+loc.port:"",fullUrl=loc.protocol+"//"+loc.host.split(":").shift()+port;if(0===url.indexOf("/"))url=fullUrl+url;else{var parts=loc.pathname.split("/");parts.pop(),url=fullUrl+parts.join("/")+"/"+url}}options.ignoreCase&&(url=url.toLowerCase());var a=document.createElement("a");a.href=url;var urlObject={};urlObject.host=a.host.split(":").shift(),urlObject.protocol=a.protocol,urlObject.port=options.ignorePort80?"80"==a.port||"0"==a.port?"":a.port:""==a.port||"0"==a.port?"80":a.port,urlObject.hash=options.ignoreHash||"#"===a.hash?"":a.hash;var queryString=a.search;if(!queryString){var qMark=url.indexOf("?");queryString=-1!=qMark?url.substr(qMark):""}return urlObject.args=OpenLayers.Util.getParameters(queryString,{splitArgs:options.splitArgs}),urlObject.pathname="/"==a.pathname.charAt(0)?a.pathname:"/"+a.pathname,urlObject},OpenLayers.Util.removeTail=function(url){var head=null,qMark=url.indexOf("?"),hashMark=url.indexOf("#");return head=-1==qMark?-1!=hashMark?url.substr(0,hashMark):url:-1!=hashMark?url.substr(0,Math.min(qMark,hashMark)):url.substr(0,qMark)},OpenLayers.IS_GECKO=function(){var ua=navigator.userAgent.toLowerCase();return-1==ua.indexOf("webkit")&&-1!=ua.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var name="",ua=navigator.userAgent.toLowerCase();return-1!=ua.indexOf("opera")?name="opera":-1!=ua.indexOf("msie")?name="msie":-1!=ua.indexOf("safari")?name="safari":-1!=ua.indexOf("mozilla")&&(name=-1!=ua.indexOf("firefox")?"firefox":"mozilla"),name}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(contentHTML,size,options){var w,h,container=document.createElement("div");container.style.visibility="hidden";for(var containerElement=options&&options.containerElement?options.containerElement:document.body,parentHasPositionAbsolute=!1,superContainer=null,parent=containerElement;parent&&"body"!=parent.tagName.toLowerCase();){var parentPosition=OpenLayers.Element.getStyle(parent,"position");if("absolute"==parentPosition){parentHasPositionAbsolute=!0;break}if(parentPosition&&"static"!=parentPosition)break;parent=parent.parentNode}!parentHasPositionAbsolute||0!==containerElement.clientHeight&&0!==containerElement.clientWidth||(superContainer=document.createElement("div"),superContainer.style.visibility="hidden",superContainer.style.position="absolute",superContainer.style.overflow="visible",superContainer.style.width=document.body.clientWidth+"px",superContainer.style.height=document.body.clientHeight+"px",superContainer.appendChild(container)),container.style.position="absolute",size&&(size.w?(w=size.w,container.style.width=w+"px"):size.h&&(h=size.h,container.style.height=h+"px")),options&&options.displayClass&&(container.className=options.displayClass);var content=document.createElement("div");if(content.innerHTML=contentHTML,content.style.overflow="visible",content.childNodes)for(var i=0,l=content.childNodes.length;l>i;i++)content.childNodes[i].style&&(content.childNodes[i].style.overflow="visible");return container.appendChild(content),superContainer?containerElement.appendChild(superContainer):containerElement.appendChild(container),w||(w=parseInt(content.scrollWidth),container.style.width=w+"px"),h||(h=parseInt(content.scrollHeight)),container.removeChild(content),superContainer?(superContainer.removeChild(container),containerElement.removeChild(superContainer)):containerElement.removeChild(container),new OpenLayers.Size(w,h)},OpenLayers.Util.getScrollbarWidth=function(){var scrollbarWidth=OpenLayers.Util._scrollbarWidth;if(null==scrollbarWidth){var scr=null,inn=null,wNoScroll=0,wScroll=0;scr=document.createElement("div"),scr.style.position="absolute",scr.style.top="-1000px",scr.style.left="-1000px",scr.style.width="100px",scr.style.height="50px",scr.style.overflow="hidden",inn=document.createElement("div"),inn.style.width="100%",inn.style.height="200px",scr.appendChild(inn),document.body.appendChild(scr),wNoScroll=inn.offsetWidth,scr.style.overflow="scroll",wScroll=inn.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=wNoScroll-wScroll,scrollbarWidth=OpenLayers.Util._scrollbarWidth}return scrollbarWidth},OpenLayers.Util.getFormattedLonLat=function(coordinate,axis,dmsOption){dmsOption||(dmsOption="dms"),coordinate=(coordinate+540)%360-180;var abscoordinate=Math.abs(coordinate),coordinatedegrees=Math.floor(abscoordinate),coordinateminutes=(abscoordinate-coordinatedegrees)/(1/60),tempcoordinateminutes=coordinateminutes;coordinateminutes=Math.floor(coordinateminutes);var coordinateseconds=(tempcoordinateminutes-coordinateminutes)/(1/60);coordinateseconds=Math.round(10*coordinateseconds),coordinateseconds/=10,coordinateseconds>=60&&(coordinateseconds-=60,coordinateminutes+=1,coordinateminutes>=60&&(coordinateminutes-=60,coordinatedegrees+=1)),10>coordinatedegrees&&(coordinatedegrees="0"+coordinatedegrees);var str=coordinatedegrees+"Â°";return dmsOption.indexOf("dm")>=0&&(10>coordinateminutes&&(coordinateminutes="0"+coordinateminutes),str+=coordinateminutes+"'",dmsOption.indexOf("dms")>=0&&(10>coordinateseconds&&(coordinateseconds="0"+coordinateseconds),str+=coordinateseconds+'"')),str+="lon"==axis?0>coordinate?OpenLayers.i18n("W"):OpenLayers.i18n("E"):0>coordinate?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(layer,lonlat,data){this.layer=layer,this.lonlat=lonlat,this.data=null!=data?data:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var onScreen=!1;if(null!=this.layer&&null!=this.layer.map){var screenBounds=this.layer.map.getExtent();onScreen=screenBounds.containsLonLat(this.lonlat)}return onScreen},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(closeBox){if(null!=this.lonlat){if(!this.popup){var anchor=this.marker?this.marker.icon:null,popupClass=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new popupClass(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,anchor,closeBox)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(geometry,attributes,style){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,attributes]),this.lonlat=null,this.geometry=geometry?geometry:null,this.state=null,this.attributes={},attributes&&(this.attributes=OpenLayers.Util.extend(this.attributes,attributes)),this.style=style?style:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(boundsOnly){var onScreen=!1;if(this.layer&&this.layer.map){var screenBounds=this.layer.map.getExtent();if(boundsOnly){var featureBounds=this.geometry.getBounds();onScreen=screenBounds.intersectsBounds(featureBounds)}else{var screenPoly=screenBounds.toGeometry();onScreen=screenPoly.intersects(this.geometry)}}return onScreen},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1;return this.geometry&&(atPoint=this.geometry.atPoint(lonlat,toleranceLon,toleranceLat)),atPoint},destroyPopup:function(){},move:function(location){if(!this.layer||!this.geometry.move)return void 0;var pixel;pixel="OpenLayers.LonLat"==location.CLASS_NAME?this.layer.getViewPortPxFromLonLat(location):location;var lastPixel=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),res=this.layer.map.getResolution();return this.geometry.move(res*(pixel.x-lastPixel.x),res*(lastPixel.y-pixel.y)),this.layer.drawFeature(this),lastPixel},toState:function(state){if(state==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=state;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(state==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=state}else if(state==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=state}else state==OpenLayers.State.UNKNOWN&&(this.state=state)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(style,options){OpenLayers.Util.extend(this,options),this.rules=[],options&&options.rules&&this.addRules(options.rules),this.setDefaultStyle(style||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i=0,len=this.rules.length;len>i;i++)this.rules[i].destroy(),this.rules[i]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(feature){for(var rule,style=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),feature),rules=this.rules,elseRules=[],appliedRules=!1,i=0,len=rules.length;len>i;i++){rule=rules[i];var applies=rule.evaluate(feature);applies&&(rule instanceof OpenLayers.Rule&&rule.elseFilter?elseRules.push(rule):(appliedRules=!0,this.applySymbolizer(rule,style,feature)))}if(0==appliedRules&&elseRules.length>0){appliedRules=!0;for(var i=0,len=elseRules.length;len>i;i++)this.applySymbolizer(elseRules[i],style,feature)}return rules.length>0&&0==appliedRules&&(style.display="none"),null!=style.label&&"string"!=typeof style.label&&(style.label=String(style.label)),style},applySymbolizer:function(rule,style,feature){var symbolizerPrefix=feature.geometry?this.getSymbolizerPrefix(feature.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],symbolizer=rule.symbolizer[symbolizerPrefix]||rule.symbolizer;if(this.defaultsPerSymbolizer===!0){var defaults=this.defaultStyle;OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:defaults.pointRadius}),(symbolizer.stroke===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{strokeWidth:defaults.strokeWidth,strokeColor:defaults.strokeColor,strokeOpacity:defaults.strokeOpacity,strokeDashstyle:defaults.strokeDashstyle,strokeLinecap:defaults.strokeLinecap}),(symbolizer.fill===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{fillColor:defaults.fillColor,fillOpacity:defaults.fillOpacity}),symbolizer.graphic===!0&&OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(style,symbolizer),feature)},createLiterals:function(style,feature){var context=OpenLayers.Util.extend({},feature.attributes||feature.data);OpenLayers.Util.extend(context,this.context);for(var i in this.propertyStyles)style[i]=OpenLayers.Style.createLiteral(style[i],context,feature,i);return style},findPropertyStyles:function(){var propertyStyles={},style=this.defaultStyle;this.addPropertyStyles(propertyStyles,style);for(var symbolizer,value,rules=this.rules,i=0,len=rules.length;len>i;i++){symbolizer=rules[i].symbolizer;for(var key in symbolizer){if(value=symbolizer[key],"object"!=typeof value){this.addPropertyStyles(propertyStyles,symbolizer);break}this.addPropertyStyles(propertyStyles,value)}}return propertyStyles},addPropertyStyles:function(propertyStyles,symbolizer){var property;for(var key in symbolizer)property=symbolizer[key],"string"==typeof property&&property.match(/\$\{\w+\}/)&&(propertyStyles[key]=!0);return propertyStyles},addRules:function(rules){Array.prototype.push.apply(this.rules,rules),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(style){this.defaultStyle=style,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(geometry){for(var prefixes=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,len=prefixes.length;len>i;i++)if(-1!=geometry.CLASS_NAME.indexOf(prefixes[i]))return prefixes[i]},clone:function(){var options=OpenLayers.Util.extend({},this);if(this.rules){options.rules=[];for(var i=0,len=this.rules.length;len>i;++i)options.rules.push(this.rules[i].clone())}options.context=this.context&&OpenLayers.Util.extend({},this.context);var defaultStyle=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(defaultStyle,options)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(value,context,feature,property){return"string"==typeof value&&-1!=value.indexOf("${")&&(value=OpenLayers.String.format(value,context,[feature,property]),value=isNaN(value)||!value?value:parseFloat(value)),value},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function domToCss(prefixedDom){return prefixedDom?prefixedDom.replace(/([A-Z])/g,function(c){return"-"+c.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function css(property){if(void 0===cssCache[property]){var domProperty=property.replace(/(-[\s\S])/g,function(c){return c.charAt(1).toUpperCase()}),prefixedDom=style(domProperty);cssCache[property]=domToCss(prefixedDom)}return cssCache[property]}function js(obj,property){if(void 0===jsCache[property]){var tmpProp,prefix,i=0,l=VENDOR_PREFIXES.length,isStyleObj="undefined"!=typeof obj.cssText;for(jsCache[property]=null;l>i;i++)if(prefix=VENDOR_PREFIXES[i],prefix?(isStyleObj||(prefix=prefix.toLowerCase()),tmpProp=prefix+property.charAt(0).toUpperCase()+property.slice(1)):tmpProp=property,void 0!==obj[tmpProp]){jsCache[property]=tmpProp;break}}return jsCache[property]}function style(property){return js(divStyle,property)}var VENDOR_PREFIXES=["","O","ms","Moz","Webkit"],divStyle=document.createElement("div").style,cssCache={},jsCache={};return{css:css,js:js,style:style,cssCache:cssCache,jsCache:jsCache}}(),OpenLayers.Animation=function(window){function start(callback,duration,element){duration=duration>0?duration:Number.POSITIVE_INFINITY;var id=++counter,start=+new Date;return loops[id]=function(){loops[id]&&+new Date-start<=duration?(callback(),loops[id]&&requestFrame(loops[id],element)):delete loops[id]},requestFrame(loops[id],element),id}function stop(id){delete loops[id]}var requestAnimationFrame=OpenLayers.Util.vendorPrefix.js(window,"requestAnimationFrame"),isNative=!!requestAnimationFrame,requestFrame=function(){var request=window[requestAnimationFrame]||function(callback){window.setTimeout(callback,16)};return function(callback,element){request.apply(window,[callback,element])}}(),counter=0,loops={};return{isNative:isNative,requestFrame:requestFrame,start:start,stop:stop}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(easing){this.easing=easing?easing:OpenLayers.Easing.Expo.easeOut},start:function(begin,finish,duration,options){this.playing=!0,this.begin=begin,this.finish=finish,this.duration=duration,this.callbacks=options.callbacks,this.minFrameRate=options.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var value={};for(var i in this.begin){var b=this.begin[i],f=this.finish[i];if(null==b||null==f||isNaN(b)||isNaN(f))throw new TypeError("invalid value for Tween");var c=f-b;value[i]=this.easing.apply(this,[this.time,b,c,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,value),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(t,b,c,d){return c*t/d+b},easeOut:function(t,b,c,d){return c*t/d+b},easeInOut:function(t,b,c,d){return c*t/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(t,b,c,d){return 0==t?b:c*Math.pow(2,10*(t/d-1))+b},easeOut:function(t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOut:function(t,b,c,d){return 0==t?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(-Math.pow(2,-10*--t)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(t,b,c,d){return c*(t/=d)*t+b},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOut:function(t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(bounds){bounds&&(this.bounds=bounds.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(newBounds){var bounds=this.getBounds();bounds?this.bounds.extend(newBounds):this.setBounds(newBounds)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1,bounds=this.getBounds();if(null!=bounds&&null!=lonlat){var dX=null!=toleranceLon?toleranceLon:0,dY=null!=toleranceLat?toleranceLat:0,toleranceBounds=new OpenLayers.Bounds(this.bounds.left-dX,this.bounds.bottom-dY,this.bounds.right+dX,this.bounds.top+dY);atPoint=toleranceBounds.containsLonLat(lonlat)}return atPoint},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var string;return string=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(wkt){var geom;if(OpenLayers.Format&&OpenLayers.Format.WKT){var format=OpenLayers.Geometry.fromWKT.format;format||(format=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=format);var result=format.read(wkt);if(result instanceof OpenLayers.Feature.Vector)geom=result.geometry;else if(OpenLayers.Util.isArray(result)){for(var len=result.length,components=new Array(len),i=0;len>i;++i)components[i]=result[i].geometry;geom=new OpenLayers.Geometry.Collection(components)}}return geom},OpenLayers.Geometry.segmentsIntersect=function(seg1,seg2,options){var point=options&&options.point,tolerance=options&&options.tolerance,intersection=!1,x11_21=seg1.x1-seg2.x1,y11_21=seg1.y1-seg2.y1,x12_11=seg1.x2-seg1.x1,y12_11=seg1.y2-seg1.y1,y22_21=seg2.y2-seg2.y1,x22_21=seg2.x2-seg2.x1,d=y22_21*x12_11-x22_21*y12_11,n1=x22_21*y11_21-y22_21*x11_21,n2=x12_11*y11_21-y12_11*x11_21;if(0==d)0==n1&&0==n2&&(intersection=!0);else{var along1=n1/d,along2=n2/d;if(along1>=0&&1>=along1&&along2>=0&&1>=along2)if(point){var x=seg1.x1+along1*x12_11,y=seg1.y1+along1*y12_11;intersection=new OpenLayers.Geometry.Point(x,y)}else intersection=!0}if(tolerance){var dist;if(intersection){if(point){var seg,x,y,segs=[seg1,seg2];outer:for(var i=0;2>i;++i){seg=segs[i];for(var j=1;3>j;++j)if(x=seg["x"+j],y=seg["y"+j],dist=Math.sqrt(Math.pow(x-intersection.x,2)+Math.pow(y-intersection.y,2)),tolerance>dist){intersection.x=x,intersection.y=y;break outer}}}}else{var source,target,x,y,p,result,segs=[seg1,seg2];outer:for(var i=0;2>i;++i){source=segs[i],target=segs[(i+1)%2];for(var j=1;3>j;++j)if(p={x:source["x"+j],y:source["y"+j]},result=OpenLayers.Geometry.distanceToSegment(p,target),result.distance<tolerance){intersection=point?new OpenLayers.Geometry.Point(p.x,p.y):!0;break outer}}}}return intersection},OpenLayers.Geometry.distanceToSegment=function(point,segment){var result=OpenLayers.Geometry.distanceSquaredToSegment(point,segment);return result.distance=Math.sqrt(result.distance),result},OpenLayers.Geometry.distanceSquaredToSegment=function(point,segment){var x,y,x0=point.x,y0=point.y,x1=segment.x1,y1=segment.y1,x2=segment.x2,y2=segment.y2,dx=x2-x1,dy=y2-y1,along=(dx*(x0-x1)+dy*(y0-y1))/(Math.pow(dx,2)+Math.pow(dy,2));return 0>=along?(x=x1,y=y1):along>=1?(x=x2,y=y2):(x=x1+along*dx,y=y1+along*dy),{distance:Math.pow(x-x0,2)+Math.pow(y-y0,2),x:x,y:y,along:along}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(components){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=components&&this.addComponents(components)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var strings=[],i=0,len=this.components.length;len>i;i++)strings.push(this.components[i].toShortString());return strings.join(",")},calculateBounds:function(){this.bounds=null;var bounds=new OpenLayers.Bounds,components=this.components;if(components)for(var i=0,len=components.length;len>i;i++)bounds.extend(components[i].getBounds());null!=bounds.left&&null!=bounds.bottom&&null!=bounds.right&&null!=bounds.top&&this.setBounds(bounds)},addComponents:function(components){OpenLayers.Util.isArray(components)||(components=[components]);for(var i=0,len=components.length;len>i;i++)this.addComponent(components[i])},addComponent:function(component,index){var added=!1;if(component&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,component.CLASS_NAME)>-1)){if(null!=index&&index<this.components.length){var components1=this.components.slice(0,index),components2=this.components.slice(index,this.components.length);components1.push(component),this.components=components1.concat(components2)}else this.components.push(component);component.parent=this,this.clearBounds(),added=!0}return added},removeComponents:function(components){var removed=!1;OpenLayers.Util.isArray(components)||(components=[components]);for(var i=components.length-1;i>=0;--i)removed=this.removeComponent(components[i])||removed;return removed},removeComponent:function(component){return OpenLayers.Util.removeItem(this.components,component),this.clearBounds(),!0},getLength:function(){for(var length=0,i=0,len=this.components.length;len>i;i++)length+=this.components[i].getLength();return length},getArea:function(){for(var area=0,i=0,len=this.components.length;len>i;i++)area+=this.components[i].getArea();return area},getGeodesicArea:function(projection){for(var area=0,i=0,len=this.components.length;len>i;i++)area+=this.components[i].getGeodesicArea(projection);return area},getCentroid:function(weighted){if(!weighted)return this.components.length&&this.components[0].getCentroid();var len=this.components.length;if(!len)return!1;for(var component,areas=[],centroids=[],areaSum=0,minArea=Number.MAX_VALUE,i=0;len>i;++i){component=this.components[i];var area=component.getArea(),centroid=component.getCentroid(!0);isNaN(area)||isNaN(centroid.x)||isNaN(centroid.y)||(areas.push(area),areaSum+=area,minArea=minArea>area&&area>0?area:minArea,centroids.push(centroid))}if(len=areas.length,0===areaSum){for(var i=0;len>i;++i)areas[i]=1;areaSum=areas.length}else{for(var i=0;len>i;++i)areas[i]/=minArea;areaSum/=minArea}for(var centroid,area,xSum=0,ySum=0,i=0;len>i;++i)centroid=centroids[i],area=areas[i],xSum+=centroid.x*area,ySum+=centroid.y*area;return new OpenLayers.Geometry.Point(xSum/areaSum,ySum/areaSum)},getGeodesicLength:function(projection){for(var length=0,i=0,len=this.components.length;len>i;i++)length+=this.components[i].getGeodesicLength(projection);return length},move:function(x,y){for(var i=0,len=this.components.length;len>i;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;len>i;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0;i<this.components.length;++i)this.components[i].resize(scale,origin,ratio);return this},distanceTo:function(geometry,options){for(var result,best,distance,edge=!(options&&options.edge===!1),details=edge&&options&&options.details,min=Number.POSITIVE_INFINITY,i=0,len=this.components.length;len>i&&(result=this.components[i].distanceTo(geometry,options),distance=details?result.distance:result,!(min>distance&&(min=distance,best=result,0==min)));++i);return best},equals:function(geometry){var equivalent=!0;if(geometry&&geometry.CLASS_NAME&&this.CLASS_NAME==geometry.CLASS_NAME)if(OpenLayers.Util.isArray(geometry.components)&&geometry.components.length==this.components.length){for(var i=0,len=this.components.length;len>i;++i)if(!this.components[i].equals(geometry.components[i])){equivalent=!1;break}}else equivalent=!1;else equivalent=!1;return equivalent},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;len>i;i++){var component=this.components[i];component.transform(source,dest)}this.bounds=null}return this},intersects:function(geometry){for(var intersect=!1,i=0,len=this.components.length;len>i&&!(intersect=geometry.intersects(this.components[i]));++i);return intersect},getVertices:function(nodes){for(var vertices=[],i=0,len=this.components.length;len>i;++i)Array.prototype.push.apply(vertices,this.components[i].getVertices(nodes));
return vertices},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(x,y){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(x),this.y=parseFloat(y)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(obj,this),obj},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(geometry,options){var distance,x0,y0,x1,y1,result,edge=!(options&&options.edge===!1),details=edge&&options&&options.details;return geometry instanceof OpenLayers.Geometry.Point?(x0=this.x,y0=this.y,x1=geometry.x,y1=geometry.y,distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2)),result=details?{x0:x0,y0:y0,x1:x1,y1:y1,distance:distance}:distance):(result=geometry.distanceTo(this,options),details&&(result={x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0,distance:result.distance})),result},equals:function(geom){var equals=!1;return null!=geom&&(equals=this.x==geom.x&&this.y==geom.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(geom.x)&&isNaN(geom.y)),equals},toShortString:function(){return this.x+", "+this.y},move:function(x,y){this.x=this.x+x,this.y=this.y+y,this.clearBounds()},rotate:function(angle,origin){angle*=Math.PI/180;var radius=this.distanceTo(origin),theta=angle+Math.atan2(this.y-origin.y,this.x-origin.x);this.x=origin.x+radius*Math.cos(theta),this.y=origin.y+radius*Math.sin(theta),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(scale,origin,ratio){return ratio=void 0==ratio?1:ratio,this.x=origin.x+scale*ratio*(this.x-origin.x),this.y=origin.y+scale*(this.y-origin.y),this.clearBounds(),this},intersects:function(geometry){var intersect=!1;return intersect="OpenLayers.Geometry.Point"==geometry.CLASS_NAME?this.equals(geometry):geometry.intersects(this)},transform:function(source,dest){return source&&dest&&(OpenLayers.Projection.transform(this,source,dest),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(point,index){this.addComponent(point,index)},removePoint:function(point){this.removeComponent(point)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var length=0;if(this.components&&this.components.length>1)for(var i=1,len=this.components.length;len>i;i++)length+=this.components[i-1].distanceTo(this.components[i]);return length},getGeodesicLength:function(projection){var geom=this;if(projection){var gg=new OpenLayers.Projection("EPSG:4326");gg.equals(projection)||(geom=this.clone().transform(projection,gg))}var length=0;if(geom.components&&geom.components.length>1)for(var p1,p2,i=1,len=geom.components.length;len>i;i++)p1=geom.components[i-1],p2=geom.components[i],length+=OpenLayers.Util.distVincenty({lon:p1.x,lat:p1.y},{lon:p2.x,lat:p2.y});return 1e3*length},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var removed=this.components&&this.components.length>2;return removed&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),removed},intersects:function(geometry){var intersect=!1,type=geometry.CLASS_NAME;if("OpenLayers.Geometry.LineString"==type||"OpenLayers.Geometry.LinearRing"==type||"OpenLayers.Geometry.Point"==type){var segs2,segs1=this.getSortedSegments();segs2="OpenLayers.Geometry.Point"==type?[{x1:geometry.x,y1:geometry.y,x2:geometry.x,y2:geometry.y}]:geometry.getSortedSegments();var seg1,seg1x1,seg1x2,seg1y1,seg1y2,seg2,seg2y1,seg2y2;outer:for(var i=0,len=segs1.length;len>i;++i){seg1=segs1[i],seg1x1=seg1.x1,seg1x2=seg1.x2,seg1y1=seg1.y1,seg1y2=seg1.y2;for(var j=0,jlen=segs2.length;jlen>j&&(seg2=segs2[j],!(seg2.x1>seg1x2));++j)if(!(seg2.x2<seg1x1||(seg2y1=seg2.y1,seg2y2=seg2.y2,Math.min(seg2y1,seg2y2)>Math.max(seg1y1,seg1y2)||Math.max(seg2y1,seg2y2)<Math.min(seg1y1,seg1y2)||!OpenLayers.Geometry.segmentsIntersect(seg1,seg2)))){intersect=!0;break outer}}}else intersect=geometry.intersects(this);return intersect},getSortedSegments:function(){function byX1(seg1,seg2){return seg1.x1-seg2.x1}for(var point1,point2,numSeg=this.components.length-1,segments=new Array(numSeg),i=0;numSeg>i;++i)point1=this.components[i],point2=this.components[i+1],segments[i]=point1.x<point2.x?{x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}:{x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y};return segments.sort(byX1)},splitWithSegment:function(seg,options){for(var vert1,vert2,point,vertex,target,edge=!(options&&options.edge===!1),tolerance=options&&options.tolerance,lines=[],verts=this.getVertices(),points=[],intersections=[],split=!1,interOptions={point:!0,tolerance:tolerance},result=null,i=0,stop=verts.length-2;stop>=i;++i)if(vert1=verts[i],points.push(vert1.clone()),vert2=verts[i+1],target={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},point=OpenLayers.Geometry.segmentsIntersect(seg,target,interOptions),point instanceof OpenLayers.Geometry.Point&&(vertex=point.x===seg.x1&&point.y===seg.y1||point.x===seg.x2&&point.y===seg.y2||point.equals(vert1)||point.equals(vert2)?!0:!1,vertex||edge)){if(point.equals(intersections[intersections.length-1])||intersections.push(point.clone()),0===i&&point.equals(vert1))continue;if(point.equals(vert2))continue;split=!0,point.equals(vert1)||points.push(point),lines.push(new OpenLayers.Geometry.LineString(points)),points=[point.clone()]}if(split&&(points.push(vert2.clone()),lines.push(new OpenLayers.Geometry.LineString(points))),intersections.length>0){var xDir=seg.x1<seg.x2?1:-1,yDir=seg.y1<seg.y2?1:-1;result={lines:lines,points:intersections.sort(function(p1,p2){return xDir*p1.x-xDir*p2.x||yDir*p1.y-yDir*p2.y})}}return result},split:function(target,options){var sourceSplit,targetSplit,sourceParts,targetParts,results=null,mutual=options&&options.mutual;if(target instanceof OpenLayers.Geometry.LineString){var vert1,vert2,seg,splits,lines,point,verts=this.getVertices(),points=[];sourceParts=[];for(var i=0,stop=verts.length-2;stop>=i;++i){vert1=verts[i],vert2=verts[i+1],seg={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},targetParts=targetParts||[target],mutual&&points.push(vert1.clone());for(var j=0;j<targetParts.length;++j)if(splits=targetParts[j].splitWithSegment(seg,options),splits&&(lines=splits.lines,lines.length>0&&(lines.unshift(j,1),Array.prototype.splice.apply(targetParts,lines),j+=lines.length-2),mutual))for(var k=0,len=splits.points.length;len>k;++k)point=splits.points[k],point.equals(vert1)||(points.push(point),sourceParts.push(new OpenLayers.Geometry.LineString(points)),points=point.equals(vert2)?[]:[point.clone()])}mutual&&sourceParts.length>0&&points.length>0&&(points.push(vert2.clone()),sourceParts.push(new OpenLayers.Geometry.LineString(points)))}else results=target.splitWith(this,options);return targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],(targetSplit||sourceSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){return geometry.split(this,options)},getVertices:function(nodes){var vertices;return vertices=nodes===!0?[this.components[0],this.components[this.components.length-1]]:nodes===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(geometry,options){var result,edge=!(options&&options.edge===!1),details=edge&&options&&options.details,best={},min=Number.POSITIVE_INFINITY;if(geometry instanceof OpenLayers.Geometry.Point){for(var seg,segs=this.getSortedSegments(),x=geometry.x,y=geometry.y,i=0,len=segs.length;len>i;++i)if(seg=segs[i],result=OpenLayers.Geometry.distanceToSegment(geometry,seg),result.distance<min){if(min=result.distance,best=result,0===min)break}else if(seg.x2>x&&(y>seg.y1&&y<seg.y2||y<seg.y1&&y>seg.y2))break;best=details?{distance:best.distance,x0:best.x,y0:best.y,x1:x,y1:y}:best.distance}else if(geometry instanceof OpenLayers.Geometry.LineString){var seg0,seg1,intersection,x0,y0,segs0=this.getSortedSegments(),segs1=geometry.getSortedSegments(),len1=segs1.length,interOptions={point:!0};outer:for(var i=0,len=segs0.length;len>i;++i){seg0=segs0[i],x0=seg0.x1,y0=seg0.y1;for(var j=0;len1>j;++j){if(seg1=segs1[j],intersection=OpenLayers.Geometry.segmentsIntersect(seg0,seg1,interOptions)){min=0,best={distance:0,x0:intersection.x,y0:intersection.y,x1:intersection.x,y1:intersection.y};break outer}result=OpenLayers.Geometry.distanceToSegment({x:x0,y:y0},seg1),result.distance<min&&(min=result.distance,best={distance:min,x0:x0,y0:y0,x1:result.x,y1:result.y})}}if(details||(best=best.distance),0!==min&&seg0){result=geometry.distanceTo(new OpenLayers.Geometry.Point(seg0.x2,seg0.y2),options);var dist=details?result.distance:result;min>dist&&(best=details?{distance:min,x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0}:dist)}}else best=geometry.distanceTo(this,options),details&&(best={distance:best.distance,x0:best.x1,y0:best.y1,x1:best.x0,y1:best.y0});return best},simplify:function(tolerance){if(this&&null!==this){var points=this.getVertices();if(points.length<3)return this;var compareNumbers=function(a,b){return a-b},douglasPeuckerReduction=function(points,firstPoint,lastPoint,tolerance){for(var distance,maxDistance=0,indexFarthest=0,index=firstPoint;lastPoint>index;index++)distance=perpendicularDistance(points[firstPoint],points[lastPoint],points[index]),distance>maxDistance&&(maxDistance=distance,indexFarthest=index);maxDistance>tolerance&&indexFarthest!=firstPoint&&(pointIndexsToKeep.push(indexFarthest),douglasPeuckerReduction(points,firstPoint,indexFarthest,tolerance),douglasPeuckerReduction(points,indexFarthest,lastPoint,tolerance))},perpendicularDistance=function(point1,point2,point){var area=Math.abs(.5*(point1.x*point2.y+point2.x*point.y+point.x*point1.y-point2.x*point1.y-point.x*point2.y-point1.x*point.y)),bottom=Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2)),height=2*(area/bottom);return height},firstPoint=0,lastPoint=points.length-1,pointIndexsToKeep=[];for(pointIndexsToKeep.push(firstPoint),pointIndexsToKeep.push(lastPoint);points[firstPoint].equals(points[lastPoint]);)lastPoint--,pointIndexsToKeep.push(lastPoint);douglasPeuckerReduction(points,firstPoint,lastPoint,tolerance);var returnPoints=[];pointIndexsToKeep.sort(compareNumbers);for(var index=0;index<pointIndexsToKeep.length;index++)returnPoints.push(points[pointIndexsToKeep[index]]);return new OpenLayers.Geometry.LineString(returnPoints)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(point,index){var added=!1,lastPoint=this.components.pop();null==index&&point.equals(lastPoint)||(added=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var firstPoint=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint]),added},removeComponent:function(){var removed=this.components&&this.components.length>3;if(removed){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var firstPoint=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint])}return removed},move:function(x,y){for(var i=0,len=this.components.length;len-1>i;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;len-1>i;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0,len=this.components.length;len-1>i;++i)this.components[i].resize(scale,origin,ratio);return this},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;len-1>i;i++){var component=this.components[i];component.transform(source,dest)}this.bounds=null}return this},getCentroid:function(){if(this.components){var len=this.components.length;if(len>0&&2>=len)return this.components[0].clone();if(len>2){var sumX=0,sumY=0,x0=this.components[0].x,y0=this.components[0].y,area=-1*this.getArea();if(0!=area){for(var i=0;len-1>i;i++){var b=this.components[i],c=this.components[i+1];sumX+=(b.x+c.x-2*x0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0)),sumY+=(b.y+c.y-2*y0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0))}var x=x0+sumX/(6*area),y=y0+sumY/(6*area)}else{for(var i=0;len-1>i;i++)sumX+=this.components[i].x,sumY+=this.components[i].y;var x=sumX/(len-1),y=sumY/(len-1)}return new OpenLayers.Geometry.Point(x,y)}return null}},getArea:function(){var area=0;if(this.components&&this.components.length>2){for(var sum=0,i=0,len=this.components.length;len-1>i;i++){var b=this.components[i],c=this.components[i+1];sum+=(b.x+c.x)*(c.y-b.y)}area=-sum/2}return area},getGeodesicArea:function(projection){var ring=this;if(projection){var gg=new OpenLayers.Projection("EPSG:4326");gg.equals(projection)||(ring=this.clone().transform(projection,gg))}var area=0,len=ring.components&&ring.components.length;if(len>2){for(var p1,p2,i=0;len-1>i;i++)p1=ring.components[i],p2=ring.components[i+1],area+=OpenLayers.Util.rad(p2.x-p1.x)*(2+Math.sin(OpenLayers.Util.rad(p1.y))+Math.sin(OpenLayers.Util.rad(p2.y)));area=6378137*6378137*area/2}return area},containsPoint:function(point){function getX(y,x1,y1,x2,y2){return(y-y2)*((x2-x1)/(y2-y1))+x2}for(var start,end,x1,y1,x2,y2,cx,approx=OpenLayers.Number.limitSigDigs,digs=14,px=approx(point.x,digs),py=approx(point.y,digs),numSeg=this.components.length-1,crosses=0,i=0;numSeg>i;++i)if(start=this.components[i],x1=approx(start.x,digs),y1=approx(start.y,digs),end=this.components[i+1],x2=approx(end.x,digs),y2=approx(end.y,digs),y1!=y2){if(cx=approx(getX(py,x1,y1,x2,y2),digs),cx==px&&(y2>y1&&py>=y1&&y2>=py||y1>y2&&y1>=py&&py>=y2)){crosses=-1;break}px>=cx||x1!=x2&&(cx<Math.min(x1,x2)||cx>Math.max(x1,x2))||(y2>y1&&py>=y1&&y2>py||y1>y2&&y1>py&&py>=y2)&&++crosses}else if(py==y1&&(x2>=x1&&px>=x1&&x2>=px||x1>=x2&&x1>=px&&px>=x2)){crosses=-1;break}var contained=-1==crosses?1:!!(1&crosses);return contained},intersects:function(geometry){var intersect=!1;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)intersect=this.containsPoint(geometry);else if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME)intersect=geometry.intersects(this);else if("OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME)intersect=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[geometry]);else for(var i=0,len=geometry.components.length;len>i&&!(intersect=geometry.components[i].intersects(this));++i);return intersect},getVertices:function(nodes){return nodes===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var area=0;if(this.components&&this.components.length>0){area+=Math.abs(this.components[0].getArea());for(var i=1,len=this.components.length;len>i;i++)area-=Math.abs(this.components[i].getArea())}return area},getGeodesicArea:function(projection){var area=0;if(this.components&&this.components.length>0){area+=Math.abs(this.components[0].getGeodesicArea(projection));for(var i=1,len=this.components.length;len>i;i++)area-=Math.abs(this.components[i].getGeodesicArea(projection))}return area},containsPoint:function(point){var numRings=this.components.length,contained=!1;if(numRings>0&&(contained=this.components[0].containsPoint(point),1!==contained&&contained&&numRings>1))for(var hole,i=1;numRings>i;++i)if(hole=this.components[i].containsPoint(point)){contained=1===hole?1:!1;break}return contained},intersects:function(geometry){var i,len,intersect=!1;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)intersect=this.containsPoint(geometry);else if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME){for(i=0,len=this.components.length;len>i&&!(intersect=geometry.intersects(this.components[i]));++i);if(!intersect)for(i=0,len=geometry.components.length;len>i&&!(intersect=this.containsPoint(geometry.components[i]));++i);}else for(i=0,len=geometry.components.length;len>i&&!(intersect=this.intersects(geometry.components[i]));++i);if(!intersect&&"OpenLayers.Geometry.Polygon"==geometry.CLASS_NAME){var ring=this.components[0];for(i=0,len=ring.components.length;len>i&&!(intersect=geometry.containsPoint(ring.components[i]));++i);}return intersect},distanceTo:function(geometry,options){var result,edge=!(options&&options.edge===!1);return result=!edge&&this.intersects(geometry)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[geometry,options])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(origin,radius,sides,rotation){var angle=Math.PI*(1/sides-.5);rotation&&(angle+=rotation/180*Math.PI);for(var rotatedAngle,x,y,points=[],i=0;sides>i;++i)rotatedAngle=angle+2*i*Math.PI/sides,x=origin.x+radius*Math.cos(rotatedAngle),y=origin.y+radius*Math.sin(rotatedAngle),points.push(new OpenLayers.Geometry.Point(x,y));var ring=new OpenLayers.Geometry.LinearRing(points);return new OpenLayers.Geometry.Polygon([ring])},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(event){return event.target||event.srcElement},isSingleTouch:function(event){return event.touches&&1==event.touches.length},isMultiTouch:function(event){return event.touches&&event.touches.length>1},isLeftClick:function(event){return event.which&&1==event.which||event.button&&1==event.button},isRightClick:function(event){return event.which&&3==event.which||event.button&&2==event.button},stop:function(event,allowDefault){allowDefault||OpenLayers.Event.preventDefault(event),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0},preventDefault:function(event){event.preventDefault?event.preventDefault():event.returnValue=!1},findElement:function(event,tagName){for(var element=OpenLayers.Event.element(event);element.parentNode&&(!element.tagName||element.tagName.toUpperCase()!=tagName.toUpperCase());)element=element.parentNode;return element},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);if(useCapture=useCapture||!1,"keypress"==name&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)&&(name="keydown"),this.observers||(this.observers={}),!element._eventCacheID){var idPrefix="eventCacheID_";element.id&&(idPrefix=element.id+"_"+idPrefix),element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix)}var cacheID=element._eventCacheID;this.observers[cacheID]||(this.observers[cacheID]=[]),this.observers[cacheID].push({element:element,name:name,observer:observer,useCapture:useCapture}),element.addEventListener?element.addEventListener(name,observer,useCapture):element.attachEvent&&element.attachEvent("on"+name,observer)},stopObservingElement:function(elementParam){var element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[cacheID])},_removeElementObservers:function(elementObservers){if(elementObservers)for(var i=elementObservers.length-1;i>=0;i--){var entry=elementObservers[i];OpenLayers.Event.stopObserving.apply(this,[entry.element,entry.name,entry.observer,entry.useCapture])}},stopObserving:function(elementParam,name,observer,useCapture){useCapture=useCapture||!1;var element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID;"keypress"==name&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.detachEvent)&&(name="keydown");var foundEntry=!1,elementObservers=OpenLayers.Event.observers[cacheID];if(elementObservers)for(var i=0;!foundEntry&&i<elementObservers.length;){var cacheEntry=elementObservers[i];if(cacheEntry.name==name&&cacheEntry.observer==observer&&cacheEntry.useCapture==useCapture){elementObservers.splice(i,1),0==elementObservers.length&&delete OpenLayers.Event.observers[cacheID],foundEntry=!0;break}i++}return foundEntry&&(element.removeEventListener?element.removeEventListener(name,observer,useCapture):element&&element.detachEvent&&element.detachEvent("on"+name,observer)),foundEntry},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var cacheID in OpenLayers.Event.observers){var elementObservers=OpenLayers.Event.observers[cacheID];OpenLayers.Event._removeElementObservers.apply(this,[elementObservers])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(object,element,eventTypes,fallThrough,options){OpenLayers.Util.extend(this,options),this.object=object,this.fallThrough=fallThrough,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=element&&this.attachToElement(element)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(){},attachToElement:function(element){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=element;for(var type,msTouch=!!window.navigator.msMaxTouchPoints,i=0,len=this.BROWSER_EVENTS.length;len>i;i++)type=this.BROWSER_EVENTS[i],OpenLayers.Event.observe(element,type,this.eventHandler),msTouch&&0===type.indexOf("touch")&&this.addMsTouchListener(element,type,this.eventHandler);OpenLayers.Event.observe(element,"dragstart",OpenLayers.Event.stop)},on:function(object){for(var type in object)"scope"!=type&&object.hasOwnProperty(type)&&this.register(type,object.scope,object[type])},register:function(type,obj,func,priority){if(type in OpenLayers.Events&&!this.extensions[type]&&(this.extensions[type]=new OpenLayers.Events[type](this)),null!=func){null==obj&&(obj=this.object);var listeners=this.listeners[type];listeners||(listeners=[],this.listeners[type]=listeners,this.extensionCount[type]=0);var listener={obj:obj,func:func};priority?(listeners.splice(this.extensionCount[type],0,listener),"object"==typeof priority&&priority.extension&&this.extensionCount[type]++):listeners.push(listener)}},registerPriority:function(type,obj,func){this.register(type,obj,func,!0)},un:function(object){for(var type in object)"scope"!=type&&object.hasOwnProperty(type)&&this.unregister(type,object.scope,object[type])},unregister:function(type,obj,func){null==obj&&(obj=this.object);var listeners=this.listeners[type];if(null!=listeners)for(var i=0,len=listeners.length;len>i;i++)if(listeners[i].obj==obj&&listeners[i].func==func){listeners.splice(i,1);break}},remove:function(type){null!=this.listeners[type]&&(this.listeners[type]=[])},triggerEvent:function(type,evt){var listeners=this.listeners[type];if(!listeners||0==listeners.length)return void 0;null==evt&&(evt={}),evt.object=this.object,evt.element=this.element,evt.type||(evt.type=type),listeners=listeners.slice();for(var continueChain,i=0,len=listeners.length;len>i;i++){var callback=listeners[i];if(continueChain=callback.func.apply(callback.obj,[evt]),void 0!=continueChain&&0==continueChain)break}return this.fallThrough||OpenLayers.Event.stop(evt,!0),continueChain},handleBrowserEvent:function(evt){var type=evt.type,listeners=this.listeners[type];if(listeners&&0!=listeners.length){var touches=evt.touches;if(touches&&touches[0]){for(var touch,x=0,y=0,num=touches.length,i=0;num>i;++i)touch=this.getTouchClientXY(touches[i]),x+=touch.clientX,y+=touch.clientY;evt.clientX=x/num,evt.clientY=y/num}this.includeXY&&(evt.xy=this.getMousePosition(evt)),this.triggerEvent(type,evt)}},getTouchClientXY:function(evt){var win=window.olMockWin||window,winPageX=win.pageXOffset,winPageY=win.pageYOffset,x=evt.clientX,y=evt.clientY;return 0===evt.pageY&&Math.floor(y)>Math.floor(evt.pageY)||0===evt.pageX&&Math.floor(x)>Math.floor(evt.pageX)?(x-=winPageX,y-=winPageY):(y<evt.pageY-winPageY||x<evt.pageX-winPageX)&&(x=evt.pageX-winPageX,y=evt.pageY-winPageY),evt.olClientX=x,evt.olClientY=y,{clientX:x,clientY:y}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(evt){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var viewportElement=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||viewportElement.scrollLeft,window.pageYOffset||viewportElement.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(evt.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],evt.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(element,type,handler){function msHandler(evt){handler(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var i=touches.length-1;i>=0;--i)touches[i].stopPropagation()},preventDefault:function(){for(var i=touches.length-1;i>=0;--i)touches[i].preventDefault()},type:type},evt))}this.eventHandler;var touches=this._msTouches;switch(type){case"touchstart":return this.addMsTouchListenerStart(element,type,msHandler);case"touchend":return this.addMsTouchListenerEnd(element,type,msHandler);case"touchmove":return this.addMsTouchListenerMove(element,type,msHandler);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(element,type,handler){var touches=this._msTouches,cb=function(e){for(var alreadyInArray=!1,i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){alreadyInArray=!0;break}alreadyInArray||touches.push(e),e.touches=touches.slice(),handler(e)};OpenLayers.Event.observe(element,"MSPointerDown",cb);var internalCb=function(e){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches.splice(i,1);break}};OpenLayers.Event.observe(element,"MSPointerUp",internalCb)},addMsTouchListenerMove:function(element,type,handler){var touches=this._msTouches,cb=function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==touches.length&&touches[0].pageX==e.pageX&&touches[0].pageY==e.pageY)){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches[i]=e;break}e.touches=touches.slice(),handler(e)}};OpenLayers.Event.observe(element,"MSPointerMove",cb)},addMsTouchListenerEnd:function(element,type,handler){var touches=this._msTouches,cb=function(e){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches.splice(i,1);break}e.touches=touches.slice(),handler(e)};OpenLayers.Event.observe(element,"MSPointerUp",cb)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(target){this.target=target;for(var i=this.events.length-1;i>=0;--i)this.target.register(this.events[i],this,this.buttonClick,{extension:!0})},destroy:function(){for(var i=this.events.length-1;i>=0;--i)this.target.unregister(this.events[i],this,this.buttonClick);delete this.target},getPressedButton:function(element){var button,depth=3;do{if(OpenLayers.Element.hasClass(element,"olButton")){button=element;break}element=element.parentNode}while(--depth>0&&element);return button},ignore:function(element){var depth=3,ignore=!1;do{if("a"===element.nodeName.toLowerCase()){ignore=!0;break}element=element.parentNode}while(--depth>0&&element);return ignore},buttonClick:function(evt){var propagate=!0,element=OpenLayers.Event.element(evt);if(element&&(OpenLayers.Event.isLeftClick(evt)||!~evt.type.indexOf("mouse"))){var button=this.getPressedButton(element);if(button){if("keydown"===evt.type)switch(evt.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:button}),OpenLayers.Event.stop(evt),propagate=!1}else if(this.startEvt){if(this.completeRegEx.test(evt.type)){var pos=OpenLayers.Util.pagePosition(button),viewportElement=OpenLayers.Util.getViewportElement(),scrollTop=window.pageYOffset||viewportElement.scrollTop,scrollLeft=window.pageXOffset||viewportElement.scrollLeft;pos[0]=pos[0]-scrollLeft,pos[1]=pos[1]-scrollTop,this.target.triggerEvent("buttonclick",{buttonElement:button,buttonXY:{x:this.startEvt.clientX-pos[0],y:this.startEvt.clientY-pos[1]}})}this.cancelRegEx.test(evt.type)&&delete this.startEvt,OpenLayers.Event.stop(evt),propagate=!1}this.startRegEx.test(evt.type)&&(this.startEvt=evt,OpenLayers.Event.stop(evt),propagate=!1)}else propagate=!this.ignore(OpenLayers.Event.element(evt)),delete this.startEvt}return propagate}}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(target){if(this.target=target,target.object instanceof OpenLayers.Map)this.setMap(target.object);else{if(!(target.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector "+"or OpenLayers.Map instances";target.object.map?this.setMap(target.object.map):target.object.events.register("added",this,function(){this.setMap(target.object.map)})}for(var i=this.provides.length-1;i>=0;--i)target.extensions[this.provides[i]]=!0},setMap:function(map){this.map=map,this.cache={},map.events.register("mousedown",this,this.start,{extension:!0}),map.events.register("mouseup",this,this.onClick,{extension:!0}),map.events.register("touchstart",this,this.start,{extension:!0}),map.events.register("touchmove",this,this.cancel,{extension:!0}),map.events.register("touchend",this,this.onClick,{extension:!0}),map.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(evt){this.startEvt=evt},cancel:function(){delete this.startEvt},onClick:function(evt){if(this.startEvt&&("touchend"===evt.type||OpenLayers.Event.isLeftClick(evt))){var features=this.getFeatures(this.startEvt);delete this.startEvt;for(var feature,layer,more,clicked={},i=0,len=features.length;len>i&&(feature=features[i],layer=feature.layer,clicked[layer.id]=!0,more=this.triggerEvent("featureclick",{feature:feature}),more!==!1);++i);for(i=0,len=this.map.layers.length;len>i;++i)layer=this.map.layers[i],layer instanceof OpenLayers.Layer.Vector&&!clicked[layer.id]&&this.triggerEvent("nofeatureclick",{layer:layer})}},onMousemove:function(evt){delete this.startEvt;
for(var feature,features=this.getFeatures(evt),over={},newly=[],i=0,len=features.length;len>i;++i)feature=features[i],over[feature.id]=feature,this.cache[feature.id]||newly.push(feature);var out=[];for(var id in this.cache)feature=this.cache[id],feature.layer&&feature.layer.map?over[feature.id]||out.push(feature):delete this.cache[id];var more;for(i=0,len=newly.length;len>i&&(feature=newly[i],this.cache[feature.id]=feature,more=this.triggerEvent("featureover",{feature:feature}),more!==!1);++i);for(i=0,len=out.length;len>i&&(feature=out[i],delete this.cache[feature.id],more=this.triggerEvent("featureout",{feature:feature}),more!==!1);++i);},triggerEvent:function(type,evt){var layer=evt.feature?evt.feature.layer:evt.layer,object=this.target.object;return object instanceof OpenLayers.Map||object===layer?this.target.triggerEvent(type,evt):void 0},getFeatures:function(evt){var layer,target,feature,i,len,x=evt.clientX,y=evt.clientY,features=[],targets=[],layers=[];for(i=this.map.layers.length-1;i>=0;--i)if(layer=this.map.layers[i],"none"!==layer.div.style.display)if(layer.renderer instanceof OpenLayers.Renderer.Elements){if(layer instanceof OpenLayers.Layer.Vector)for(target=document.elementFromPoint(x,y);target&&target._featureId;)feature=layer.getFeatureById(target._featureId),feature?(features.push(feature),target.style.display="none",targets.push(target),target=document.elementFromPoint(x,y)):target=!1;layers.push(layer),layer.div.style.display="none"}else layer.renderer instanceof OpenLayers.Renderer.Canvas&&(feature=layer.renderer.getFeatureIdFromEvent(evt),feature&&(features.push(feature),layers.push(layer)));for(i=0,len=targets.length;len>i;++i)targets[i].style.display="";for(i=layers.length-1;i>=0;--i)layers[i].div.style.display="block";return features},destroy:function(){for(var i=this.provides.length-1;i>=0;--i)delete this.target.extensions[this.provides[i]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(projCode,options){OpenLayers.Util.extend(this,options),this.projCode=projCode,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(projCode))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(projection){var p=projection,equals=!1;if(p)if(p instanceof OpenLayers.Projection||(p=new OpenLayers.Projection(p)),"object"==typeof Proj4js&&this.proj.defData&&p.proj.defData)equals=this.proj.defData.replace(this.titleRegEx,"")==p.proj.defData.replace(this.titleRegEx,"");else if(p.getCode){var source=this.getCode(),target=p.getCode();equals=source==target||!!OpenLayers.Projection.transforms[source]&&OpenLayers.Projection.transforms[source][target]===OpenLayers.Projection.nullTransform}return equals},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(from,to,method){if(method===OpenLayers.Projection.nullTransform){var defaults=OpenLayers.Projection.defaults[from];defaults&&!OpenLayers.Projection.defaults[to]&&(OpenLayers.Projection.defaults[to]=defaults)}OpenLayers.Projection.transforms[from]||(OpenLayers.Projection.transforms[from]={}),OpenLayers.Projection.transforms[from][to]=method},OpenLayers.Projection.transform=function(point,source,dest){if(source&&dest)if(source instanceof OpenLayers.Projection||(source=new OpenLayers.Projection(source)),dest instanceof OpenLayers.Projection||(dest=new OpenLayers.Projection(dest)),source.proj&&dest.proj)point=Proj4js.transform(source.proj,dest.proj,point);else{var sourceCode=source.getCode(),destCode=dest.getCode(),transforms=OpenLayers.Projection.transforms;transforms[sourceCode]&&transforms[sourceCode][destCode]&&transforms[sourceCode][destCode](point)}return point},OpenLayers.Projection.nullTransform=function(point){return point},function(){function inverseMercator(xy){return xy.x=180*xy.x/pole,xy.y=180/Math.PI*(2*Math.atan(Math.exp(xy.y/pole*Math.PI))-Math.PI/2),xy}function forwardMercator(xy){xy.x=xy.x*pole/180;var y=Math.log(Math.tan((90+xy.y)*Math.PI/360))/Math.PI*pole;return xy.y=Math.max(-20037508.34,Math.min(y,20037508.34)),xy}function map(base,codes){var i,len,code,other,j,add=OpenLayers.Projection.addTransform,same=OpenLayers.Projection.nullTransform;for(i=0,len=codes.length;len>i;++i)for(code=codes[i],add(base,code,forwardMercator),add(code,base,inverseMercator),j=i+1;len>j;++j)other=codes[j],add(code,other,same),add(other,code,same)}var i,pole=20037508.34,mercator=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],geographic=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(i=mercator.length-1;i>=0;--i)map(mercator[i],geographic);for(i=geographic.length-1;i>=0;--i)map(geographic[i],mercator)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(div,options){1===arguments.length&&"object"==typeof div&&(options=div,div=options&&options.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},options),OpenLayers.Util.extend(this,options);var projCode=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[projCode]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(div),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var id=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(id,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),id=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(id),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var addNode=!0,nodes=document.getElementsByTagName("link"),i=0,len=nodes.length;len>i;++i)if(OpenLayers.Util.isEquivalentUrl(nodes.item(i).href,this.theme)){addNode=!1;break}if(addNode){var cssNode=document.createElement("link");cssNode.setAttribute("rel","stylesheet"),cssNode.setAttribute("type","text/css"),cssNode.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(cssNode)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var i=0,len=this.controls.length;len>i;i++)this.addControlToMap(this.controls[i]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),options&&options.layers&&(delete this.center,delete this.zoom,this.addLayers(options.layers),options.center&&!this.getCenter()&&this.setCenter(options.center,options.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(div){this.div=OpenLayers.Util.getElement(div),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var i=this.controls.length-1;i>=0;--i)this.controls[i].destroy();this.controls=null}if(null!=this.layers){for(var i=this.layers.length-1;i>=0;--i)this.layers[i].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(options){var updatePxExtent=this.minPx&&options.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,options),updatePxExtent&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(array,property,match){var test="function"==typeof match.test,found=OpenLayers.Array.filter(this[array],function(item){return item[property]==match||test&&match.test(item[property])});return found},getLayersBy:function(property,match){return this.getBy("layers",property,match)},getLayersByName:function(match){return this.getLayersBy("name",match)},getLayersByClass:function(match){return this.getLayersBy("CLASS_NAME",match)},getControlsBy:function(property,match){return this.getBy("controls",property,match)},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)},getLayer:function(id){for(var foundLayer=null,i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];if(layer.id==id){foundLayer=layer;break}}return foundLayer},setLayerZIndex:function(layer,zIdx){layer.setZIndex(this.Z_INDEX_BASE[layer.isBaseLayer?"BaseLayer":"Overlay"]+5*zIdx)},resetLayersZIndex:function(){for(var i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];this.setLayerZIndex(layer,i)}},addLayer:function(layer){for(var i=0,len=this.layers.length;len>i;i++)if(this.layers[i]==layer)return!1;return this.events.triggerEvent("preaddlayer",{layer:layer})===!1?!1:(this.allOverlays&&(layer.isBaseLayer=!1),layer.div.className="olLayerDiv",layer.div.style.overflow="",this.setLayerZIndex(layer,this.layers.length),layer.isFixed?this.viewPortDiv.appendChild(layer.div):this.layerContainerDiv.appendChild(layer.div),this.layers.push(layer),layer.setMap(this),layer.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(layer):layer.setVisibility(!1):layer.redraw(),this.events.triggerEvent("addlayer",{layer:layer}),layer.events.triggerEvent("added",{map:this,layer:layer}),layer.afterAdd(),!0)},addLayers:function(layers){for(var i=0,len=layers.length;len>i;i++)this.addLayer(layers[i])},removeLayer:function(layer,setNewBaseLayer){if(this.events.triggerEvent("preremovelayer",{layer:layer})!==!1){if(null==setNewBaseLayer&&(setNewBaseLayer=!0),layer.isFixed?this.viewPortDiv.removeChild(layer.div):this.layerContainerDiv.removeChild(layer.div),OpenLayers.Util.removeItem(this.layers,layer),layer.removeMap(this),layer.map=null,this.baseLayer==layer&&(this.baseLayer=null,setNewBaseLayer))for(var i=0,len=this.layers.length;len>i;i++){var iLayer=this.layers[i];if(iLayer.isBaseLayer||this.allOverlays){this.setBaseLayer(iLayer);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:layer}),layer.events.triggerEvent("removed",{map:this,layer:layer})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(layer){return OpenLayers.Util.indexOf(this.layers,layer)},setLayerIndex:function(layer,idx){var base=this.getLayerIndex(layer);if(0>idx?idx=0:idx>this.layers.length&&(idx=this.layers.length),base!=idx){this.layers.splice(base,1),this.layers.splice(idx,0,layer);for(var i=0,len=this.layers.length;len>i;i++)this.setLayerZIndex(this.layers[i],i);this.events.triggerEvent("changelayer",{layer:layer,property:"order"}),this.allOverlays&&(0===idx?this.setBaseLayer(layer):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(layer,delta){var idx=this.getLayerIndex(layer)+delta;this.setLayerIndex(layer,idx)},setBaseLayer:function(newBaseLayer){if(newBaseLayer!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,newBaseLayer)){var center=this.getCachedCenter(),newResolution=OpenLayers.Util.getResolutionFromScale(this.getScale(),newBaseLayer.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=newBaseLayer,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=center){var newZoom=this.getZoomForResolution(newResolution||this.resolution,!0);this.setCenter(center,newZoom,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(control,px){this.controls.push(control),this.addControlToMap(control,px)},addControls:function(controls,pixels){for(var pxs=1===arguments.length?[]:pixels,i=0,len=controls.length;len>i;i++){var ctrl=controls[i],px=pxs[i]?pxs[i]:null;this.addControl(ctrl,px)}},addControlToMap:function(control,px){control.outsideViewport=null!=control.div,this.displayProjection&&!control.displayProjection&&(control.displayProjection=this.displayProjection),control.setMap(this);var div=control.draw(px);div&&(control.outsideViewport||(div.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(div))),control.autoActivate&&control.activate()},getControl:function(id){for(var returnControl=null,i=0,len=this.controls.length;len>i;i++){var control=this.controls[i];if(control.id==id){returnControl=control;break}}return returnControl},removeControl:function(control){control&&control==this.getControl(control.id)&&(control.div&&control.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(control.div),OpenLayers.Util.removeItem(this.controls,control))},addPopup:function(popup,exclusive){if(exclusive)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);popup.map=this,this.popups.push(popup);var popupDiv=popup.draw();popupDiv&&(popupDiv.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(popupDiv))},removePopup:function(popup){if(OpenLayers.Util.removeItem(this.popups,popup),popup.div)try{this.layerContainerDiv.removeChild(popup.div)}catch(e){}popup.map=null},getSize:function(){var size=null;return null!=this.size&&(size=this.size.clone()),size},updateSize:function(){var newSize=this.getCurrentSize();if(newSize&&!isNaN(newSize.h)&&!isNaN(newSize.w)){this.events.clearMouseCache();var oldSize=this.getSize();if(null==oldSize&&(this.size=oldSize=newSize),!newSize.equals(oldSize)){this.size=newSize;for(var i=0,len=this.layers.length;len>i;i++)this.layers[i].onMapResize();var center=this.getCachedCenter();if(null!=this.baseLayer&&null!=center){var zoom=this.getZoom();this.zoom=null,this.setCenter(center,zoom)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var size=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==size.w&&0==size.h||isNaN(size.w)&&isNaN(size.h))&&(size.w=this.div.offsetWidth,size.h=this.div.offsetHeight),(0==size.w&&0==size.h||isNaN(size.w)&&isNaN(size.h))&&(size.w=parseInt(this.div.style.width),size.h=parseInt(this.div.style.height)),size},calculateBounds:function(center,resolution){var extent=null;if(null==center&&(center=this.getCachedCenter()),null==resolution&&(resolution=this.getResolution()),null!=center&&null!=resolution){var halfWDeg=this.size.w*resolution/2,halfHDeg=this.size.h*resolution/2;extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg)}return extent},getCenter:function(){var center=null,cachedCenter=this.getCachedCenter();return cachedCenter&&(center=cachedCenter.clone()),center},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(dx,dy,options){if(options=OpenLayers.Util.applyDefaults(options,{animate:!0,dragging:!1}),options.dragging)(0!=dx||0!=dy)&&this.moveByPx(dx,dy);else{var centerPx=this.getViewPortPxFromLonLat(this.getCachedCenter()),newCenterPx=centerPx.add(dx,dy);if(this.dragging||!newCenterPx.equals(centerPx)){var newCenterLonLat=this.getLonLatFromViewPortPx(newCenterPx);options.animate?this.panTo(newCenterLonLat):(this.moveTo(newCenterLonLat),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(lonlat){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(lonlat)){var center=this.getCachedCenter();if(lonlat.equals(center))return;var from=this.getPixelFromLonLat(center),to=this.getPixelFromLonLat(lonlat),vector={x:to.x-from.x,y:to.y-from.y},last={x:0,y:0};this.panTween.start({x:0,y:0},vector,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(px){var x=px.x-last.x,y=px.y-last.y;this.moveByPx(x,y),last.x=Math.round(px.x),last.y=Math.round(px.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(lonlat),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(lonlat)},setCenter:function(lonlat,zoom,dragging,forceZoomChange){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(lonlat,zoom,{dragging:dragging,forceZoomChange:forceZoomChange})},moveByPx:function(dx,dy){var hw=this.size.w/2,hh=this.size.h/2,x=hw+dx,y=hh+dy,wrapDateLine=this.baseLayer.wrapDateLine,xRestriction=0,yRestriction=0;if(this.restrictedExtent&&(xRestriction=hw,yRestriction=hh,wrapDateLine=!1),dx=wrapDateLine||x<=this.maxPx.x-xRestriction&&x>=this.minPx.x+xRestriction?Math.round(dx):0,dy=y<=this.maxPx.y-yRestriction&&y>=this.minPx.y+yRestriction?Math.round(dy):0,dx||dy){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,dx&&(this.layerContainerOriginPx.x-=dx,this.minPx.x-=dx,this.maxPx.x-=dx),dy&&(this.layerContainerOriginPx.y-=dy,this.minPx.y-=dy,this.maxPx.y-=dy),this.applyTransform();var layer,i,len;for(i=0,len=this.layers.length;len>i;++i)layer=this.layers[i],layer.visibility&&(layer===this.baseLayer||layer.inRange)&&(layer.moveByPx(dx,dy),layer.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(zoom){if(this.baseLayer&&this.baseLayer.wrapDateLine){var resolutions=this.baseLayer.resolutions,maxResolution=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(zoom)>maxResolution)if(this.fractionalZoom)zoom=this.getZoomForResolution(maxResolution);else for(var i=0|zoom,ii=resolutions.length;ii>i;++i)if(resolutions[i]<=maxResolution){zoom=i;break}}return zoom},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(lonlat,zoom,options){null==lonlat||lonlat instanceof OpenLayers.LonLat||(lonlat=new OpenLayers.LonLat(lonlat)),options||(options={}),null!=zoom&&(zoom=parseFloat(zoom),this.fractionalZoom||(zoom=Math.round(zoom)));var requestedZoom=zoom;zoom=this.adjustZoom(zoom),zoom!==requestedZoom&&(lonlat=this.getCenter());var dragging=options.dragging||this.dragging,forceZoomChange=options.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(lonlat)||(lonlat=this.maxExtent.getCenterLonLat(),this.center=lonlat.clone()),null!=this.restrictedExtent){null==lonlat&&(lonlat=this.center),null==zoom&&(zoom=this.getZoom());var resolution=this.getResolutionForZoom(zoom),extent=this.calculateBounds(lonlat,resolution);if(!this.restrictedExtent.containsBounds(extent)){var maxCenter=this.restrictedExtent.getCenterLonLat();extent.getWidth()>this.restrictedExtent.getWidth()?lonlat=new OpenLayers.LonLat(maxCenter.lon,lonlat.lat):extent.left<this.restrictedExtent.left?lonlat=lonlat.add(this.restrictedExtent.left-extent.left,0):extent.right>this.restrictedExtent.right&&(lonlat=lonlat.add(this.restrictedExtent.right-extent.right,0)),extent.getHeight()>this.restrictedExtent.getHeight()?lonlat=new OpenLayers.LonLat(lonlat.lon,maxCenter.lat):extent.bottom<this.restrictedExtent.bottom?lonlat=lonlat.add(0,this.restrictedExtent.bottom-extent.bottom):extent.top>this.restrictedExtent.top&&(lonlat=lonlat.add(0,this.restrictedExtent.top-extent.top))}}var zoomChanged=forceZoomChange||this.isValidZoomLevel(zoom)&&zoom!=this.getZoom(),centerChanged=this.isValidLonLat(lonlat)&&!lonlat.equals(this.center);if(zoomChanged||centerChanged||dragging){dragging||this.events.triggerEvent("movestart",{zoomChanged:zoomChanged}),centerChanged&&(!zoomChanged&&this.center&&this.centerLayerContainer(lonlat),this.center=lonlat.clone());var res=zoomChanged?this.getResolutionForZoom(zoom):this.getResolution();if(zoomChanged||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var maxExtent=this.getMaxExtent({restricted:!0}),maxExtentCenter=maxExtent.getCenterLonLat(),lonDelta=this.center.lon-maxExtentCenter.lon,latDelta=maxExtentCenter.lat-this.center.lat,extentWidth=Math.round(maxExtent.getWidth()/res),extentHeight=Math.round(maxExtent.getHeight()/res);this.minPx={x:(this.size.w-extentWidth)/2-lonDelta/res,y:(this.size.h-extentHeight)/2-latDelta/res},this.maxPx={x:this.minPx.x+Math.round(maxExtent.getWidth()/res),y:this.minPx.y+Math.round(maxExtent.getHeight()/res)}}zoomChanged&&(this.zoom=zoom,this.resolution=res);var bounds=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})),bounds=this.baseLayer.getExtent();for(var i=this.layers.length-1;i>=0;--i){var layer=this.layers[i];if(layer!==this.baseLayer&&!layer.isBaseLayer){var inRange=layer.calculateInRange();layer.inRange!=inRange&&(layer.inRange=inRange,inRange||layer.display(!1),this.events.triggerEvent("changelayer",{layer:layer,property:"visibility"})),inRange&&layer.visibility&&(layer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||layer.events.triggerEvent("moveend",{zoomChanged:zoomChanged}))}}if(this.events.triggerEvent("move"),dragging||this.events.triggerEvent("moveend"),zoomChanged){for(var i=0,len=this.popups.length;len>i;i++)this.popups[i].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(lonlat){var originPx=this.getViewPortPxFromLonLat(this.layerContainerOrigin),newPx=this.getViewPortPxFromLonLat(lonlat);if(null!=originPx&&null!=newPx){var oldLeft=this.layerContainerOriginPx.x,oldTop=this.layerContainerOriginPx.y,newLeft=Math.round(originPx.x-newPx.x),newTop=Math.round(originPx.y-newPx.y);this.applyTransform(this.layerContainerOriginPx.x=newLeft,this.layerContainerOriginPx.y=newTop);var dx=oldLeft-newLeft,dy=oldTop-newTop;this.minPx.x-=dx,this.maxPx.x-=dx,this.minPx.y-=dy,this.maxPx.y-=dy}},isValidZoomLevel:function(zoomLevel){return null!=zoomLevel&&zoomLevel>=0&&zoomLevel<this.getNumZoomLevels()},isValidLonLat:function(lonlat){var valid=!1;if(null!=lonlat){var maxExtent=this.getMaxExtent(),worldBounds=this.baseLayer.wrapDateLine&&maxExtent;valid=maxExtent.containsLonLat(lonlat,{worldBounds:worldBounds})}return valid},getProjection:function(){var projection=this.getProjectionObject();return projection?projection.getCode():null},getProjectionObject:function(){var projection=null;return null!=this.baseLayer&&(projection=this.baseLayer.projection),projection},getMaxResolution:function(){var maxResolution=null;return null!=this.baseLayer&&(maxResolution=this.baseLayer.maxResolution),maxResolution},getMaxExtent:function(options){var maxExtent=null;return options&&options.restricted&&this.restrictedExtent?maxExtent=this.restrictedExtent:null!=this.baseLayer&&(maxExtent=this.baseLayer.maxExtent),maxExtent},getNumZoomLevels:function(){var numZoomLevels=null;return null!=this.baseLayer&&(numZoomLevels=this.baseLayer.numZoomLevels),numZoomLevels},getExtent:function(){var extent=null;return null!=this.baseLayer&&(extent=this.baseLayer.getExtent()),extent},getResolution:function(){var resolution=null;return null!=this.baseLayer?resolution=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(resolution=this.layers[0].getResolution()),resolution},getUnits:function(){var units=null;return null!=this.baseLayer&&(units=this.baseLayer.units),units},getScale:function(){var scale=null;if(null!=this.baseLayer){var res=this.getResolution(),units=this.baseLayer.units;scale=OpenLayers.Util.getScaleFromResolution(res,units)}return scale},getZoomForExtent:function(bounds,closest){var zoom=null;return null!=this.baseLayer&&(zoom=this.baseLayer.getZoomForExtent(bounds,closest)),zoom},getResolutionForZoom:function(zoom){var resolution=null;return this.baseLayer&&(resolution=this.baseLayer.getResolutionForZoom(zoom)),resolution},getZoomForResolution:function(resolution,closest){var zoom=null;return null!=this.baseLayer&&(zoom=this.baseLayer.getZoomForResolution(resolution,closest)),zoom},zoomTo:function(zoom,xy){var map=this;if(map.isValidZoomLevel(zoom))if(map.baseLayer.wrapDateLine&&(zoom=map.adjustZoom(zoom)),map.zoomTween){var currentRes=map.getResolution(),targetRes=map.getResolutionForZoom(zoom),start={scale:1},end={scale:currentRes/targetRes};if(map.zoomTween.playing&&map.zoomTween.duration<3*map.zoomDuration)map.zoomTween.finish={scale:map.zoomTween.finish.scale*end.scale};else{if(!xy){var size=map.getSize();xy={x:size.w/2,y:size.h/2}}map.zoomTween.start(start,end,map.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(data){var containerOrigin=map.layerContainerOriginPx,scale=data.scale,dx=0|(scale-1)*(containerOrigin.x-xy.x),dy=0|(scale-1)*(containerOrigin.y-xy.y);map.applyTransform(containerOrigin.x+dx,containerOrigin.y+dy,scale)},done:function(data){map.applyTransform();var resolution=map.getResolution()/data.scale,zoom=map.getZoomForResolution(resolution,!0);map.moveTo(map.getZoomTargetCenter(xy,resolution),zoom,!0)}}})}}else{var center=xy?map.getZoomTargetCenter(xy,map.getResolutionForZoom(zoom)):null;map.setCenter(center,zoom)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(bounds,closest){bounds instanceof OpenLayers.Bounds||(bounds=new OpenLayers.Bounds(bounds));var center=bounds.getCenterLonLat();if(this.baseLayer.wrapDateLine){var maxExtent=this.getMaxExtent();for(bounds=bounds.clone();bounds.right<bounds.left;)bounds.right+=maxExtent.getWidth();center=bounds.getCenterLonLat().wrapDateLine(maxExtent)}this.setCenter(center,this.getZoomForExtent(bounds,closest))},zoomToMaxExtent:function(options){var restricted=options?options.restricted:!0,maxExtent=this.getMaxExtent({restricted:restricted});this.zoomToExtent(maxExtent)},zoomToScale:function(scale,closest){var res=OpenLayers.Util.getResolutionFromScale(scale,this.baseLayer.units),halfWDeg=this.size.w*res/2,halfHDeg=this.size.h*res/2,center=this.getCachedCenter(),extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg);this.zoomToExtent(extent,closest)},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;return null!=this.baseLayer&&(lonlat=this.baseLayer.getLonLatFromViewPortPx(viewPortPx)),lonlat},getViewPortPxFromLonLat:function(lonlat){var px=null;return null!=this.baseLayer&&(px=this.baseLayer.getViewPortPxFromLonLat(lonlat)),px},getZoomTargetCenter:function(xy,resolution){var lonlat=null,size=this.getSize(),deltaX=size.w/2-xy.x,deltaY=xy.y-size.h/2,zoomPoint=this.getLonLatFromPixel(xy);return zoomPoint&&(lonlat=new OpenLayers.LonLat(zoomPoint.lon+deltaX*resolution,zoomPoint.lat+deltaY*resolution)),lonlat},getLonLatFromPixel:function(px){return this.getLonLatFromViewPortPx(px)},getPixelFromLonLat:function(lonlat){var px=this.getViewPortPxFromLonLat(lonlat);return px.x=Math.round(px.x),px.y=Math.round(px.y),px},getGeodesicPixelSize:function(px){var lonlat=px?this.getLonLatFromPixel(px):this.getCachedCenter()||new OpenLayers.LonLat(0,0),res=this.getResolution(),left=lonlat.add(-res/2,0),right=lonlat.add(res/2,0),bottom=lonlat.add(0,-res/2),top=lonlat.add(0,res/2),dest=new OpenLayers.Projection("EPSG:4326"),source=this.getProjectionObject()||dest;return source.equals(dest)||(left.transform(source,dest),right.transform(source,dest),bottom.transform(source,dest),top.transform(source,dest)),new OpenLayers.Size(OpenLayers.Util.distVincenty(left,right),OpenLayers.Util.distVincenty(bottom,top))},getViewPortPxFromLayerPx:function(layerPx){var viewPortPx=null;if(null!=layerPx){var dX=this.layerContainerOriginPx.x,dY=this.layerContainerOriginPx.y;viewPortPx=layerPx.add(dX,dY)}return viewPortPx},getLayerPxFromViewPortPx:function(viewPortPx){var layerPx=null;if(null!=viewPortPx){var dX=-this.layerContainerOriginPx.x,dY=-this.layerContainerOriginPx.y;layerPx=viewPortPx.add(dX,dY),(isNaN(layerPx.x)||isNaN(layerPx.y))&&(layerPx=null)}return layerPx
},getLonLatFromLayerPx:function(px){return px=this.getViewPortPxFromLayerPx(px),this.getLonLatFromViewPortPx(px)},getLayerPxFromLonLat:function(lonlat){var px=this.getPixelFromLonLat(lonlat);return this.getLayerPxFromViewPortPx(px)},applyTransform:function(x,y,scale){scale=scale||1;var origin=this.layerContainerOriginPx,needTransform=1!==scale;x=x||origin.x,y=y||origin.y;var style=this.layerContainerDiv.style,transform=this.applyTransform.transform,template=this.applyTransform.template;if(void 0===transform&&(transform=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=transform,transform)){var computedStyle=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));computedStyle&&"none"===computedStyle||(template=["translate3d(",",0) ","scale3d(",",1)"],style[transform]=[template[0],"0,0",template[1]].join("")),template&&~style[transform].indexOf(template[0])||(template=["translate(",") ","scale(",")"]),this.applyTransform.template=template}null===transform||"translate3d("!==template[0]&&needTransform!==!0?(style.left=x+"px",style.top=y+"px",null!==transform&&(style[transform]="")):(needTransform===!0&&"translate("===template[0]&&(x-=origin.x,y-=origin.y,style.left=origin.x+"px",style.top=origin.y+"px"),style[transform]=[template[0],x,"px,",y,"px",template[1],template[2],scale,",",scale,template[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(options){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var key in this.handlers)this.handlers.hasOwnProperty(key)&&"function"==typeof this.handlers[key].destroy&&this.handlers[key].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(map){this.map=map,this.handler&&this.handler.setMap(map)},draw:function(px){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=px&&(this.position=px.clone()),this.moveTo(this.position),this.div},moveTo:function(px){null!=px&&null!=this.div&&(this.div.style.left=px.x+"px",this.div.style.top=px.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var attributions=[];if(this.map&&this.map.layers){for(var i=0,len=this.map.layers.length;len>i;i++){var layer=this.map.layers[i];layer.attribution&&layer.getVisibility()&&-1===OpenLayers.Util.indexOf(attributions,layer.attribution)&&attributions.push(layer.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:attributions.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(options){OpenLayers.Util.extend(this,options),this.options=options},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(k,v){if(v&&"object"==typeof v)for(var i in v)v.hasOwnProperty(i)&&(v[i]=walk(i,v[i]));return filter(k,v)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(value,pretty){this.pretty=!!pretty;var json=null,type=typeof value;if(this.serialize[type])try{json=!this.pretty&&this.nativeJSON?JSON.stringify(value):this.serialize[type].apply(this,[value])}catch(err){OpenLayers.Console.error("Trouble serializing: "+err)}return json},writeIndent:function(){var pieces=[];if(this.pretty)for(var i=0;i<this.level;++i)pieces.push(this.indent);return pieces.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(object){if(null==object)return"null";if(object.constructor==Date)return this.serialize.date.apply(this,[object]);if(object.constructor==Array)return this.serialize.array.apply(this,[object]);var pieces=["{"];this.level+=1;var key,keyJSON,valueJSON,addComma=!1;for(key in object)object.hasOwnProperty(key)&&(keyJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[key,this.pretty]),valueJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[object[key],this.pretty]),null!=keyJSON&&null!=valueJSON&&(addComma&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),keyJSON,":",this.writeSpace(),valueJSON),addComma=!0));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"}"),pieces.join("")},array:function(array){var json,pieces=["["];this.level+=1;for(var i=0,len=array.length;len>i;++i)json=OpenLayers.Format.JSON.prototype.write.apply(this,[array[i],this.pretty]),null!=json&&(i>0&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),json));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"]"),pieces.join("")},string:function(string){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(string)?'"'+string.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];return c?c:(c=b.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+string+'"'},number:function(number){return isFinite(number)?String(number):"null"},"boolean":function(bool){return String(bool)},date:function(date){function format(number){return 10>number?"0"+number:number}return'"'+date.getFullYear()+"-"+format(date.getMonth()+1)+"-"+format(date.getDate())+"T"+format(date.getHours())+":"+format(date.getMinutes())+":"+format(date.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(options){OpenLayers.Util.extend(this,options)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(xy){this.points.unshift({xy:xy,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(xy){for(var last,point,now=(new Date).getTime(),i=0,l=this.points.length;l>i&&(point=this.points[i],!(now-point.tick>this.delay));i++)last=point;if(last){var time=(new Date).getTime()-last.tick,dist=Math.sqrt(Math.pow(xy.x-last.xy.x,2)+Math.pow(xy.y-last.xy.y,2)),speed=dist/time;if(!(0==speed||speed<this.threshold)){var theta=Math.asin((xy.y-last.xy.y)/dist);return last.xy.x<=xy.x&&(theta=Math.PI-theta),{speed:speed,theta:theta}}}},move:function(info,callback){var v0=info.speed,fx=Math.cos(info.theta),fy=-Math.sin(info.theta),initialTime=(new Date).getTime(),lastX=0,lastY=0,timerCallback=function(){if(null!=this.timerId){var t=(new Date).getTime()-initialTime,p=-this.deceleration*Math.pow(t,2)/2+v0*t,x=p*fx,y=p*fy,args={};args.end=!1;var v=-this.deceleration*t+v0;0>=v&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,args.end=!0),args.x=x-lastX,args.y=y-lastY,lastX=x,lastY=y,callback(args.x,args.y,args.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(timerCallback,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(options){this.symbolizer={},OpenLayers.Util.extend(this,options),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i in this.symbolizer)this.symbolizer[i]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(feature){var context=this.getContext(feature),applies=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var scale=feature.layer.map.getScale();return this.minScaleDenominator&&(applies=scale>=OpenLayers.Style.createLiteral(this.minScaleDenominator,context)),applies&&this.maxScaleDenominator&&(applies=scale<OpenLayers.Style.createLiteral(this.maxScaleDenominator,context)),applies&&this.filter&&(applies="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(feature):this.filter.evaluate(context)),applies},getContext:function(feature){var context=this.context;return context||(context=feature.attributes||feature.data),"function"==typeof this.context&&(context=this.context(feature)),context},clone:function(){var options=OpenLayers.Util.extend({},this);if(this.symbolizers){var len=this.symbolizers.length;options.symbolizers=new Array(len);for(var i=0;len>i;++i)options.symbolizers[i]=this.symbolizers[i].clone()}else{options.symbolizer={};var value,type;for(var key in this.symbolizer)value=this.symbolizer[key],type=typeof value,"object"===type?options.symbolizer[key]=OpenLayers.Util.extend({},value):"string"===type&&(options.symbolizer[key]=value)}return options.filter=this.filter&&this.filter.clone(),options.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(options)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(control,callbacks,options){OpenLayers.Util.extend(this,options),this.control=control,this.callbacks=callbacks;var map=this.map||control.map;map&&this.setMap(map),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(map){this.map=map},checkModifiers:function(evt){if(null==this.keyMask)return!0;var keyModifiers=(evt.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(evt.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(evt.altKey?OpenLayers.Handler.MOD_ALT:0)|(evt.metaKey?OpenLayers.Handler.MOD_META:0);return keyModifiers==this.keyMask},activate:function(){if(this.active)return!1;for(var events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;len>i;i++)this[events[i]]&&this.register(events[i],this[events[i]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;len>i;i++)this[events[i]]&&this.unregister(events[i],this[events[i]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var events=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],i=0,len=events.length;len>i;i++)this[events[i]]&&this.unregister(events[i],this[events[i]])}},callback:function(name,args){name&&this.callbacks[name]&&this.callbacks[name].apply(this.control,args)},register:function(name,method){this.map.events.registerPriority(name,this,method),this.map.events.registerPriority(name,this,this.setEvent)},unregister:function(name,method){this.map.events.unregister(name,this,method),this.map.events.unregister(name,this,this.setEvent)},setEvent:function(evt){return this.evt=evt,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(evt){return this.startTouch(),this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},touchmove:function(evt){return this.last=this.getEventInfo(evt),!0},touchend:function(evt){return this.down&&(evt.xy=this.last.xy,evt.lastTouches=this.last.touches,this.handleSingle(evt),this.down=null),!0},mousedown:function(evt){return this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},mouseup:function(evt){var propagate=!0;return this.checkModifiers(evt)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(evt)&&(propagate=this.rightclick(evt)),propagate},rightclick:function(evt){if(this.passesTolerance(evt)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[evt]),!this.stopDouble;var clickEvent=this["double"]?OpenLayers.Util.extend({},evt):this.callback("rightclick",[evt]),delayedRightCall=OpenLayers.Function.bind(this.delayedRightCall,this,clickEvent);this.rightclickTimerId=window.setTimeout(delayedRightCall,this.delay)}return!this.stopSingle},delayedRightCall:function(evt){this.rightclickTimerId=null,evt&&this.callback("rightclick",[evt])},click:function(evt){return this.last||(this.last=this.getEventInfo(evt)),this.handleSingle(evt),!this.stopSingle},dblclick:function(evt){return this.handleDouble(evt),!this.stopDouble},handleDouble:function(evt){this.passesDblclickTolerance(evt)&&(this["double"]&&this.callback("dblclick",[evt]),this.clearTimer())},handleSingle:function(evt){if(this.passesTolerance(evt))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(evt),this.handleDouble(evt)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(evt);var clickEvent=this.single?OpenLayers.Util.extend({},evt):null;this.queuePotentialClick(clickEvent)}},queuePotentialClick:function(evt){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)},passesTolerance:function(evt){var passes=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(passes=this.pixelTolerance>=this.down.xy.distanceTo(evt.xy),passes&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,ii=this.down.touches.length;ii>i;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){passes=!1;break}return passes},getTouchDistance:function(from,to){return Math.sqrt(Math.pow(from.clientX-to.clientX,2)+Math.pow(from.clientY-to.clientY,2))},passesDblclickTolerance:function(){var passes=!0;return this.down&&this.first&&(passes=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),passes},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(evt){this.timerId=null,evt&&this.callback("click",[evt])},getEventInfo:function(evt){var touches;if(evt.touches){var len=evt.touches.length;touches=new Array(len);for(var touch,i=0;len>i;i++)touch=evt.touches[i],touches[i]={clientX:touch.olClientX,clientY:touch.olClientY}}return{xy:evt.xy,touches:touches}},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,deactivated=!0),deactivated},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(evt){var propagate=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(evt))this.started=!0,this.last=this.start={distance:this.getDistance(evt.touches),delta:0,scale:1},this.callback("start",[evt,this.start]),propagate=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(evt),propagate},touchmove:function(evt){if(this.started&&OpenLayers.Event.isMultiTouch(evt)){this.pinching=!0;var current=this.getPinchData(evt);this.callback("move",[evt,current]),this.last=current,OpenLayers.Event.stop(evt)}else if(this.started)return!1;return!0},touchend:function(evt){return this.started&&!OpenLayers.Event.isMultiTouch(evt)?(this.started=!1,this.pinching=!1,this.callback("done",[evt,this.start,this.last]),this.start=null,this.last=null,!1):!0},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,deactivated=!0),deactivated},getDistance:function(touches){var t0=touches[0],t1=touches[1];return Math.sqrt(Math.pow(t0.olClientX-t1.olClientX,2)+Math.pow(t0.olClientY-t1.olClientY,2))},getPinchData:function(evt){var distance=this.getDistance(evt.touches),scale=distance/this.start.distance;return{distance:distance,delta:this.last.distance-distance,scale:scale}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(control,callbacks,options){options&&options.layerOptions&&options.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var options=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options),this.map.addLayer(this.layer),!0},createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(force){!this.layer||!force&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>1&&this.layer.features[0].destroy()},finalize:function(cancel){var key=cancel?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(key,[this.geometryClone()]),this.destroyFeature(cancel)},cancel:function(){this.finalize(!0)},click:function(evt){return OpenLayers.Event.stop(evt),!1},dblclick:function(evt){return OpenLayers.Event.stop(evt),!1},modifyFeature:function(pixel){this.point||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon,this.point.geometry.y=lonlat.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var geometry=this.point&&this.point.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPoint([geometry])),geometry},geometryClone:function(){var geom=this.getGeometry();return geom&&geom.clone()},mousedown:function(evt){return this.down(evt)},touchstart:function(evt){return this.startTouch(),this.lastTouchPx=evt.xy,this.down(evt)},mousemove:function(evt){return this.move(evt)},touchmove:function(evt){return this.lastTouchPx=evt.xy,this.move(evt)},mouseup:function(evt){return this.up(evt)},touchend:function(evt){return evt.xy=this.lastTouchPx,this.up(evt)},down:function(evt){return this.mouseDown=!0,this.lastDown=evt.xy,this.touch||this.modifyFeature(evt.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(evt){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy),!0},up:function(evt){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(evt)?this.lastUp&&this.lastUp.equals(evt.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(evt.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=evt.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(evt){OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(pixel1,pixel2,tolerance){var passes=!0;if(null!=tolerance&&pixel1&&pixel2){var dist=pixel1.distanceTo(pixel2);dist>tolerance&&(passes=!1)}return passes},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(name,options){this.metadata={},options=OpenLayers.Util.extend({},options),null!=this.alwaysInRange&&(options.alwaysInRange=this.alwaysInRange),this.addOptions(options),this.name=name,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(setNewBaseLayer){null==setNewBaseLayer&&(setNewBaseLayer=!0),null!=this.map&&this.map.removeLayer(this,setNewBaseLayer),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(obj,this),obj.map=null,obj},getOptions:function(){var options={};for(var o in this.options)options[o]=this[o];return options},setName:function(newName){newName!=this.name&&(this.name=newName,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(newOptions,reinitialize){if(null==this.options&&(this.options={}),newOptions&&("string"==typeof newOptions.projection&&(newOptions.projection=new OpenLayers.Projection(newOptions.projection)),newOptions.projection&&OpenLayers.Util.applyDefaults(newOptions,OpenLayers.Projection.defaults[newOptions.projection.getCode()]),!newOptions.maxExtent||newOptions.maxExtent instanceof OpenLayers.Bounds||(newOptions.maxExtent=new OpenLayers.Bounds(newOptions.maxExtent)),!newOptions.minExtent||newOptions.minExtent instanceof OpenLayers.Bounds||(newOptions.minExtent=new OpenLayers.Bounds(newOptions.minExtent))),OpenLayers.Util.extend(this.options,newOptions),OpenLayers.Util.extend(this,newOptions),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var resolution=this.map.getResolution(),properties=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var o in newOptions)if(newOptions.hasOwnProperty(o)&&OpenLayers.Util.indexOf(properties,o)>=0){this.initResolutions(),reinitialize&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(resolution),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var redrawn=!1;if(this.map){this.inRange=this.calculateInRange();var extent=this.getExtent();if(extent&&this.inRange&&this.visibility){var zoomChanged=!0;this.moveTo(extent,zoomChanged,!1),this.events.triggerEvent("moveend",{zoomChanged:zoomChanged}),redrawn=!0}}return redrawn},moveTo:function(){var display=this.visibility;this.isBaseLayer||(display=display&&this.inRange),this.display(display)},moveByPx:function(){},setMap:function(map){if(null==this.map){if(this.map=map,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var show=this.visibility&&this.inRange;this.div.style.display=show?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(size){var tileSize=size?size:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=tileSize,this.gutter&&(this.imageSize=new OpenLayers.Size(tileSize.w+2*this.gutter,tileSize.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(visibility){visibility!=this.visibility&&(this.visibility=visibility,this.display(visibility),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(display){display!=("none"!=this.div.style.display)&&(this.div.style.display=display&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var inRange=!1;if(this.alwaysInRange)inRange=!0;else if(this.map){var resolution=this.map.getResolution();inRange=resolution>=this.minResolution&&resolution<=this.maxResolution}return inRange},setIsBaseLayer:function(isBaseLayer){isBaseLayer!=this.isBaseLayer&&(this.isBaseLayer=isBaseLayer,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var i,len,p,props={},alwaysInRange=!0;for(i=0,len=this.RESOLUTION_PROPERTIES.length;len>i;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=this.options[p],alwaysInRange&&this.options[p]&&(alwaysInRange=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=alwaysInRange),null==props.resolutions&&(props.resolutions=this.resolutionsFromScales(props.scales)),null==props.resolutions&&(props.resolutions=this.calculateResolutions(props)),null==props.resolutions){for(i=0,len=this.RESOLUTION_PROPERTIES.length;len>i;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=null!=this.options[p]?this.options[p]:this.map[p];null==props.resolutions&&(props.resolutions=this.resolutionsFromScales(props.scales)),null==props.resolutions&&(props.resolutions=this.calculateResolutions(props))}var maxResolution;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(maxResolution=this.options.maxResolution),this.options.minScale&&(maxResolution=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var minResolution;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(minResolution=this.options.minResolution),this.options.maxScale&&(minResolution=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),props.resolutions&&(props.resolutions.sort(function(a,b){return b-a}),maxResolution||(maxResolution=props.resolutions[0]),!minResolution)){var lastIdx=props.resolutions.length-1;minResolution=props.resolutions[lastIdx]}if(this.resolutions=props.resolutions,this.resolutions){for(len=this.resolutions.length,this.scales=new Array(len),i=0;len>i;i++)this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units);this.numZoomLevels=len}this.minResolution=minResolution,minResolution&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(minResolution,this.units)),this.maxResolution=maxResolution,maxResolution&&(this.minScale=OpenLayers.Util.getScaleFromResolution(maxResolution,this.units))},resolutionsFromScales:function(scales){if(null!=scales){var resolutions,i,len;for(len=scales.length,resolutions=new Array(len),i=0;len>i;i++)resolutions[i]=OpenLayers.Util.getResolutionFromScale(scales[i],this.units);return resolutions}},calculateResolutions:function(props){var viewSize,wRes,hRes,maxResolution=props.maxResolution;null!=props.minScale?maxResolution=OpenLayers.Util.getResolutionFromScale(props.minScale,this.units):"auto"==maxResolution&&null!=this.maxExtent&&(viewSize=this.map.getSize(),wRes=this.maxExtent.getWidth()/viewSize.w,hRes=this.maxExtent.getHeight()/viewSize.h,maxResolution=Math.max(wRes,hRes));var minResolution=props.minResolution;if(null!=props.maxScale?minResolution=OpenLayers.Util.getResolutionFromScale(props.maxScale,this.units):"auto"==props.minResolution&&null!=this.minExtent&&(viewSize=this.map.getSize(),wRes=this.minExtent.getWidth()/viewSize.w,hRes=this.minExtent.getHeight()/viewSize.h,minResolution=Math.max(wRes,hRes)),"number"!=typeof maxResolution&&"number"!=typeof minResolution&&null!=this.maxExtent){var tileSize=this.map.getTileSize();maxResolution=Math.max(this.maxExtent.getWidth()/tileSize.w,this.maxExtent.getHeight()/tileSize.h)}var maxZoomLevel=props.maxZoomLevel,numZoomLevels=props.numZoomLevels;if("number"==typeof minResolution&&"number"==typeof maxResolution&&void 0===numZoomLevels){var ratio=maxResolution/minResolution;numZoomLevels=Math.floor(Math.log(ratio)/Math.log(2))+1}else void 0===numZoomLevels&&null!=maxZoomLevel&&(numZoomLevels=maxZoomLevel+1);if(!("number"!=typeof numZoomLevels||0>=numZoomLevels||"number"!=typeof maxResolution&&"number"!=typeof minResolution)){var resolutions=new Array(numZoomLevels),base=2;
"number"==typeof minResolution&&"number"==typeof maxResolution&&(base=Math.pow(maxResolution/minResolution,1/(numZoomLevels-1)));var i;if("number"==typeof maxResolution)for(i=0;numZoomLevels>i;i++)resolutions[i]=maxResolution/Math.pow(base,i);else for(i=0;numZoomLevels>i;i++)resolutions[numZoomLevels-1-i]=minResolution*Math.pow(base,i);return resolutions}},getResolution:function(){var zoom=this.map.getZoom();return this.getResolutionForZoom(zoom)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(extent,closest){var viewSize=this.map.getSize(),idealResolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h);return this.getZoomForResolution(idealResolution,closest)},getDataExtent:function(){},getResolutionForZoom:function(zoom){zoom=Math.max(0,Math.min(zoom,this.resolutions.length-1));var resolution;if(this.map.fractionalZoom){var low=Math.floor(zoom),high=Math.ceil(zoom);resolution=this.resolutions[low]-(zoom-low)*(this.resolutions[low]-this.resolutions[high])}else resolution=this.resolutions[Math.round(zoom)];return resolution},getZoomForResolution:function(resolution,closest){var zoom,i,len;if(this.map.fractionalZoom){var res,lowZoom=0,highZoom=this.resolutions.length-1,highRes=this.resolutions[lowZoom],lowRes=this.resolutions[highZoom];for(i=0,len=this.resolutions.length;len>i;++i)if(res=this.resolutions[i],res>=resolution&&(highRes=res,lowZoom=i),resolution>=res){lowRes=res,highZoom=i;break}var dRes=highRes-lowRes;zoom=dRes>0?lowZoom+(highRes-resolution)/dRes:lowZoom}else{var diff,minDiff=Number.POSITIVE_INFINITY;for(i=0,len=this.resolutions.length;len>i;i++)if(closest){if(diff=Math.abs(this.resolutions[i]-resolution),diff>minDiff)break;minDiff=diff}else if(this.resolutions[i]<resolution)break;zoom=Math.max(0,i-1)}return zoom},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null,map=this.map;if(null!=viewPortPx&&map.minPx){var res=map.getResolution(),maxExtent=map.getMaxExtent({restricted:!0}),lon=(viewPortPx.x-map.minPx.x)*res+maxExtent.left,lat=(map.minPx.y-viewPortPx.y)*res+maxExtent.top;lonlat=new OpenLayers.LonLat(lon,lat),this.wrapDateLine&&(lonlat=lonlat.wrapDateLine(this.maxExtent))}return lonlat},getViewPortPxFromLonLat:function(lonlat,resolution){var px=null;if(null!=lonlat){resolution=resolution||this.map.getResolution();var extent=this.map.calculateBounds(null,resolution);px=new OpenLayers.Pixel(1/resolution*(lonlat.lon-extent.left),1/resolution*(extent.top-lonlat.lat))}return px},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;for(var childNodes=this.div.childNodes,i=0,len=childNodes.length;len>i;++i){var element=childNodes[i].firstChild||childNodes[i],lastChild=childNodes[i].lastChild;lastChild&&"iframe"===lastChild.nodeName.toLowerCase()&&(element=lastChild.parentNode),OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(zIndex){this.div.style.zIndex=zIndex},adjustBounds:function(bounds){if(this.gutter){var mapGutter=this.gutter*this.map.getResolution();bounds=new OpenLayers.Bounds(bounds.left-mapGutter,bounds.bottom-mapGutter,bounds.right+mapGutter,bounds.top+mapGutter)}if(this.wrapDateLine){var wrappingOptions={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};bounds=bounds.wrapDateLine(this.maxExtent,wrappingOptions)}return bounds},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(name,url,params,options){OpenLayers.Layer.prototype.initialize.apply(this,[name,options]),this.url=url,this.params||(this.params=OpenLayers.Util.extend({},params))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.prototype.clone.apply(this,[obj])},setUrl:function(newUrl){this.url=newUrl},mergeNewParams:function(newParams){this.params=OpenLayers.Util.extend(this.params,newParams);var ret=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),ret},redraw:function(force){return force?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(paramString,urls){for(var product=1,i=0,len=paramString.length;len>i;i++)product*=paramString.charCodeAt(i)*this.URL_HASH_FACTOR,product-=Math.floor(product);return urls[Math.floor(product*urls.length)]},getFullRequestString:function(newParams,altUrl){var url=altUrl||this.url,allParams=OpenLayers.Util.extend({},this.params);allParams=OpenLayers.Util.extend(allParams,newParams);var paramsString=OpenLayers.Util.getParameterString(allParams);OpenLayers.Util.isArray(url)&&(url=this.selectUrl(paramsString,url));var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(var key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];return paramsString=OpenLayers.Util.getParameterString(allParams),OpenLayers.Util.urlAppend(url,paramsString)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(layer,position,bounds,url,size,options){this.layer=layer,this.position=position.clone(),this.setBounds(bounds),this.url=url,size&&(this.size=size.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(force){force||this.clear();var draw=this.shouldDraw();return draw&&!force&&this.events.triggerEvent("beforedraw")===!1&&(draw=null),draw},shouldDraw:function(){var withinMaxExtent=!1,maxExtent=this.layer.maxExtent;if(maxExtent){var map=this.layer.map,worldBounds=map.baseLayer.wrapDateLine&&map.getMaxExtent();this.bounds.intersectsBounds(maxExtent,{inclusive:!1,worldBounds:worldBounds})&&(withinMaxExtent=!0)}return withinMaxExtent||this.layer.displayOutsideMaxExtent},setBounds:function(bounds){if(bounds=bounds.clone(),this.layer.map.baseLayer.wrapDateLine){var worldExtent=this.layer.map.getMaxExtent(),tolerance=this.layer.map.getResolution();bounds=bounds.wrapDateLine(worldExtent,{leftTolerance:tolerance,rightTolerance:tolerance})}this.bounds=bounds},moveTo:function(bounds,position,redraw){null==redraw&&(redraw=!0),this.setBounds(bounds),this.position=position.clone(),redraw&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(layer,position,bounds,url){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=url,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var shouldDraw=OpenLayers.Tile.prototype.draw.apply(this,arguments);return shouldDraw?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):shouldDraw===!1&&this.unload(),shouldDraw},renderTile:function(){if(this.layer.async){var id=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(url){id==this.asyncRequestId&&(this.url=url,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var style=this.getTile().style,size=this.frame?this.size:this.layer.getImageSize(this.bounds),ratio=1;this.layer instanceof OpenLayers.Layer.Grid&&(ratio=this.layer.getServerResolution()/this.layer.map.getResolution()),style.left=this.position.x+"px",style.top=this.position.y+"px",style.width=Math.round(ratio*size.w)+"px",style.height=Math.round(ratio*size.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var img=this.imgDiv;if(img){var tile=this.getTile();tile.parentNode===this.layer.div&&this.layer.div.removeChild(tile),this.setImgSrc(),this.layerAlphaHack===!0&&(img.style.filter=""),OpenLayers.Element.removeClass(img,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var style=this.imgDiv.style;if(this.frame){var left=0,top=0;this.layer.gutter&&(left=100*(this.layer.gutter/this.layer.tileSize.w),top=100*(this.layer.gutter/this.layer.tileSize.h)),style.left=-left+"%",style.top=-top+"%",style.width=2*left+100+"%",style.height=2*top+100+"%"}style.visibility="hidden",style.opacity=0,this.layer.opacity<1&&(style.filter="alpha(opacity="+100*this.layer.opacity+")"),style.position="absolute",this.layerAlphaHack&&(style.paddingTop=style.height,style.height="0",style.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(img){this.imgDiv=img},initImage:function(){this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var img=this.getImage();this.url&&OpenLayers.Util.isEquivalentUrl(img.src,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&img.removeAttribute("crossorigin"),OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(url){var img=this.imgDiv;url?(img.style.visibility="hidden",img.style.opacity=0,this.crossOriginKeyword&&("data:"!==url.substr(0,5)?img.setAttribute("crossorigin",this.crossOriginKeyword):img.removeAttribute("crossorigin")),img.src=url):(this.stopLoading(),this.imgDiv=null,img.parentNode&&img.parentNode.removeChild(img))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var backBuffer;return this.frame?(backBuffer=this.frame.cloneNode(!1),backBuffer.appendChild(this.imgDiv)):backBuffer=this.imgDiv,this.imgDiv=null,backBuffer}},onImageLoad:function(){var img=this.imgDiv;this.stopLoading(),img.style.visibility="inherit",img.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='scale')")},onImageError:function(){var img=this.imgDiv;null!=img.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(img,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var canvas=document.createElement("canvas");canvas.width=this.size.w,canvas.height=this.size.h,this.canvasContext=canvas.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var img=new Image;return img.className="olTileImage",img.galleryImg="no",img}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(map){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,map),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var iRow=0,len=this.grid.length;len>iRow;iRow++)for(var row=this.grid[iRow],iCol=0,clen=row.length;clen>iCol;iCol++){var tile=row[iCol];this.destroyTile(tile)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(newOptions){var singleTileChanged=void 0!==newOptions.singleTile&&newOptions.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&singleTileChanged&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[obj]),null!=this.tileSize&&(obj.tileSize=this.tileSize.clone()),obj.grid=[],obj.gridResolution=null,obj.backBuffer=null,obj.backBufferTimerId=null,obj.loading=!1,obj.numLoadingTiles=0,obj},moveTo:function(bounds,zoomChanged,dragging){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),bounds=bounds||this.map.getExtent(),null!=bounds){var forceReTile=!this.grid.length||zoomChanged,tilesBounds=this.getTilesBounds(),resolution=this.map.getResolution();this.getServerResolution(resolution),this.singleTile?(forceReTile||!dragging&&!tilesBounds.containsBounds(bounds))&&(zoomChanged&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),zoomChanged&&"resize"!==this.transitionEffect||this.applyBackBuffer(resolution),this.initSingleTile(bounds)):(forceReTile=forceReTile||!tilesBounds.intersectsBounds(bounds,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),forceReTile?(!zoomChanged||"resize"!==this.transitionEffect&&this.gridResolution!==resolution||this.applyBackBuffer(resolution),this.initGriddedTiles(bounds)):this.moveGriddedTiles())}},getTileData:function(loc){var data=null,x=loc.lon,y=loc.lat,numRows=this.grid.length;if(this.map&&numRows){var res=this.map.getResolution(),tileWidth=this.tileSize.w,tileHeight=this.tileSize.h,bounds=this.grid[0][0].bounds,left=bounds.left,top=bounds.top;if(left>x&&this.map.baseLayer.wrapDateLine){var worldWidth=this.map.getMaxExtent().getWidth(),worldsAway=Math.ceil((left-x)/worldWidth);x+=worldWidth*worldsAway}var dtx=(x-left)/(res*tileWidth),dty=(top-y)/(res*tileHeight),col=Math.floor(dtx),row=Math.floor(dty);if(row>=0&&numRows>row){var tile=this.grid[row][col];tile&&(data={tile:tile,i:Math.floor((dtx-col)*tileWidth),j:Math.floor((dty-row)*tileHeight)})}}return data},destroyTile:function(tile){this.removeTileMonitoringHooks(tile),tile.destroy()},getServerResolution:function(resolution){var distance=Number.POSITIVE_INFINITY;if(resolution=resolution||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,resolution)){var i,newDistance,newResolution,serverResolution;for(i=this.serverResolutions.length-1;i>=0&&(newResolution=this.serverResolutions[i],newDistance=Math.abs(newResolution-resolution),!(newDistance>distance));i--)distance=newDistance,serverResolution=newResolution;resolution=serverResolution}return resolution},getServerZoom:function(){var resolution=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,resolution):this.map.getZoomForResolution(resolution)+(this.zoomOffset||0)},applyBackBuffer:function(resolution){null!==this.backBufferTimerId&&this.removeBackBuffer();var backBuffer=this.backBuffer;if(!backBuffer){if(backBuffer=this.createBackBuffer(),!backBuffer)return;resolution===this.gridResolution?this.div.insertBefore(backBuffer,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(backBuffer,this.map.baseLayer.div),this.backBuffer=backBuffer;var topLeftTileBounds=this.grid[0][0].bounds;this.backBufferLonLat={lon:topLeftTileBounds.left,lat:topLeftTileBounds.top},this.backBufferResolution=this.gridResolution}for(var tile,ratio=this.backBufferResolution/resolution,tiles=backBuffer.childNodes,i=tiles.length-1;i>=0;--i)tile=tiles[i],tile.style.top=(0|ratio*tile._i*tile._h)+"px",tile.style.left=(0|ratio*tile._j*tile._w)+"px",tile.style.width=Math.round(ratio*tile._w)+"px",tile.style.height=Math.round(ratio*tile._h)+"px";var position=this.getViewPortPxFromLonLat(this.backBufferLonLat,resolution),leftOffset=this.map.layerContainerOriginPx.x,topOffset=this.map.layerContainerOriginPx.y;backBuffer.style.left=Math.round(position.x-leftOffset)+"px",backBuffer.style.top=Math.round(position.y-topOffset)+"px"},createBackBuffer:function(){var backBuffer;if(this.grid.length>0){backBuffer=document.createElement("div"),backBuffer.id=this.div.id+"_bb",backBuffer.className="olBackBuffer",backBuffer.style.position="absolute";var map=this.map;backBuffer.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:map.Z_INDEX_BASE.BaseLayer-(map.getNumLayers()-map.getLayerIndex(this));for(var i=0,lenI=this.grid.length;lenI>i;i++)for(var j=0,lenJ=this.grid[i].length;lenJ>j;j++){var tile=this.grid[i][j],markup=this.grid[i][j].createBackBuffer();markup&&(markup._i=i,markup._j=j,markup._w=tile.size.w,markup._h=tile.size.h,markup.id=tile.id+"_bb",backBuffer.appendChild(markup))}}return backBuffer},removeBackBuffer:function(){if(this._transitionElement){for(var i=this.transitionendEvents.length-1;i>=0;--i)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[i],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(size){this.singleTile&&(size=this.map.getSize(),size.h=parseInt(size.h*this.ratio,10),size.w=parseInt(size.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[size])},getTilesBounds:function(){var bounds=null,length=this.grid.length;if(length){var bottomLeftTileBounds=this.grid[length-1][0].bounds,width=this.grid[0].length*bottomLeftTileBounds.getWidth(),height=this.grid.length*bottomLeftTileBounds.getHeight();bounds=new OpenLayers.Bounds(bottomLeftTileBounds.left,bottomLeftTileBounds.bottom,bottomLeftTileBounds.left+width,bottomLeftTileBounds.bottom+height)}return bounds},initSingleTile:function(bounds){this.events.triggerEvent("retile");var center=bounds.getCenterLonLat(),tileWidth=bounds.getWidth()*this.ratio,tileHeight=bounds.getHeight()*this.ratio,tileBounds=new OpenLayers.Bounds(center.lon-tileWidth/2,center.lat-tileHeight/2,center.lon+tileWidth/2,center.lat+tileHeight/2),px=this.map.getLayerPxFromLonLat({lon:tileBounds.left,lat:tileBounds.top});this.grid.length||(this.grid[0]=[]);var tile=this.grid[0][0];tile?tile.moveTo(tileBounds,px):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),tile.draw(),this.grid[0][0]=tile),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w,tilelat=resolution*this.tileSize.h,offsetlon=bounds.left-origin.lon,tilecol=Math.floor(offsetlon/tilelon)-this.buffer,rowSign=this.rowSign,offsetlat=rowSign*(origin.lat-bounds.top+tilelat),tilerow=Math[~rowSign?"floor":"ceil"](offsetlat/tilelat)-this.buffer*rowSign;return{tilelon:tilelon,tilelat:tilelat,startcol:tilecol,startrow:tilerow}},getTileOrigin:function(){var origin=this.tileOrigin;if(!origin){var extent=this.getMaxExtent(),edges={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];origin=new OpenLayers.LonLat(extent[edges[0]],extent[edges[1]])}return origin},getTileBoundsForGridIndex:function(row,col){var origin=this.getTileOrigin(),tileLayout=this.gridLayout,tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,startcol=tileLayout.startcol,startrow=tileLayout.startrow,rowSign=this.rowSign;return new OpenLayers.Bounds(origin.lon+(startcol+col)*tilelon,origin.lat-(startrow+row*rowSign)*tilelat*rowSign,origin.lon+(startcol+col+1)*tilelon,origin.lat-(startrow+(row-1)*rowSign)*tilelat*rowSign)},initGriddedTiles:function(bounds){this.events.triggerEvent("retile");var viewSize=this.map.getSize(),origin=this.getTileOrigin(),resolution=this.map.getResolution(),serverResolution=this.getServerResolution(),ratio=resolution/serverResolution,tileSize={w:this.tileSize.w/ratio,h:this.tileSize.h/ratio},minRows=Math.ceil(viewSize.h/tileSize.h)+2*this.buffer+1,minCols=Math.ceil(viewSize.w/tileSize.w)+2*this.buffer+1,tileLayout=this.calculateGridLayout(bounds,origin,serverResolution);this.gridLayout=tileLayout;var tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,layerContainerDivLeft=this.map.layerContainerOriginPx.x,layerContainerDivTop=this.map.layerContainerOriginPx.y,tileBounds=this.getTileBoundsForGridIndex(0,0),startPx=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(tileBounds.left,tileBounds.top));startPx.x=Math.round(startPx.x)-layerContainerDivLeft,startPx.y=Math.round(startPx.y)-layerContainerDivTop;var tileData=[],center=this.map.getCenter(),rowidx=0;do{var row=this.grid[rowidx];row||(row=[],this.grid.push(row));var colidx=0;do{tileBounds=this.getTileBoundsForGridIndex(rowidx,colidx);var px=startPx.clone();px.x=px.x+colidx*Math.round(tileSize.w),px.y=px.y+rowidx*Math.round(tileSize.h);var tile=row[colidx];tile?tile.moveTo(tileBounds,px,!1):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),row.push(tile));var tileCenter=tileBounds.getCenterLonLat();tileData.push({tile:tile,distance:Math.pow(tileCenter.lon-center.lon,2)+Math.pow(tileCenter.lat-center.lat,2)}),colidx+=1}while(tileBounds.right<=bounds.right+tilelon*this.buffer||minCols>colidx);rowidx+=1}while(tileBounds.bottom>=bounds.bottom-tilelat*this.buffer||minRows>rowidx);this.removeExcessTiles(rowidx,colidx);var resolution=this.getServerResolution();this.gridResolution=resolution,tileData.sort(function(a,b){return a.distance-b.distance});for(var i=0,ii=tileData.length;ii>i;++i)tileData[i].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(bounds,position){var tile=new this.tileClass(this,position,bounds,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:tile}),tile},addTileMonitoringHooks:function(tile){var replacingCls="olTileReplacing";tile.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:tile}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(tile.getTile(),replacingCls)},tile.onLoadEnd=function(evt){this.numLoadingTiles--;var aborted="unload"===evt.type;if(this.events.triggerEvent("tileloaded",{tile:tile,aborted:aborted}),!this.singleTile&&!aborted&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var tileDiv=tile.getTile();if("none"===OpenLayers.Element.getStyle(tileDiv,"display")){var bufferTile=document.getElementById(tile.id+"_bb");bufferTile&&bufferTile.parentNode.removeChild(bufferTile)}OpenLayers.Element.removeClass(tileDiv,replacingCls)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=aborted?this.div.lastChild:tile.imgDiv;for(var transitionendEvents=this.transitionendEvents,i=transitionendEvents.length-1;i>=0;--i)OpenLayers.Event.observe(this._transitionElement,transitionendEvents[i],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},tile.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:tile})},tile.events.on({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},removeTileMonitoringHooks:function(tile){tile.unload(),tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},moveGriddedTiles:function(){for(var buffer=this.buffer+1;;){var tlTile=this.grid[0][0],tlViewPort={x:tlTile.position.x+this.map.layerContainerOriginPx.x,y:tlTile.position.y+this.map.layerContainerOriginPx.y},ratio=this.getServerResolution()/this.map.getResolution(),tileSize={w:Math.round(this.tileSize.w*ratio),h:Math.round(this.tileSize.h*ratio)};if(tlViewPort.x>-tileSize.w*(buffer-1))this.shiftColumn(!0,tileSize);else if(tlViewPort.x<-tileSize.w*buffer)this.shiftColumn(!1,tileSize);else if(tlViewPort.y>-tileSize.h*(buffer-1))this.shiftRow(!0,tileSize);else{if(!(tlViewPort.y<-tileSize.h*buffer))break;this.shiftRow(!1,tileSize)}}},shiftRow:function(prepend,tileSize){var grid=this.grid,rowIndex=prepend?0:grid.length-1,sign=prepend?-1:1,rowSign=this.rowSign,tileLayout=this.gridLayout;tileLayout.startrow+=sign*rowSign;for(var modelRow=grid[rowIndex],row=grid[prepend?"pop":"shift"](),i=0,len=row.length;len>i;i++){var tile=row[i],position=modelRow[i].position.clone();position.y+=tileSize.h*sign,tile.moveTo(this.getTileBoundsForGridIndex(rowIndex,i),position)}grid[prepend?"unshift":"push"](row)},shiftColumn:function(prepend,tileSize){var grid=this.grid,colIndex=prepend?0:grid[0].length-1,sign=prepend?-1:1,tileLayout=this.gridLayout;tileLayout.startcol+=sign;for(var i=0,len=grid.length;len>i;i++){var row=grid[i],position=row[colIndex].position.clone(),tile=row[prepend?"pop":"shift"]();position.x+=tileSize.w*sign,tile.moveTo(this.getTileBoundsForGridIndex(i,colIndex),position),row[prepend?"unshift":"push"](tile)}},removeExcessTiles:function(rows,columns){for(var i,l;this.grid.length>rows;){var row=this.grid.pop();for(i=0,l=row.length;l>i;i++){var tile=row[i];this.destroyTile(tile)}}for(i=0,l=this.grid.length;l>i;i++)for(;this.grid[i].length>columns;){var row=this.grid[i],tile=row.pop();this.destroyTile(tile)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(viewPortPx){var maxExtent=this.maxExtent,resolution=this.getResolution(),tileMapWidth=resolution*this.tileSize.w,tileMapHeight=resolution*this.tileSize.h,mapPoint=this.getLonLatFromViewPortPx(viewPortPx),tileLeft=maxExtent.left+tileMapWidth*Math.floor((mapPoint.lon-maxExtent.left)/tileMapWidth),tileBottom=maxExtent.bottom+tileMapHeight*Math.floor((mapPoint.lat-maxExtent.bottom)/tileMapHeight);return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(options){OpenLayers.Util.extend(this,options),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(map){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(map),this.tileQueue[map.id]=[];for(var i=0,ii=map.layers.length;ii>i;++i)this.addLayer({layer:map.layers[i]});map.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(map){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[map.id]),map.layers)for(var i=0,ii=map.layers.length;ii>i;++i)this.removeLayer({layer:map.layers[i]});map.events&&map.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[map.id],delete this.tileQueueId[map.id],OpenLayers.Util.removeItem(this.maps,map)}},move:function(evt){this.updateTimeout(evt.object,this.moveDelay,!0)},zoomEnd:function(evt){this.updateTimeout(evt.object,this.zoomDelay)},changeLayer:function(evt){("visibility"===evt.property||"params"===evt.property)&&this.updateTimeout(evt.object,0)},addLayer:function(evt){var layer=evt.layer;if(layer instanceof OpenLayers.Layer.Grid){layer.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var i,j,tile;for(i=layer.grid.length-1;i>=0;--i)for(j=layer.grid[i].length-1;j>=0;--j)tile=layer.grid[i][j],this.addTile({tile:tile}),tile.url&&this.manageTileCache({object:tile})}},removeLayer:function(evt){var layer=evt.layer;if(layer instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:layer}),layer.events&&layer.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),layer.grid)){var i,j,tile;for(i=layer.grid.length-1;i>=0;--i)for(j=layer.grid[i].length-1;j>=0;--j)tile=layer.grid[i][j],this.unloadTile({object:tile}),tile.url&&this.manageTileCache({object:tile})}},updateTimeout:function(map,delay,nice){window.clearTimeout(this.tileQueueId[map.id]);var tileQueue=this.tileQueue[map.id];(!nice||tileQueue.length)&&(this.tileQueueId[map.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(map),tileQueue.length&&this.updateTimeout(map,this.frameDelay)},this),delay))},addTile:function(evt){evt.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this})},unloadTile:function(evt){var tile=evt.object;tile.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[tile.layer.map.id],tile)},queueTileDraw:function(evt){var tile=evt.object,queued=!1,layer=tile.layer,url=layer.getURL(tile.bounds),img=this.tileCache[url];if(img&&"olTileImage"!==img.className&&(delete this.tileCache[url],OpenLayers.Util.removeItem(this.tileCacheIndex,url),img=null),layer.url&&(layer.async||!img)){var tileQueue=this.tileQueue[layer.map.id];~OpenLayers.Util.indexOf(tileQueue,tile)||tileQueue.push(tile),queued=!0
}return!queued},drawTilesFromQueue:function(map){for(var tileQueue=this.tileQueue[map.id],limit=this.tilesPerFrame,animating=map.zoomTween&&map.zoomTween.playing;!animating&&tileQueue.length&&limit;)tileQueue.shift().draw(!0),--limit},manageTileCache:function(evt){var tile=evt.object,img=this.tileCache[tile.url];if(img&&(!img.parentNode||OpenLayers.Element.hasClass(img.parentNode,"olBackBuffer"))){if(tile.layer.backBuffer){if(tile.layer.backBuffer===img.parentNode)return;img.style.opacity=0,img.style.visibility="hidden"}img.id=null,tile.setImage(img),OpenLayers.Util.removeItem(this.tileCacheIndex,tile.url),this.tileCacheIndex.push(tile.url)}},addToCache:function(evt){var tile=evt.object;this.tileCache[tile.url]||OpenLayers.Element.hasClass(tile.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[tile.url]=tile.imgDiv,this.tileCacheIndex.push(tile.url))},clearTileQueue:function(evt){for(var layer=evt.object,tileQueue=this.tileQueue[layer.map.id],i=tileQueue.length-1;i>=0;--i)tileQueue[i].layer===layer&&tileQueue.splice(i,1)},destroy:function(){for(var i=this.maps.length-1;i>=0;--i)this.removeMap(this.maps[i]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var me=this;this._docMove=function(evt){me.mousemove({xy:{x:evt.clientX,y:evt.clientY},element:document})},this._docUp=function(evt){me.mouseup({xy:{x:evt.clientX,y:evt.clientY}})}}},dragstart:function(evt){var propagate=!0;return this.dragging=!1,this.checkModifiers(evt)&&(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))?(this.started=!0,this.start=evt.xy,this.last=evt.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(evt),this.callback("down",[evt.xy]),OpenLayers.Event.preventDefault(evt),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,propagate=!this.stopDown):(this.started=!1,this.start=null,this.last=null),propagate},dragmove:function(evt){return this.lastMoveEvt=evt,!this.started||this.timeoutId||evt.xy.x==this.last.x&&evt.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(evt.element===document?(this.adjustXY(evt),this.setEvent(evt)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(evt),this.callback("move",[evt.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=evt.xy),!0},dragend:function(evt){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(evt),this.removeDocumentEvents());var dragged=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(evt),this.callback("up",[evt.xy]),dragged&&this.callback("done",[evt.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(evt){return this.dragstart(evt)},touchstart:function(evt){return this.startTouch(),this.dragstart(evt)},mousemove:function(evt){return this.dragmove(evt)},touchmove:function(evt){return this.dragmove(evt)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(evt){return this.dragend(evt)},touchend:function(evt){return evt.xy=this.last,this.dragend(evt)},mouseout:function(evt){if(this.started&&OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var dragged=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(evt),this.callback("out",[]),dragged&&this.callback("done",[evt.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,deactivated=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),deactivated},adjustXY:function(evt){var pos=OpenLayers.Util.pagePosition(this.map.viewPortDiv);evt.xy.x-=pos[0],evt.xy.y-=pos[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var config={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(config=OpenLayers.Util.extend(config,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(config)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(xy){this.kinetic&&this.kinetic.update(xy),this.panned=!0,this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!0,animate:!1})},panMapDone:function(xy){if(this.panned){var res=null;if(this.kinetic&&(res=this.kinetic.end(xy)),this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!!res,animate:!1}),res){var self=this;this.kinetic.move(res,function(x,y,end){self.map.pan(x,y,{dragging:!end,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(evt){var xy=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):evt.xy;this.pinchOrigin=xy,this.currentCenter=xy},pinchMove:function(evt,pinchData){var scale=pinchData.scale,containerOrigin=this.map.layerContainerOriginPx,pinchOrigin=this.pinchOrigin,current=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):evt.xy,dx=Math.round(containerOrigin.x+current.x-pinchOrigin.x+(scale-1)*(containerOrigin.x-pinchOrigin.x)),dy=Math.round(containerOrigin.y+current.y-pinchOrigin.y+(scale-1)*(containerOrigin.y-pinchOrigin.y));this.map.applyTransform(dx,dy,scale),this.currentCenter=current},pinchDone:function(evt,start,last){this.map.applyTransform();var zoom=this.map.getZoomForResolution(this.map.getResolution()/last.scale,!0);if(zoom!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var resolution=this.map.getResolutionForZoom(zoom),location=this.map.getLonLatFromPixel(this.pinchOrigin),zoomPixel=this.currentCenter,size=this.map.getSize();location.lon+=resolution*(size.w/2-zoomPixel.x),location.lat-=resolution*(size.h/2-zoomPixel.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(location,zoom)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick},clickOptions=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(evt){evt.lastTouches&&2==evt.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(evt){this.map.zoomTo(this.map.zoom+1,evt.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(containerID,options){this.container=OpenLayers.Util.getElement(containerID),OpenLayers.Util.extend(this,options)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(extent,resolutionChanged){if(this.extent=extent.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio);this.extent=extent.wrapDateLine(this.map.getMaxExtent()).scale(ratio)}return resolutionChanged&&(this.resolution=null),!0},setSize:function(size){this.size=size.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(feature,style){if(null==style&&(style=feature.style),feature.geometry){var bounds=feature.geometry.getBounds();if(bounds){var worldBounds;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent()),bounds.intersectsBounds(this.extent,{worldBounds:worldBounds})?this.calculateFeatureDx(bounds,worldBounds):style={display:"none"};var rendered=this.drawGeometry(feature.geometry,style,feature.id);if("none"!=style.display&&style.label&&rendered!==!1){var location=feature.geometry.getCentroid();if(style.labelXOffset||style.labelYOffset){var xOffset=isNaN(style.labelXOffset)?0:style.labelXOffset,yOffset=isNaN(style.labelYOffset)?0:style.labelYOffset,res=this.getResolution();location.move(xOffset*res,yOffset*res)}this.drawText(feature.id,style,location)}else this.removeText(feature.id);return rendered}}},calculateFeatureDx:function(bounds,worldBounds){if(this.featureDx=0,worldBounds){var worldWidth=worldBounds.getWidth(),rendererCenterX=(this.extent.left+this.extent.right)/2,featureCenterX=(bounds.left+bounds.right)/2,worldsAway=Math.round((featureCenterX-rendererCenterX)/worldWidth);this.featureDx=worldsAway*worldWidth}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var i=0,len=features.length;len>i;++i){var feature=features[i];this.eraseGeometry(feature.geometry,feature.id),this.removeText(feature.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(symbolizer){var result=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return symbolizer.stroke===!1&&(delete result.strokeWidth,delete result.strokeColor),symbolizer.fill===!1&&delete result.fillColor,OpenLayers.Util.extend(result,symbolizer),result},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(style,options){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},style instanceof OpenLayers.Style)this.styles["default"]=style,this.styles.select=style,this.styles.temporary=style,this.styles["delete"]=style;else if("object"==typeof style)for(var key in style)if(style[key]instanceof OpenLayers.Style)this.styles[key]=style[key];else{if("object"!=typeof style[key]){this.styles["default"]=new OpenLayers.Style(style),this.styles.select=new OpenLayers.Style(style),this.styles.temporary=new OpenLayers.Style(style),this.styles["delete"]=new OpenLayers.Style(style);break}this.styles[key]=new OpenLayers.Style(style[key])}OpenLayers.Util.extend(this,options)},destroy:function(){for(var key in this.styles)this.styles[key].destroy();this.styles=null},createSymbolizer:function(feature,intent){feature||(feature=new OpenLayers.Feature.Vector),this.styles[intent]||(intent="default"),feature.renderIntent=intent;var defaultSymbolizer={};return this.extendDefault&&"default"!=intent&&(defaultSymbolizer=this.styles["default"].createSymbolizer(feature)),OpenLayers.Util.extend(defaultSymbolizer,this.styles[intent].createSymbolizer(feature))},addUniqueValueRules:function(renderIntent,property,symbolizers,context){var rules=[];for(var value in symbolizers)rules.push(new OpenLayers.Rule({symbolizer:symbolizers[value],context:context,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:property,value:value})}));this.styles[renderIntent].addRules(rules)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,len=this.strategies.length;len>i;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoDestroy&&strategy.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){null==obj&&(obj=new OpenLayers.Layer.Vector(this.name,this.getOptions())),obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);for(var features=this.features,len=features.length,clonedFeatures=new Array(len),i=0;len>i;++i)clonedFeatures[i]=features[i].clone();return obj.features=clonedFeatures,obj},refresh:function(obj){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",obj)},assignRenderer:function(){for(var i=0,len=this.renderers.length;len>i;i++){var rendererClass=this.renderers[i],renderer="function"==typeof rendererClass?rendererClass:OpenLayers.Renderer[rendererClass];if(renderer&&renderer.prototype.supported()){this.renderer=new renderer(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio,newSize.h=newSize.h*this.ratio,this.renderer.setSize(newSize)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio,newSize.h=newSize.h*this.ratio,this.renderer.setSize(newSize)},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var coordSysUnchanged=!0;if(!dragging){this.renderer.root.style.visibility="hidden";var viewSize=this.map.getSize(),viewWidth=viewSize.w,viewHeight=viewSize.h,offsetLeft=viewWidth/2*this.ratio-viewWidth/2,offsetTop=viewHeight/2*this.ratio-viewHeight/2;offsetLeft+=this.map.layerContainerOriginPx.x,offsetLeft=-Math.round(offsetLeft),offsetTop+=this.map.layerContainerOriginPx.y,offsetTop=-Math.round(offsetTop),this.div.style.left=offsetLeft+"px",this.div.style.top=offsetTop+"px";var extent=this.map.getExtent().scale(this.ratio);if(coordSysUnchanged=this.renderer.setExtent(extent,zoomChanged),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!zoomChanged&&coordSysUnchanged)for(var i in this.unrenderedFeatures){var feature=this.unrenderedFeatures[i];this.drawFeature(feature)}}if(!this.drawn||zoomChanged||!coordSysUnchanged){this.drawn=!0;for(var feature,i=0,len=this.features.length;len>i;i++)this.renderer.locked=i!==len-1,feature=this.features[i],this.drawFeature(feature)}},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var currentDisplay=this.div.style.display;currentDisplay!=this.renderer.root.style.display&&(this.renderer.root.style.display=currentDisplay)},addFeatures:function(features,options){OpenLayers.Util.isArray(features)||(features=[features]);var notify=!options||!options.silent;if(notify){var event={features:features},ret=this.events.triggerEvent("beforefeaturesadded",event);if(ret===!1)return;features=event.features}for(var featuresAdded=[],i=0,len=features.length;len>i;i++){this.renderer.locked=i!=features.length-1?!0:!1;var feature=features[i];if(this.geometryType&&!(feature.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(feature.layer=this,!feature.style&&this.style&&(feature.style=OpenLayers.Util.extend({},this.style)),notify){if(this.events.triggerEvent("beforefeatureadded",{feature:feature})===!1)continue;this.preFeatureInsert(feature)}featuresAdded.push(feature),this.features.push(feature),this.drawFeature(feature),notify&&(this.events.triggerEvent("featureadded",{feature:feature}),this.onFeatureInsert(feature))}notify&&this.events.triggerEvent("featuresadded",{features:featuresAdded})},removeFeatures:function(features,options){if(features&&0!==features.length){if(features===this.features)return this.removeAllFeatures(options);OpenLayers.Util.isArray(features)||(features=[features]),features===this.selectedFeatures&&(features=features.slice());var notify=!options||!options.silent;notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features});for(var i=features.length-1;i>=0;i--){this.renderer.locked=0!=i&&features[i-1].geometry?!0:!1;var feature=features[i];delete this.unrenderedFeatures[feature.id],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),this.features=OpenLayers.Util.removeItem(this.features,feature),feature.layer=null,feature.geometry&&this.renderer.eraseFeatures(feature),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,feature)&&OpenLayers.Util.removeItem(this.selectedFeatures,feature),notify&&this.events.triggerEvent("featureremoved",{feature:feature})}notify&&this.events.triggerEvent("featuresremoved",{features:features})}},removeAllFeatures:function(options){var notify=!options||!options.silent,features=this.features;notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features});for(var feature,i=features.length-1;i>=0;i--)feature=features[i],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),feature.layer=null,notify&&this.events.triggerEvent("featureremoved",{feature:feature});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],notify&&this.events.triggerEvent("featuresremoved",{features:features})},destroyFeatures:function(features,options){var all=void 0==features;if(all&&(features=this.features),features){this.removeFeatures(features,options);for(var i=features.length-1;i>=0;i--)features[i].destroy()}},drawFeature:function(feature,style){if(this.drawn){if("object"!=typeof style){style||feature.state!==OpenLayers.State.DELETE||(style="delete");var renderIntent=style||feature.renderIntent;style=feature.style||this.style,style||(style=this.styleMap.createSymbolizer(feature,renderIntent))}var drawn=this.renderer.drawFeature(feature,style);drawn===!1||null===drawn?this.unrenderedFeatures[feature.id]=feature:delete this.unrenderedFeatures[feature.id]}},eraseFeatures:function(features){this.renderer.eraseFeatures(features)},getFeatureFromEvent:function(evt){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var feature=null,featureId=this.renderer.getFeatureIdFromEvent(evt);return featureId&&(feature="string"==typeof featureId?this.getFeatureById(featureId):featureId),feature},getFeatureBy:function(property,value){for(var feature=null,i=0,len=this.features.length;len>i;++i)if(this.features[i][property]==value){feature=this.features[i];break}return feature},getFeatureById:function(featureId){return this.getFeatureBy("id",featureId)},getFeatureByFid:function(featureFid){return this.getFeatureBy("fid",featureFid)},getFeaturesByAttribute:function(attrName,attrValue){var i,feature,len=this.features.length,foundFeatures=[];for(i=0;len>i;i++)feature=this.features[i],feature&&feature.attributes&&feature.attributes[attrName]===attrValue&&foundFeatures.push(feature);return foundFeatures},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var maxExtent=null,features=this.features;if(features&&features.length>0)for(var geometry=null,i=0,len=features.length;len>i;i++)geometry=features[i].geometry,geometry&&(null===maxExtent&&(maxExtent=new OpenLayers.Bounds),maxExtent.extend(geometry.getBounds()));return maxExtent},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(name,url,options){(options&&options.sphericalMercator||this.sphericalMercator)&&(options=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},options)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name||this.name,url||this.url,{},options])},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var xyz=this.getXYZ(bounds),url=this.url;if(OpenLayers.Util.isArray(url)){var s=""+xyz.x+xyz.y+xyz.z;url=this.selectUrl(s,url)}return OpenLayers.String.format(url,xyz)},getXYZ:function(bounds){var res=this.getServerResolution(),x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w)),y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h)),z=this.getServerZoom();if(this.wrapDateLine){var limit=Math.pow(2,z);x=(x%limit+limit)%limit}return{x:x,y:y,z:z}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(force){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,force),this.line=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(pixel){this.layer.removeFeatures([this.point]);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(x,y){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(x,y),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(dx,dy){var previousIndex=this.getCurrentPointIndex()-1,p0=this.line.geometry.components[previousIndex];!p0||isNaN(p0.x)||isNaN(p0.y)||this.insertXY(p0.x+dx,p0.y+dy)},insertDirectionLength:function(direction,length){direction*=Math.PI/180;var dx=length*Math.cos(direction),dy=length*Math.sin(direction);this.insertDeltaXY(dx,dy)},insertDeflectionLength:function(deflection,length){var previousIndex=this.getCurrentPointIndex()-1;if(previousIndex>0){var p1=this.line.geometry.components[previousIndex],p0=this.line.geometry.components[previousIndex-1],theta=Math.atan2(p1.y-p0.y,p1.x-p0.x);this.insertDirectionLength(180*theta/Math.PI+deflection,length)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var geometry=this.line.geometry,components=geometry.components,index=this.getCurrentPointIndex()-1,target=components[index],undone=geometry.removeComponent(target);if(undone){if(this.touch&&index>0){components=geometry.components;var lastpt=components[index-1],curptidx=this.getCurrentPointIndex(),curpt=components[curptidx];curpt.x=lastpt.x,curpt.y=lastpt.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(target),this.drawFeature()}return undone},redo:function(){var target=this.redoStack&&this.redoStack.pop();return target&&(this.line.geometry.addComponent(target,this.getCurrentPointIndex()),this.drawFeature()),!!target},freehandMode:function(evt){return this.freehandToggle&&evt[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(pixel,drawing){this.line||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon,this.point.geometry.y=lonlat.lat,this.callback("modify",[this.point.geometry,this.getSketch(),drawing]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var geometry=this.line&&this.line.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiLineString([geometry])),geometry},touchstart:function(evt){return this.timerId&&this.passesTolerance(this.lastTouchPx,evt.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,evt))},down:function(evt){var stopDown=this.stopDown;return this.freehandMode(evt)&&(stopDown=!0,this.touch&&(this.modifyFeature(evt.xy,!!this.lastUp),OpenLayers.Event.stop(evt))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)||this.modifyFeature(evt.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=evt.xy,this.stoppedDown=stopDown,!stopDown},move:function(evt){return this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(evt.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy,!!this.lastUp),!0)},up:function(evt){return!this.mouseDown||this.lastUp&&this.lastUp.equals(evt.xy)||(this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(evt.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(evt.xy),this.lastUp=evt.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp
},finishGeometry:function(){var index=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[index]),this.removePoint(),this.finalize()},dblclick:function(evt){return this.freehandMode(evt)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var candidate,polygon,geometry=this.point.geometry,features=this.control.layer.features,i=features.length-1;i>=0;--i)if(candidate=features[i].geometry,(candidate instanceof OpenLayers.Geometry.Polygon||candidate instanceof OpenLayers.Geometry.MultiPolygon)&&candidate.intersects(geometry)){polygon=features[i],this.control.layer.removeFeatures([polygon],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),polygon.geometry.addComponent(this.line.geometry),this.polygon=polygon,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(event){var point=event.vertex,components=this.line.geometry.components;if(!this.polygon.geometry.intersects(point)){var last=components[components.length-3];point.x=last.x,point.y=last.y}},finishGeometry:function(){var index=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[index]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var ring=this.line.geometry,modified=0!==ring.getArea();if(modified){for(var rings=this.polygon.geometry.components,i=rings.length-2;i>=0;--i)if(ring.intersects(rings[i])){modified=!1;break}if(modified)outer:for(var i=rings.length-2;i>0;--i)for(var points=rings[i].components,j=0,jj=points.length;jj>j;++j)if(ring.containsPoint(points[j])){modified=!1;break outer}}return modified?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(ring),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(cancel){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,cancel||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(force){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,force),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var geometry=this.polygon&&this.polygon.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPolygon([geometry])),geometry},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(geometry,featureId){this.eraseFeatures(this.features[featureId][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(size){this.size=size.clone();var root=this.root;if(root.style.width=size.w+"px",root.style.height=size.h+"px",root.width=size.w,root.height=size.h,this.resolution=null,this.hitDetection){var hitCanvas=this.hitCanvas;hitCanvas.style.width=size.w+"px",hitCanvas.style.height=size.h+"px",hitCanvas.width=size.w,hitCanvas.height=size.h}},drawFeature:function(feature,style){var rendered;if(feature.geometry){style=this.applyDefaultSymbolizer(style||feature.style);var worldBounds,bounds=feature.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent());var intersects=bounds&&bounds.intersectsBounds(this.extent,{worldBounds:worldBounds});rendered="none"!==style.display&&!!bounds&&intersects,rendered?this.features[feature.id]=[feature,style]:delete this.features[feature.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),rendered},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=className&&"OpenLayers.Geometry.MultiPoint"!=className&&"OpenLayers.Geometry.MultiLineString"!=className&&"OpenLayers.Geometry.MultiPolygon"!=className)switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(geometry,style,featureId);break;case"OpenLayers.Geometry.LineString":this.drawLineString(geometry,style,featureId);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(geometry,style,featureId);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(geometry,style,featureId)}else for(var i=0;i<geometry.components.length;i++)this.drawGeometry(geometry.components[i],style,featureId)},drawExternalGraphic:function(geometry,style,featureId){var img=new Image,title=style.title||style.graphicTitle;title&&(img.title=title);var width=style.graphicWidth||style.graphicHeight,height=style.graphicHeight||style.graphicWidth;width=width?width:2*style.pointRadius,height=height?height:2*style.pointRadius;var xOffset=void 0!=style.graphicXOffset?style.graphicXOffset:-(.5*width),yOffset=void 0!=style.graphicYOffset?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity,onLoad=function(){if(this.features[featureId]){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var x=0|p0+xOffset,y=0|p1+yOffset,canvas=this.canvas;canvas.globalAlpha=opacity;var factor=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);canvas.drawImage(img,x*factor,y*factor,width*factor,height*factor),this.hitDetection&&(this.setHitContextStyle("fill",featureId),this.hitContext.fillRect(x,y,width,height))}}};img.onload=OpenLayers.Function.bind(onLoad,this),img.src=style.externalGraphic},drawNamedSymbol:function(geometry,style,featureId){var x,y,cx,cy,i,symbolBounds,scaling,angle,unscaledStrokeWidth,deg2rad=Math.PI/180,symbol=OpenLayers.Renderer.symbol[style.graphicName];if(!symbol)throw new Error(style.graphicName+" is not a valid symbol name");if(symbol.length&&!(symbol.length<2)){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),style.graphicName in this.cachedSymbolBounds)symbolBounds=this.cachedSymbolBounds[style.graphicName];else{for(symbolBounds=new OpenLayers.Bounds,i=0;i<symbol.length;i+=2)symbolBounds.extend(new OpenLayers.LonLat(symbol[i],symbol[i+1]));this.cachedSymbolBounds[style.graphicName]=symbolBounds}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p0,p1),this.hitDetection&&this.hitContext.translate(p0,p1),angle=deg2rad*style.rotation,isNaN(angle)||(this.canvas.rotate(angle),this.hitDetection&&this.hitContext.rotate(angle)),scaling=2*style.pointRadius/Math.max(symbolBounds.getWidth(),symbolBounds.getHeight()),this.canvas.scale(scaling,scaling),this.hitDetection&&this.hitContext.scale(scaling,scaling),cx=symbolBounds.getCenterLonLat().lon,cy=symbolBounds.getCenterLonLat().lat,this.canvas.translate(-cx,-cy),this.hitDetection&&this.hitContext.translate(-cx,-cy),unscaledStrokeWidth=style.strokeWidth,style.strokeWidth=unscaledStrokeWidth/scaling,style.fill!==!1){for(this.setCanvasStyle("fill",style),this.canvas.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath(),this.hitContext.fill()}}if(style.stroke!==!1){for(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",featureId,style,scaling),this.hitContext.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.hitContext.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath(),this.hitContext.stroke()}}style.strokeWidth=unscaledStrokeWidth,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(type,style){"fill"===type?(this.canvas.globalAlpha=style.fillOpacity,this.canvas.fillStyle=style.fillColor):"stroke"===type?(this.canvas.globalAlpha=style.strokeOpacity,this.canvas.strokeStyle=style.strokeColor,this.canvas.lineWidth=style.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(featureId){var id=Number(featureId.split("_").pop())+1;id>=16777216&&(this.hitOverflow=id-16777215,id=id%16777216+1);var hex="000000"+id.toString(16),len=hex.length;return hex="#"+hex.substring(len-6,len)},setHitContextStyle:function(type,featureId,symbolizer,strokeScaling){var hex=this.featureIdToHex(featureId);"fill"==type?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=hex):"stroke"==type?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=hex,"undefined"==typeof strokeScaling?this.hitContext.lineWidth=symbolizer.strokeWidth+2:isNaN(strokeScaling)||(this.hitContext.lineWidth=symbolizer.strokeWidth+2/strokeScaling)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(geometry,style,featureId){if(style.graphic!==!1)if(style.externalGraphic)this.drawExternalGraphic(geometry,style,featureId);else if(style.graphicName&&"circle"!=style.graphicName)this.drawNamedSymbol(geometry,style,featureId);else{var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var twoPi=2*Math.PI,radius=style.pointRadius;style.fill!==!1&&(this.setCanvasStyle("fill",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.fill())),style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(geometry,style,featureId){style=OpenLayers.Util.applyDefaults({fill:!1},style),this.drawLinearRing(geometry,style,featureId)},drawLinearRing:function(geometry,style,featureId){style.fill!==!1&&(this.setCanvasStyle("fill",style),this.renderPath(this.canvas,geometry,style,featureId,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"fill"))),style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.renderPath(this.canvas,geometry,style,featureId,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(context,geometry,style,featureId,type){var components=geometry.components,len=components.length;context.beginPath();var start=this.getLocalXY(components[0]),x=start[0],y=start[1];if(!isNaN(x)&&!isNaN(y)){context.moveTo(start[0],start[1]);for(var i=1;len>i;++i){var pt=this.getLocalXY(components[i]);context.lineTo(pt[0],pt[1])}"fill"===type?context.fill():context.stroke()}},drawPolygon:function(geometry,style,featureId){var components=geometry.components,len=components.length;this.drawLinearRing(components[0],style,featureId);for(var i=1;len>i;++i)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},style),featureId),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({fill:!1},style),featureId)},drawText:function(location,style){var pt=this.getLocalXY(location);this.setCanvasStyle("reset"),this.canvas.fillStyle=style.fontColor,this.canvas.globalAlpha=style.fontOpacity||1;var fontStyle=[style.fontStyle?style.fontStyle:"normal","normal",style.fontWeight?style.fontWeight:"normal",style.fontSize?style.fontSize:"1em",style.fontFamily?style.fontFamily:"sans-serif"].join(" "),labelRows=style.label.split("\n"),numRows=labelRows.length;if(this.canvas.fillText){this.canvas.font=fontStyle,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[1]]||"middle";var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];null==vfactor&&(vfactor=-.5);var lineHeight=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;pt[1]+=lineHeight*vfactor*(numRows-1);for(var i=0;numRows>i;i++)style.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=style.labelOutlineOpacity||style.fontOpacity||1,this.canvas.strokeStyle=style.labelOutlineColor,this.canvas.lineWidth=style.labelOutlineWidth,this.canvas.strokeText(labelRows[i],pt[0],pt[1]+lineHeight*i+1),this.canvas.restore()),this.canvas.fillText(labelRows[i],pt[0],pt[1]+lineHeight*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=fontStyle;var hfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[0]];null==hfactor&&(hfactor=-.5);var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];null==vfactor&&(vfactor=-.5);var lineHeight=this.canvas.mozMeasureText("xx");pt[1]+=lineHeight*(1+vfactor*numRows);for(var i=0;numRows>i;i++){var x=pt[0]+hfactor*this.canvas.mozMeasureText(labelRows[i]),y=pt[1]+i*lineHeight;this.canvas.translate(x,y),this.canvas.mozDrawText(labelRows[i]),this.canvas.translate(-x,-y)}}this.setCanvasStyle("reset")},getLocalXY:function(point){var resolution=this.getResolution(),extent=this.extent,x=(point.x-this.featureDx)/resolution+-extent.left/resolution,y=extent.top/resolution-point.y/resolution;return[x,y]},clear:function(){var height=this.root.height,width=this.root.width;this.canvas.clearRect(0,0,width,height),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,width,height)},getFeatureIdFromEvent:function(evt){var featureId,feature;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var xy=evt.xy,x=0|xy.x,y=0|xy.y,data=this.hitContext.getImageData(x,y,1,1).data;if(255===data[3]){var id=data[2]+256*(data[1]+256*data[0]);if(id){featureId="OpenLayers_Feature_Vector_"+(id-1+this.hitOverflow);try{feature=this.features[featureId][0]}catch(err){}}}}return feature},eraseFeatures:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var i=0;i<features.length;++i)delete this.features[features[i].id];this.redraw()},redraw:function(){if(!this.locked){var height=this.root.height,width=this.root.width;this.canvas.clearRect(0,0,width,height),this.hitDetection&&this.hitContext.clearRect(0,0,width,height);var feature,geometry,style,labelMap=[],worldBounds=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var id in this.features)this.features.hasOwnProperty(id)&&(feature=this.features[id][0],geometry=feature.geometry,this.calculateFeatureDx(geometry.getBounds(),worldBounds),style=this.features[id][1],this.drawGeometry(geometry,style,feature.id),style.label&&labelMap.push([feature,style]));for(var item,i=0,len=labelMap.length;len>i;++i)item=labelMap[i],this.drawText(item[0].geometry.getCentroid(),item[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(yOrdering){this.compare=yOrdering?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(newNode){this.exists(newNode)&&this.remove(newNode);var nodeId=newNode.id;this.determineZIndex(newNode);for(var middle,leftIndex=-1,rightIndex=this.order.length;rightIndex-leftIndex>1;){middle=parseInt((leftIndex+rightIndex)/2);var placement=this.compare(this,newNode,OpenLayers.Util.getElement(this.order[middle]));placement>0?leftIndex=middle:rightIndex=middle}return this.order.splice(rightIndex,0,nodeId),this.indices[nodeId]=this.getZIndex(newNode),this.getNextElement(rightIndex)},remove:function(node){var nodeId=node.id,arrayIndex=OpenLayers.Util.indexOf(this.order,nodeId);if(arrayIndex>=0)if(this.order.splice(arrayIndex,1),delete this.indices[nodeId],this.order.length>0){var lastId=this.order[this.order.length-1];this.maxZIndex=this.indices[lastId]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(node){return null!=this.indices[node.id]},getZIndex:function(node){return node._style.graphicZIndex},determineZIndex:function(node){var zIndex=node._style.graphicZIndex;null==zIndex?(zIndex=this.maxZIndex,node._style.graphicZIndex=zIndex):zIndex>this.maxZIndex&&(this.maxZIndex=zIndex)},getNextElement:function(index){var nextIndex=index+1;if(nextIndex<this.order.length){var nextElement=OpenLayers.Util.getElement(this.order[nextIndex]);return void 0==nextElement&&(nextElement=this.getNextElement(nextIndex)),nextElement}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(indexer,newNode,nextNode){var newZIndex=indexer.getZIndex(newNode),returnVal=0;if(nextNode){var nextZIndex=indexer.getZIndex(nextNode);returnVal=newZIndex-nextZIndex}return returnVal},Z_ORDER_DRAWING_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);return nextNode&&0==returnVal&&(returnVal=1),returnVal},Z_ORDER_Y_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);if(nextNode&&0===returnVal){var result=nextNode._boundsBottom-newNode._boundsBottom;returnVal=0===result?1:result}return returnVal}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),options&&(options.zIndexing||options.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(options.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var child,root=this.vectorRoot;if(root)for(;child=root.firstChild;)root.removeChild(child);if(root=this.textRoot)for(;child=root.firstChild;)root.removeChild(child);this.indexer&&this.indexer.clear()},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),resolution=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var rightOfDateLine,ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio),world=this.map.getMaxExtent();world.right>extent.left&&world.right<extent.right?rightOfDateLine=!0:world.left>extent.left&&world.left<extent.right&&(rightOfDateLine=!1),(rightOfDateLine!==this.rightOfDateLine||resolutionChanged)&&(coordSysUnchanged=!1,this.xOffset=rightOfDateLine===!0?world.getWidth()/resolution:0),this.rightOfDateLine=rightOfDateLine}return coordSysUnchanged},getNodeType:function(){},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME,rendered=!0;if("OpenLayers.Geometry.Collection"==className||"OpenLayers.Geometry.MultiPoint"==className||"OpenLayers.Geometry.MultiLineString"==className||"OpenLayers.Geometry.MultiPolygon"==className){for(var i=0,len=geometry.components.length;len>i;i++)rendered=this.drawGeometry(geometry.components[i],style,featureId)&&rendered;return rendered}rendered=!1;var removeBackground=!1;if("none"!=style.display&&(style.backgroundGraphic?this.redrawBackgroundNode(geometry.id,geometry,style,featureId):removeBackground=!0,rendered=this.redrawNode(geometry.id,geometry,style,featureId)),0==rendered){var node=document.getElementById(geometry.id);node&&(node._style.backgroundGraphic&&(removeBackground=!0),node.parentNode.removeChild(node))}if(removeBackground){var node=document.getElementById(geometry.id+this.BACKGROUND_ID_SUFFIX);node&&node.parentNode.removeChild(node)}return rendered},redrawNode:function(id,geometry,style,featureId){style=this.applyDefaultSymbolizer(style);var node=this.nodeFactory(id,this.getNodeType(geometry,style));node._featureId=featureId,node._boundsBottom=geometry.getBounds().bottom,node._geometryClass=geometry.CLASS_NAME,node._style=style;var drawResult=this.drawGeometryNode(node,geometry,style);if(drawResult===!1)return!1;if(node=drawResult.node,this.indexer){var insert=this.indexer.insert(node);insert?this.vectorRoot.insertBefore(node,insert):this.vectorRoot.appendChild(node)}else node.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(node);return this.postDraw(node),drawResult.complete},redrawBackgroundNode:function(id,geometry,style){var backgroundStyle=OpenLayers.Util.extend({},style);return backgroundStyle.externalGraphic=backgroundStyle.backgroundGraphic,backgroundStyle.graphicXOffset=backgroundStyle.backgroundXOffset,backgroundStyle.graphicYOffset=backgroundStyle.backgroundYOffset,backgroundStyle.graphicZIndex=backgroundStyle.backgroundGraphicZIndex,backgroundStyle.graphicWidth=backgroundStyle.backgroundWidth||backgroundStyle.graphicWidth,backgroundStyle.graphicHeight=backgroundStyle.backgroundHeight||backgroundStyle.graphicHeight,backgroundStyle.backgroundGraphic=null,backgroundStyle.backgroundXOffset=null,backgroundStyle.backgroundYOffset=null,backgroundStyle.backgroundGraphicZIndex=null,this.redrawNode(id+this.BACKGROUND_ID_SUFFIX,geometry,backgroundStyle,null)},drawGeometryNode:function(node,geometry,style){style=style||node._style;var drawn,options={isFilled:void 0===style.fill?!0:style.fill,isStroked:void 0===style.stroke?!!style.strokeWidth:style.stroke};switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":style.graphic===!1&&(options.isFilled=!1,options.isStroked=!1),drawn=this.drawPoint(node,geometry);break;case"OpenLayers.Geometry.LineString":options.isFilled=!1,drawn=this.drawLineString(node,geometry);break;case"OpenLayers.Geometry.LinearRing":drawn=this.drawLinearRing(node,geometry);break;case"OpenLayers.Geometry.Polygon":drawn=this.drawPolygon(node,geometry);break;case"OpenLayers.Geometry.Rectangle":drawn=this.drawRectangle(node,geometry)}return node._options=options,0!=drawn?{node:this.setStyle(node,style,options,geometry),complete:drawn}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(featureId){var label=document.getElementById(featureId+this.LABEL_ID_SUFFIX);label&&this.textRoot.removeChild(label);var outline=document.getElementById(featureId+this.LABEL_OUTLINE_SUFFIX);outline&&this.textRoot.removeChild(outline)},getFeatureIdFromEvent:function(evt){var target=evt.target,useElement=target&&target.correspondingUseElement,node=useElement?useElement:target||evt.srcElement;return node._featureId},eraseGeometry:function(geometry,featureId){if("OpenLayers.Geometry.MultiPoint"==geometry.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==geometry.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==geometry.CLASS_NAME||"OpenLayers.Geometry.Collection"==geometry.CLASS_NAME)for(var i=0,len=geometry.components.length;len>i;i++)this.eraseGeometry(geometry.components[i],featureId);else{var element=OpenLayers.Util.getElement(geometry.id);if(element&&element.parentNode&&(element.geometry&&(element.geometry.destroy(),element.geometry=null),element.parentNode.removeChild(element),this.indexer&&this.indexer.remove(element),element._style.backgroundGraphic)){var backgroundId=geometry.id+this.BACKGROUND_ID_SUFFIX,bElem=OpenLayers.Util.getElement(backgroundId);bElem&&bElem.parentNode&&bElem.parentNode.removeChild(bElem)}}},nodeFactory:function(id,type){var node=OpenLayers.Util.getElement(id);return node?this.nodeTypeCompare(node,type)||(node.parentNode.removeChild(node),node=this.nodeFactory(id,type)):node=this.createNode(type,id),node},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(renderer){var root=this.root;renderer.root.parentNode==this.rendererRoot&&(root=renderer.root),root.parentNode.removeChild(root),renderer.rendererRoot.appendChild(root)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(graphicName){return"circle"!=graphicName&&!!graphicName},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var svgFeature="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(svgFeature+"SVG","1.1")||document.implementation.hasFeature(svgFeature+"BasicStructure","1.1"))},inValidRange:function(x,y,xyOnly){var left=x+(xyOnly?0:this.translationParameters.x),top=y+(xyOnly?0:this.translationParameters.y);return left>=-this.MAX_PIXEL&&left<=this.MAX_PIXEL&&top>=-this.MAX_PIXEL&&top<=this.MAX_PIXEL},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),resolution=this.getResolution(),left=-extent.left/resolution,top=extent.top/resolution;if(resolutionChanged){this.left=left,this.top=top;var extentString="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",extentString),this.translate(this.xOffset,0),!0}var inRange=this.translate(left-this.left+this.xOffset,top-this.top);return inRange||this.setExtent(extent,!0),coordSysUnchanged&&inRange},translate:function(x,y){if(this.inValidRange(x,y,!0)){var transformString="";return(x||y)&&(transformString="translate("+x+","+y+")"),this.root.setAttributeNS(null,"transform",transformString),this.translationParameters={x:x,y:y},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(geometry,style){var nodeType=null;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":nodeType=style.externalGraphic?"image":this.isComplexSymbol(style.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":nodeType="rect";break;case"OpenLayers.Geometry.LineString":nodeType="polyline";break;case"OpenLayers.Geometry.LinearRing":nodeType="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="path"}return nodeType},setStyle:function(node,style,options){style=style||node._style,options=options||node._options;var title=style.title||style.graphicTitle;if(title){node.setAttributeNS(null,"title",title);var titleNode=node.getElementsByTagName("title");if(titleNode.length>0)titleNode[0].firstChild.textContent=title;else{var label=this.nodeFactory(null,"title");label.textContent=title,node.appendChild(label)}}var pos,r=parseFloat(node.getAttributeNS(null,"r")),widthFactor=1;if("OpenLayers.Geometry.Point"==node._geometryClass&&r){if(node.style.visibility="",style.graphic===!1)node.style.visibility="hidden";else if(style.externalGraphic){pos=this.getPosition(node),style.graphicWidth&&style.graphicHeight&&node.setAttributeNS(null,"preserveAspectRatio","none");var width=style.graphicWidth||style.graphicHeight,height=style.graphicHeight||style.graphicWidth;width=width?width:2*style.pointRadius,height=height?height:2*style.pointRadius;var xOffset=void 0!=style.graphicXOffset?style.graphicXOffset:-(.5*width),yOffset=void 0!=style.graphicYOffset?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity;node.setAttributeNS(null,"x",(pos.x+xOffset).toFixed()),node.setAttributeNS(null,"y",(pos.y+yOffset).toFixed()),node.setAttributeNS(null,"width",width),node.setAttributeNS(null,"height",height),node.setAttributeNS(this.xlinkns,"xlink:href",style.externalGraphic),node.setAttributeNS(null,"style","opacity: "+opacity),node.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(style.graphicName)){var offset=3*style.pointRadius,size=2*offset,src=this.importSymbol(style.graphicName);pos=this.getPosition(node),widthFactor=3*this.symbolMetrics[src.id][0]/size;var parent=node.parentNode,nextSibling=node.nextSibling;parent&&parent.removeChild(node),node.firstChild&&node.removeChild(node.firstChild),node.appendChild(src.firstChild.cloneNode(!0)),node.setAttributeNS(null,"viewBox",src.getAttributeNS(null,"viewBox")),node.setAttributeNS(null,"width",size),node.setAttributeNS(null,"height",size),node.setAttributeNS(null,"x",pos.x-offset),node.setAttributeNS(null,"y",pos.y-offset),nextSibling?parent.insertBefore(node,nextSibling):parent&&parent.appendChild(node)
}else node.setAttributeNS(null,"r",style.pointRadius);var rotation=style.rotation;if((void 0!==rotation||void 0!==node._rotation)&&pos)if(node._rotation=rotation,rotation|=0,"svg"!==node.nodeName)node.setAttributeNS(null,"transform","rotate("+rotation+" "+pos.x+" "+pos.y+")");else{var metrics=this.symbolMetrics[src.id];node.firstChild.setAttributeNS(null,"transform","rotate("+rotation+" "+metrics[1]+" "+metrics[2]+")")}}return options.isFilled?(node.setAttributeNS(null,"fill",style.fillColor),node.setAttributeNS(null,"fill-opacity",style.fillOpacity)):node.setAttributeNS(null,"fill","none"),options.isStroked?(node.setAttributeNS(null,"stroke",style.strokeColor),node.setAttributeNS(null,"stroke-opacity",style.strokeOpacity),node.setAttributeNS(null,"stroke-width",style.strokeWidth*widthFactor),node.setAttributeNS(null,"stroke-linecap",style.strokeLinecap||"round"),node.setAttributeNS(null,"stroke-linejoin","round"),style.strokeDashstyle&&node.setAttributeNS(null,"stroke-dasharray",this.dashStyle(style,widthFactor))):node.setAttributeNS(null,"stroke","none"),style.pointerEvents&&node.setAttributeNS(null,"pointer-events",style.pointerEvents),null!=style.cursor&&node.setAttributeNS(null,"cursor",style.cursor),node},dashStyle:function(style,widthFactor){var w=style.strokeWidth*widthFactor,str=style.strokeDashstyle;switch(str){case"solid":return"none";case"dot":return[1,4*w].join();case"dash":return[4*w,4*w].join();case"dashdot":return[4*w,4*w,1,4*w].join();case"longdash":return[8*w,4*w].join();case"longdashdot":return[8*w,4*w,1,4*w].join();default:return OpenLayers.String.trim(str).replace(/\s+/g,",")}},createNode:function(type,id){var node=document.createElementNS(this.xmlns,type);return id&&node.setAttributeNS(null,"id",id),node},nodeTypeCompare:function(node,type){return type==node.nodeName},createRenderRoot:function(){var svg=this.nodeFactory(this.container.id+"_svgRoot","svg");return svg.style.display="block",svg},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"g")},createDefs:function(){var defs=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(defs),defs},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)},drawCircle:function(node,geometry,radius){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"cx",x),node.setAttributeNS(null,"cy",y),node.setAttributeNS(null,"r",radius),node):!1},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawLinearRing:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawPolygon:function(node,geometry){for(var linearRingResult,path,d="",draw=!0,complete=!0,j=0,len=geometry.components.length;len>j;j++)d+=" M",linearRingResult=this.getComponentsString(geometry.components[j].components," "),path=linearRingResult.path,path?(d+=" "+path,complete=linearRingResult.complete&&complete):draw=!1;return d+=" z",draw?(node.setAttributeNS(null,"d",d),node.setAttributeNS(null,"fill-rule","evenodd"),complete?node:null):!1},drawRectangle:function(node,geometry){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"x",x),node.setAttributeNS(null,"y",y),node.setAttributeNS(null,"width",geometry.width/resolution),node.setAttributeNS(null,"height",geometry.height/resolution),node):!1},drawText:function(featureId,style,location){var drawOutline=!!style.labelOutlineWidth;if(drawOutline){var outlineStyle=OpenLayers.Util.extend({},style);outlineStyle.fontColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeWidth=style.labelOutlineWidth,style.labelOutlineOpacity&&(outlineStyle.fontOpacity=style.labelOutlineOpacity),delete outlineStyle.labelOutlineWidth,this.drawText(featureId,outlineStyle,location)}var resolution=this.getResolution(),x=(location.x-this.featureDx)/resolution+this.left,y=location.y/resolution-this.top,suffix=drawOutline?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,label=this.nodeFactory(featureId+suffix,"text");label.setAttributeNS(null,"x",x),label.setAttributeNS(null,"y",-y),style.fontColor&&label.setAttributeNS(null,"fill",style.fontColor),style.fontStrokeColor&&label.setAttributeNS(null,"stroke",style.fontStrokeColor),style.fontStrokeWidth&&label.setAttributeNS(null,"stroke-width",style.fontStrokeWidth),style.fontOpacity&&label.setAttributeNS(null,"opacity",style.fontOpacity),style.fontFamily&&label.setAttributeNS(null,"font-family",style.fontFamily),style.fontSize&&label.setAttributeNS(null,"font-size",style.fontSize),style.fontWeight&&label.setAttributeNS(null,"font-weight",style.fontWeight),style.fontStyle&&label.setAttributeNS(null,"font-style",style.fontStyle),style.labelSelect===!0?(label.setAttributeNS(null,"pointer-events","visible"),label._featureId=featureId):label.setAttributeNS(null,"pointer-events","none");var align=style.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle"),OpenLayers.IS_GECKO===!0&&label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central");for(var labelRows=style.label.split("\n"),numRows=labelRows.length;label.childNodes.length>numRows;)label.removeChild(label.lastChild);for(var i=0;numRows>i;i++){var tspan=this.nodeFactory(featureId+suffix+"_tspan_"+i,"tspan");if(style.labelSelect===!0&&(tspan._featureId=featureId,tspan._geometry=location,tspan._geometryClass=location.CLASS_NAME),OpenLayers.IS_GECKO===!1&&tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%"),tspan.setAttribute("x",x),0==i){var vfactor=OpenLayers.Renderer.SVG.LABEL_VFACTOR[align[1]];null==vfactor&&(vfactor=-.5),tspan.setAttribute("dy",vfactor*(numRows-1)+"em")}else tspan.setAttribute("dy","1em");tspan.textContent=""===labelRows[i]?" ":labelRows[i],tspan.parentNode||label.appendChild(tspan)}label.parentNode||this.textRoot.appendChild(label)},getComponentsString:function(components,separator){for(var str,component,renderCmp=[],complete=!0,len=components.length,strings=[],i=0;len>i;i++)component=components[i],renderCmp.push(component),str=this.getShortString(component),str?strings.push(str):(i>0&&this.getShortString(components[i-1])&&strings.push(this.clipLine(components[i],components[i-1])),len-1>i&&this.getShortString(components[i+1])&&strings.push(this.clipLine(components[i],components[i+1])),complete=!1);return{path:strings.join(separator||","),complete:complete}},clipLine:function(badComponent,goodComponent){if(goodComponent.equals(badComponent))return"";var k,resolution=this.getResolution(),maxX=this.MAX_PIXEL-this.translationParameters.x,maxY=this.MAX_PIXEL-this.translationParameters.y,x1=(goodComponent.x-this.featureDx)/resolution+this.left,y1=this.top-goodComponent.y/resolution,x2=(badComponent.x-this.featureDx)/resolution+this.left,y2=this.top-badComponent.y/resolution;return(-maxX>x2||x2>maxX)&&(k=(y2-y1)/(x2-x1),x2=0>x2?-maxX:maxX,y2=y1+(x2-x1)*k),(-maxY>y2||y2>maxY)&&(k=(x2-x1)/(y2-y1),y2=0>y2?-maxY:maxY,x2=x1+(y2-y1)*k),x2+","+y2},getShortString:function(point){var resolution=this.getResolution(),x=(point.x-this.featureDx)/resolution+this.left,y=this.top-point.y/resolution;return this.inValidRange(x,y)?x+","+y:!1},getPosition:function(node){return{x:parseFloat(node.getAttributeNS(null,"cx")),y:parseFloat(node.getAttributeNS(null,"cy"))}},importSymbol:function(graphicName){this.defs||(this.defs=this.createDefs());var id=this.container.id+"-"+graphicName,existing=document.getElementById(id);if(null!=existing)return existing;var symbol=OpenLayers.Renderer.symbol[graphicName];if(!symbol)throw new Error(graphicName+" is not a valid symbol name");var symbolNode=this.nodeFactory(id,"symbol"),node=this.nodeFactory(null,"polygon");symbolNode.appendChild(node);for(var x,y,symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),points=[],i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],symbolExtent.left=Math.min(symbolExtent.left,x),symbolExtent.bottom=Math.min(symbolExtent.bottom,y),symbolExtent.right=Math.max(symbolExtent.right,x),symbolExtent.top=Math.max(symbolExtent.top,y),points.push(x,",",y);node.setAttributeNS(null,"points",points.join(" "));var width=symbolExtent.getWidth(),height=symbolExtent.getHeight(),viewBox=[symbolExtent.left-width,symbolExtent.bottom-height,3*width,3*height];return symbolNode.setAttributeNS(null,"viewBox",viewBox.join(" ")),this.symbolMetrics[id]=[Math.max(width,height),symbolExtent.getCenterLonLat().lon,symbolExtent.getCenterLonLat().lat],this.defs.appendChild(symbolNode),symbolNode},getFeatureIdFromEvent:function(evt){var featureId=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!featureId){var target=evt.target;featureId=target.parentNode&&target!=this.rendererRoot?target.parentNode._featureId:void 0}return featureId},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var i=0,len=this.KEY_EVENTS.length;len>i;i++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[i],this.eventListener);return!0}return!1},deactivate:function(){var deactivated=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var i=0,len=this.KEY_EVENTS.length;len>i;i++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[i],this.eventListener);deactivated=!0}return deactivated},handleKeyEvent:function(evt){this.checkModifiers(evt)&&this.callback(evt.type,[evt])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(layer,options){options=options||{},this.layer=layer,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,options.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[options]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var dragCallbacks={down:function(){this.vertex=null;var feature=this.layer.getFeatureFromEvent(this.handlers.drag.evt);feature?this.dragStart(feature):this.clickout&&(this._unselect=this.feature)},move:function(pixel){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,pixel)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(){this.vertex&&this.dragComplete(this.vertex)}},dragOptions={documentDrag:this.documentDrag,stopDown:!1},keyboardOptions={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,keyboardOptions),drag:new OpenLayers.Handler.Drag(this,dragCallbacks,dragOptions)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()):!1},deactivate:function(){var deactivated=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var feature=this.feature;feature&&feature.geometry&&feature.layer&&this.unselectFeature(feature),deactivated=!0}return deactivated},beforeSelectFeature:function(feature){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature})},selectFeature:function(feature){if(!(this.feature===feature||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME))){this.beforeSelectFeature(feature)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=feature,this.layer.selectedFeatures.push(feature),this.layer.drawFeature(feature,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var modified=feature.modified;!feature.geometry||modified&&modified.geometry||(this._originalGeometry=feature.geometry.clone())}},unselectFeature:function(feature){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,feature),this.onModificationEnd(feature),this.layer.events.triggerEvent("afterfeaturemodified",{feature:feature,modified:this.modified}),this.modified=!1},dragStart:function(feature){var isPoint="OpenLayers.Geometry.Point"==feature.geometry.CLASS_NAME;this.standalone||(feature._sketch||!isPoint)&&feature._sketch||(this.toggle&&this.feature===feature&&(this._unselect=feature),this.selectFeature(feature)),(feature._sketch||isPoint)&&(this.vertex=feature,this.handlers.drag.stopDown=!0)},dragVertex:function(vertex,pixel){var pos=this.map.getLonLatFromViewPortPx(pixel),geom=vertex.geometry;geom.move(pos.lon-geom.x,pos.lat-geom.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel}):(vertex._index?(vertex.geometry.parent.addComponent(vertex.geometry,vertex._index),delete vertex._index,OpenLayers.Util.removeItem(this.virtualVertices,vertex),this.vertices.push(vertex)):vertex==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):vertex!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(vertex)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var feature=this.feature;feature.modified=OpenLayers.Util.extend(feature.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(evt){var code=evt.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,code)){var vertex=this.layer.getFeatureFromEvent(this.handlers.drag.evt);vertex&&-1!=OpenLayers.Util.indexOf(this.vertices,vertex)&&!this.handlers.drag.dragging&&vertex.geometry.parent&&(vertex.geometry.parent.removeComponent(vertex.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:vertex.geometry,feature:this.feature,pixel:evt.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function collectComponentVertices(geometry){var i,vertex,component,len;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)vertex=new OpenLayers.Feature.Vector(geometry),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex);else{var numVert=geometry.components.length;for("OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME&&(numVert-=1),i=0;numVert>i;++i)component=geometry.components[i],"OpenLayers.Geometry.Point"==component.CLASS_NAME?(vertex=new OpenLayers.Feature.Vector(component),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex)):collectComponentVertices(component);if(control.createVertices&&"OpenLayers.Geometry.MultiPoint"!=geometry.CLASS_NAME)for(i=0,len=geometry.components.length;len-1>i;++i){var prevVertex=geometry.components[i],nextVertex=geometry.components[i+1];if("OpenLayers.Geometry.Point"==prevVertex.CLASS_NAME&&"OpenLayers.Geometry.Point"==nextVertex.CLASS_NAME){var x=(prevVertex.x+nextVertex.x)/2,y=(prevVertex.y+nextVertex.y)/2,point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(x,y),null,control.virtualStyle);point.geometry.parent=geometry,point._index=i+1,point._sketch=!0,control.virtualVertices.push(point)}}}}this.vertices=[],this.virtualVertices=[];var control=this;collectComponentVertices.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var geometry=this.feature.geometry,center=geometry.getBounds().getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),origin=new OpenLayers.Feature.Vector(originGeometry);originGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y),geometry.move(x,y)},origin._sketch=!0,this.dragHandle=origin,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var geometry=this.feature.geometry,bounds=geometry.getBounds(),center=bounds.getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),radiusGeometry=new OpenLayers.Geometry.Point(bounds.right,bounds.bottom),radius=new OpenLayers.Feature.Vector(radiusGeometry),resize=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,reshape=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,rotate=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;radiusGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y);var dx1=this.x-originGeometry.x,dy1=this.y-originGeometry.y,dx0=dx1-x,dy0=dy1-y;if(rotate){var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1),angle=a1-a0;angle*=180/Math.PI,geometry.rotate(angle,originGeometry)}if(resize){var scale,ratio;if(reshape)scale=dy1/dy0,ratio=dx1/dx0/scale;else{var l0=Math.sqrt(dx0*dx0+dy0*dy0),l1=Math.sqrt(dx1*dx1+dy1*dy1);scale=l1/l0}geometry.resize(scale,originGeometry,ratio)}},radius._sketch=!0,this.radiusHandle=radius,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(map){this.handlers.drag.setMap(map),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(evt){("removelayer"==evt.type||"order"==evt.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(index)},moveLayerBack:function(){var index=this.layer.getZIndex()-1;index>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(index):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(geometry,options){for(var splits,sourceLine,sourceLines,sourceSplit,targetSplit,results=null,mutual=options&&options.mutual,sourceParts=[],targetParts=[geometry],i=0,len=this.components.length;len>i;++i){sourceLine=this.components[i],sourceSplit=!1;for(var j=0;j<targetParts.length;++j)if(splits=sourceLine.split(targetParts[j],options)){if(mutual){sourceLines=splits[0];for(var k=0,klen=sourceLines.length;klen>k;++k)0===k&&sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLines[k]):sourceParts.push(new OpenLayers.Geometry.MultiLineString([sourceLines[k]]));sourceSplit=!0,splits=splits[1]}if(splits.length){splits.unshift(j,1),Array.prototype.splice.apply(targetParts,splits);break}}sourceSplit||(sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLine.clone()):sourceParts=[new OpenLayers.Geometry.MultiLineString(sourceLine.clone())])}return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){var splits,targetLine,sourceLines,sourceSplit,targetSplit,sourceParts,targetParts,results=null,mutual=options&&options.mutual;if(geometry instanceof OpenLayers.Geometry.LineString){targetParts=[],sourceParts=[geometry];for(var i=0,len=this.components.length;len>i;++i){targetSplit=!1,targetLine=this.components[i];for(var j=0;j<sourceParts.length;++j)if(splits=sourceParts[j].split(targetLine,options)){mutual&&(sourceLines=splits[0],sourceLines.length&&(sourceLines.unshift(j,1),Array.prototype.splice.apply(sourceParts,sourceLines),j+=sourceLines.length-2),splits=splits[1],0===splits.length&&(splits=[targetLine.clone()]));for(var k=0,klen=splits.length;klen>k;++k)0===k&&targetParts.length?targetParts[targetParts.length-1].addComponent(splits[k]):targetParts.push(new OpenLayers.Geometry.MultiLineString([splits[k]]));targetSplit=!0}targetSplit||(targetParts.length?targetParts[targetParts.length-1].addComponent(targetLine.clone()):targetParts=[new OpenLayers.Geometry.MultiLineString([targetLine.clone()])])}}else results=geometry.split(this);return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(json,type,filter){type=type?type:"FeatureCollection";var results=null,obj=null;if(obj="string"==typeof json?OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter]):json){if("string"!=typeof obj.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+json);else if(this.isValidType(obj,type))switch(type){case"Geometry":try{results=this.parseGeometry(obj)}catch(err){OpenLayers.Console.error(err)}break;case"Feature":try{results=this.parseFeature(obj),results.type="Feature"}catch(err){OpenLayers.Console.error(err)}break;case"FeatureCollection":switch(results=[],obj.type){case"Feature":try{results.push(this.parseFeature(obj))}catch(err){results=null,OpenLayers.Console.error(err)}break;case"FeatureCollection":for(var i=0,len=obj.features.length;len>i;++i)try{results.push(this.parseFeature(obj.features[i]))}catch(err){results=null,OpenLayers.Console.error(err)}break;default:try{var geom=this.parseGeometry(obj);results.push(new OpenLayers.Feature.Vector(geom))}catch(err){results=null,OpenLayers.Console.error(err)}}}}else OpenLayers.Console.error("Bad JSON: "+json);return results},isValidType:function(obj,type){var valid=!1;switch(type){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],obj.type)?OpenLayers.Console.error("Unsupported geometry type: "+obj.type):valid=!0;break;case"FeatureCollection":valid=!0;break;default:obj.type==type?valid=!0:OpenLayers.Console.error("Cannot convert types from "+obj.type+" to "+type)}return valid},parseFeature:function(obj){var feature,geometry,attributes,bbox;attributes=obj.properties?obj.properties:{},bbox=obj.geometry&&obj.geometry.bbox||obj.bbox;try{geometry=this.parseGeometry(obj.geometry)}catch(err){throw err}return feature=new OpenLayers.Feature.Vector(geometry,attributes),bbox&&(feature.bounds=OpenLayers.Bounds.fromArray(bbox)),obj.id&&(feature.fid=obj.id),feature},parseGeometry:function(obj){if(null==obj)return null;var geometry,collection=!1;if("GeometryCollection"==obj.type){if(!OpenLayers.Util.isArray(obj.geometries))throw"GeometryCollection must have geometries array: "+obj;for(var numGeom=obj.geometries.length,components=new Array(numGeom),i=0;numGeom>i;++i)components[i]=this.parseGeometry.apply(this,[obj.geometries[i]]);geometry=new OpenLayers.Geometry.Collection(components),collection=!0}else{if(!OpenLayers.Util.isArray(obj.coordinates))throw"Geometry must have coordinates array: "+obj;if(!this.parseCoords[obj.type.toLowerCase()])throw"Unsupported geometry type: "+obj.type;try{geometry=this.parseCoords[obj.type.toLowerCase()].apply(this,[obj.coordinates])}catch(err){throw err}}return this.internalProjection&&this.externalProjection&&!collection&&geometry.transform(this.externalProjection,this.internalProjection),geometry},parseCoords:{point:function(array){if(0==this.ignoreExtraDims&&2!=array.length)throw"Only 2D points are supported: "+array;return new OpenLayers.Geometry.Point(array[0],array[1])},multipoint:function(array){for(var points=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err}points.push(p)}return new OpenLayers.Geometry.MultiPoint(points)},linestring:function(array){for(var points=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err}points.push(p)}return new OpenLayers.Geometry.LineString(points)},multilinestring:function(array){for(var lines=[],l=null,i=0,len=array.length;len>i;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err}lines.push(l)}return new OpenLayers.Geometry.MultiLineString(lines)},polygon:function(array){for(var r,l,rings=[],i=0,len=array.length;len>i;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err}r=new OpenLayers.Geometry.LinearRing(l.components),rings.push(r)}return new OpenLayers.Geometry.Polygon(rings)},multipolygon:function(array){for(var polys=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.polygon.apply(this,[array[i]])}catch(err){throw err}polys.push(p)}return new OpenLayers.Geometry.MultiPolygon(polys)},box:function(array){if(2!=array.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(array[0][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[0][1])])])}},write:function(obj,pretty){var geojson={type:null};if(OpenLayers.Util.isArray(obj)){geojson.type="FeatureCollection";var numFeatures=obj.length;geojson.features=new Array(numFeatures);for(var i=0;numFeatures>i;++i){var element=obj[i];if(!element instanceof OpenLayers.Feature.Vector){var msg="FeatureCollection only supports collections of features: "+element;throw msg}geojson.features[i]=this.extract.feature.apply(this,[element])}}else 0==obj.CLASS_NAME.indexOf("OpenLayers.Geometry")?geojson=this.extract.geometry.apply(this,[obj]):obj instanceof OpenLayers.Feature.Vector&&(geojson=this.extract.feature.apply(this,[obj]),obj.layer&&obj.layer.projection&&(geojson.crs=this.createCRSObject(obj)));return OpenLayers.Format.JSON.prototype.write.apply(this,[geojson,pretty])},createCRSObject:function(object){var proj=object.layer.projection.toString(),crs={};if(proj.match(/epsg:/i)){var code=parseInt(proj.substring(proj.indexOf(":")+1));crs=4326==code?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+code}}}return crs},extract:{feature:function(feature){var geom=this.extract.geometry.apply(this,[feature.geometry]),json={type:"Feature",properties:feature.attributes,geometry:geom};return null!=feature.fid&&(json.id=feature.fid),json},geometry:function(geometry){if(null==geometry)return null;this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var json,geometryType=geometry.CLASS_NAME.split(".")[2],data=this.extract[geometryType.toLowerCase()].apply(this,[geometry]);return json="Collection"==geometryType?{type:"GeometryCollection",geometries:data}:{type:geometryType,coordinates:data}},point:function(point){return[point.x,point.y]},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.components.length;len>i;++i)array.push(this.extract.point.apply(this,[multipoint.components[i]]));return array},linestring:function(linestring){for(var array=[],i=0,len=linestring.components.length;len>i;++i)array.push(this.extract.point.apply(this,[linestring.components[i]]));
return array},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.components.length;len>i;++i)array.push(this.extract.linestring.apply(this,[multilinestring.components[i]]));return array},polygon:function(polygon){for(var array=[],i=0,len=polygon.components.length;len>i;++i)array.push(this.extract.linestring.apply(this,[polygon.components[i]]));return array},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.components.length;len>i;++i)array.push(this.extract.polygon.apply(this,[multipolygon.components[i]]));return array},collection:function(collection){for(var len=collection.components.length,array=new Array(len),i=0;len>i;++i)array[i]=this.extract.geometry.apply(this,[collection.components[i]]);return array}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"â",zoomOutId:"olZoomOutLink",draw:function(){var div=OpenLayers.Control.prototype.draw.apply(this),links=this.getOrCreateLinks(div),zoomIn=links.zoomIn,zoomOut=links.zoomOut,eventsInstance=this.map.events;return zoomOut.parentNode!==div&&(eventsInstance=this.events,eventsInstance.attachToElement(zoomOut.parentNode)),eventsInstance.register("buttonclick",this,this.onZoomClick),this.zoomInLink=zoomIn,this.zoomOutLink=zoomOut,div},getOrCreateLinks:function(el){var zoomIn=document.getElementById(this.zoomInId),zoomOut=document.getElementById(this.zoomOutId);return zoomIn||(zoomIn=document.createElement("a"),zoomIn.href="#zoomIn",zoomIn.appendChild(document.createTextNode(this.zoomInText)),zoomIn.className="olControlZoomIn",el.appendChild(zoomIn)),OpenLayers.Element.addClass(zoomIn,"olButton"),zoomOut||(zoomOut=document.createElement("a"),zoomOut.href="#zoomOut",zoomOut.appendChild(document.createTextNode(this.zoomOutText)),zoomOut.className="olControlZoomOut",el.appendChild(zoomOut)),OpenLayers.Element.addClass(zoomOut,"olButton"),{zoomIn:zoomIn,zoomOut:zoomOut}},onZoomClick:function(evt){var button=evt.buttonElement;button===this.zoomInLink?this.map.zoomIn():button===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),function(){function getConstructor(name){for(var parts=name.split("."),Type=OpenLayers,i=1,ii=parts.length;ii>i;++i)Type=Type[parts[i]];return Type}OpenLayers.Geometry.Collection.prototype.clone=function(){for(var Type=getConstructor(this.CLASS_NAME),geometry=new Type,i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry}}(this);;var CSS = '.olCursorPointer{cursor:pointer}.olCursorWait{cursor:wait}.olDragDown{cursor:move}.olDrawBox{cursor:crosshair}.olControlDragFeatureOver{cursor:move}.olControlDragFeatureActive.olControlDragFeatureOver.olDragDown{cursor:-moz-grabbing}.olControlZoom{position:absolute;top:10px;left:10px;border-radius:4px;border:1px solid #bbb}.olControlZoom a{display:block;color:#000;padding:0;font-size:18px;font-family:"Lucida Grande",Verdana,Geneva,Lucida,Arial,Helvetica,sans-serif;font-weight:700;text-decoration:none;text-align:center;height:26px;width:26px;line-height:26px;background:#fff}.olControlZoom a:hover{background:#f4f4f4}.olControlZoomIn{border-radius:4px 4px 0 0;border-bottom:1px solid #ccc}.olControlZoomOut{border-radius:0 0 4px 4px}';;!function(){function showMap(){var editor=$("#ace-editor").hide();$("ul.actions").hide(),$("div.js-file-commit-form").hide();var viewport=$('<div id="ol-map">').css("height",400).insertAfter(editor),raster=new OpenLayers.Layer.XYZ(null,tiles,{sphericalMercator:!0});vector=new OpenLayers.Layer.Vector(null,{styleMap:styles}),map=new OpenLayers.Map({div:viewport[0],theme:null,layers:[raster,vector]});var str=unsafeWindow.editor.ace.getSession().getValue(),obj=JSON.parse(str),features=format.read(obj);vector.addFeatures(features),map.zoomToExtent(vector.getDataExtent()),control=new OpenLayers.Control.ModifyFeature(vector,{vertexRenderIntent:"temporary"}),map.addControl(control),control.activate(),dirty=!1,vector.events.on({featuremodified:function(){dirty=!0}});var over=0;map.events.on({featureover:function(event){var feature=event.feature;feature._sketch?viewport.addClass("olControlDragFeatureOver"):(viewport.addClass("olCursorPointer"),++over)},featureout:function(event){var feature=event.feature;feature._sketch?viewport.removeClass("olControlDragFeatureOver"):(over=over-1||0,over||viewport.removeClass("olCursorPointer"))}}),vector.events.on({vertexremoved:function(){viewport.removeClass("olControlDragFeatureOver")}})}function updateEditor(){if(dirty){var code=format.write(vector.features,!0);unsafeWindow.editor.setCode(code)}}function hideMap(){map&&(control.deactivate(),updateEditor(),map.destroy(),map=null,$("#ol-map").remove(),$("#ace-editor").show(),$("ul.actions").show(),$("div.js-file-commit-form").show())}if(window.location.pathname.match(/^(\/[^\/]+){2}\/edit\/.*\.geojson$/)){var $=unsafeWindow.$;$("head").append("<style>"+CSS+"</style>");var mapAnchor=$("<a>").attr("href","#").addClass("map minibutton").append("Map"),others=$("ul.js-blob-edit-actions a"),codeAnchor=$(others[0]);$(others[1]).hide(),mapAnchor.click(function(){return showMap(),mapAnchor.addClass("selected"),codeAnchor.removeClass("selected"),!1}),codeAnchor.click(function(){hideMap(),codeAnchor.addClass("selected"),mapAnchor.removeClass("selected")}),$("ul.actions"),$("<li>").append(mapAnchor).insertBefore("ul.js-blob-edit-actions li:first");var map,vector,control,dirty,format=new OpenLayers.Format.GeoJSON({externalProjection:"EPSG:4326",internalProjection:"EPSG:900913"}),tiles="//dnv9my2eseobd.cloudfront.net/v3/github.map-xgq2svrz/${z}/${x}/${y}.png",styles=new OpenLayers.StyleMap({"default":{pointRadius:6,fillColor:"white",fillOpacity:.1,strokeWidth:2,strokeOpacity:.7,strokeColor:"#006ec8"},select:{pointRadius:6,fillColor:"#fcf8e9",fillOpacity:.5,strokeWidth:2,strokeOpacity:.8,strokeColor:"#006ec8"},temporary:{pointRadius:4,fillColor:"white",fillOpacity:.1,strokeWidth:2,strokeOpacity:.7,strokeColor:"#006ec8"}})}}(this);