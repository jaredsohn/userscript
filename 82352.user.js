// ==UserScript==   
// @name            ImagePreview
// @namespace       skyboy@kongregate
// @author          skyboy
// @version         1.1.0
// @description     Pops up a preview window for images in kongregate chat when you hover over them. If you do not have KongreLink installed, this will also make links to images into links, but no other links.
// @include         http://www.kongregate.com/games/*/*
// @homepage        http://userscripts.org/scripts/show/82352
// ==/UserScript==  
if (/^\/?games\/[^\/]+\/[^\/?]+(\?.*)?$/.test(window.location.pathname)) {
setTimeout(function() {
javascript:void((function(){window.location.assign("javascript:void((function(){var cont=new Element('p');cont.id='kong_game_ui',$('subwrap').insertBefore(cont, $('secondary'));cont.innerHTML=\"<div style='left: 144px; top: 58px; display: none;' class='user_rollover_container' id='user_popup'><div class='user_rollover'><div class='user_rollover_inner'><img src='' style='max-width: 101px; max-height: 200px; margin: 3px 0px 0px 7px;' id='previewpop'></div></div></div>\";holodeck.addIncomingMessageFilter(function(m,n){var REGEX=/(<\\S[^>]+>)?(\\b(?:(?:(ht|f)tp)s?:\\/\\/)?(((?:(?:[^.]+)[.])*(?:(?:[a-z0-9][a-z0-9\\-]{0,61})?[a-z0-9])[.])*(a(?:c|d|e(?:ro)?|f|g|i|l|m|n|o|q|r(?:pa)?|s(?:ia)?|t|u|w|x|z)|b(?:a|b|d|e|f|g|h|i|iz|j|l|m|n|o|r|s|t|v|w|y|z)|c(?:at?|c|d|f|g|h|i|k|l|m|n|o(?:m|op)?|r|u|v|x|y|z)|d[ejkmoz]|e(?:c|du|e|g|h|r|s|t|u)|f[ijkmor]|g(?:a|b|d|e|f|g|h|i|l|m|n|ov|p|q|r|s|t|u|w|y)|h[kmnrtu]|i(?:d|e|l|m|n(?:fo|t)|o|q|r|s|t)|je|jm|jo|jobs|jp|k[eghimnprwyz]|l[abcikrstuvy]|m(?:a|c|d|e|f|g|h|i?l|k|m|n|o(?:bi)?|p|q|r|s|t|u(?:seum)?|v|w|x|y|z)|n(?:a(?:me)?|c|et?|f|g|i|l|o|p|r|u|z)|om|org|p(?:a|e|f|g|h|k|l|m|n|ro?|s|t|w|y)|qa|r[eosuw]|s(?:a|b|c|d|e|g|h|i|j|k|l|m|n|o|r|t|u|v|y|z)|t(?:c|d|e?l|f|g|th|j|k|m|n|o|p|r(?:avel)?|t|v|w|z)|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw])\\b([.]\\B)?|\\d{1,3}[.]\\d{1,3}[.]\\d{1,3}[.]\\d{1,3})(?::\\d+)?)(\\/(?:\\B|\\S+)(?:\\.(?:jpe?g|jpe|gif|png|tiff?|bmp|jfif|exif|raw|p[pgbn]m|svg|ico)(?:[?](?:\\B|\\S+))?)(?:\\b|\\s))/ig,lF=/(?:<(\\S)[^>]+?href=[\"'])(?:\\b((?:(ht|f)tp)s?:\\/\\/)?(((?:(?:[^.]+)[.])*(?:(?:[a-z0-9][a-z0-9\\-]{0,61})?[a-z0-9])[.])?(a(?:c|d|e(?:ro)?|f|g|i|l|m|n|o|q|r(?:pa)?|s(?:ia)?|t|u|w|x|z)|b(?:a|b|d|e|f|g|h|i|iz|j|l|m|n|o|r|s|t|v|w|y|z)|c(?:at?|c|d|f|g|h|i|k|l|m|n|o(?:m|op)?|r|u|v|x|y|z)|d[ejkmoz]|e(?:c|du|e|g|h|r|s|t|u)|f[ijkmor]|g(?:a|b|d|e|f|g|h|i|l|m|n|ov|p|q|r|s|t|u|w|y)|h[kmnrtu]|i(?:d|e|l|m|n(?:fo|t)|o|q|r|s|t)|je|jm|jo|jobs|jp|k[eghimnprwyz]|l[abcikrstuvy]|m(?:a|c|d|e|f|g|h|i?l|k|m|n|o(?:bi)?|p|q|r|s|t|u(?:seum)?|v|w|x|y|z)|n(?:a(?:me)?|c|et?|f|g|i|l|o|p|r|u|z)|om|org|p(?:a|e|f|g|h|k|l|m|n|ro?|s|t|w|y)|qa|r[eosuw]|s(?:a|b|c|d|e|g|h|i|j|k|l|m|n|o|r|t|u|v|y|z)|t(?:c|d|e?l|f|g|th|j|k|m|n|o|p|r(?:avel)?|t|v|w|z)|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw])\\b([.]\\B)?|\\d{1,3}[.]\\d{1,3}[.]\\d{1,3}[.]\\d{1,3})(?::\\d+)?)?(\\/(?:\\B|\\S+)(?:\\.(?:jpe?g|jpe|gif|png|tiff?|bmp|jfif|exif|raw|p[pgbn]m|svg|ico)(?:[?](?:\\B|\\S+))?))(?:[\"'][^>]*>([\\s\\S]+?)<\\/\\1>)/gi,q=function(w,c,r,l){var t,a,d;w=w.substring(0,(t=r.lastIndex)-(a=c[0]).length)+(a=(\"<a class='\"+(l?l[1]:'poppreview')+\"' onmouseover=\\\"$('user_popup').setStyle({display:'block',top:(event.pageY-17)+'px',left:(event.pageX+5)+'px'});$('previewpop').src=this.href;\\\" onmouseout=\\\"$('user_popup').style.display='none'\\\" href='\"+(l=((((d=c[3])=='ht'||d=='f')?'':'http://')+(d=a).replace(/<a[^>]+?href=([\"'])([\\s\\S]+?)\\1[^>]*?>[\\s\\S]+<\\/a>/, '$2')))+\"' target='_blank'>\"+(c[9]||d.replace(/(.{38}(?=.{9}))/g, '$1\\n').strip())+'</a>'))+w.substring(t,w.length);REGEX.lastIndex+=(a=a.length-d.length),r.lastIndex+=a;return w},Q=function(b){var w=b,t=REGEX.lastIndex=0,a,c,d;while(c=REGEX.exec(w)){if(c[1]||(!c[5]&&!c[7])||(c[7]&&!(c[3]||c[8])))continue;w=q(w,c,REGEX)};while(c=lF.exec(w)){c[3]='ht';w=q(w,c,lF,c[0].match(/class=(['\"])([^>]+?)\\2[\\s\\S]*?>/i))};return w};return n(Q(m),n)})})())")})());
}, 1250);
}